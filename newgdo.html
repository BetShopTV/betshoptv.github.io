<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BSTV — Galeria de Ofertas</title>

<style>
  :root{
    --vermelho:#ff0000;
    --preto:#2b2424;
    --bege:#bebab0;
    --branco:#ffffff;

    /* largura máxima do conteúdo (3 colunas) */
    --wrap: 1200px;

    /* medidas base */
    --gap: 10px;
    --col-gap: 12px;
    --thumb-h: 92px;           /* altura dos thumbs no painel */
    --rodape-h: 56px;          /* altura da barra vermelha */
    --rodape-icon: 22px;       /* tamanho base dos ícones do rodapé */
    --rodape-font: 16px;       /* tipografia base da barra */
    --painel-maxh: 30vh;       /* altura máx. do painel branco */
    --borda-sel: 2px;          /* borda vermelha imgs selecionadas */
    --contador-size: 18px;     /* bolinha contador ícone */
  }

  /* Responsivo – ajuste leve no mobile */
  @media (max-width: 480px){
    :root{
      --wrap: 100%;
      --col-gap: 8px;
      --rodape-h: 52px;
      --rodape-icon: 20px;
      --rodape-font: 14px;
      --thumb-h: 80px;
      --contador-size: 16px;
    }
  }

  html,body{
    margin:0; padding:0;
    background:var(--bege);
    color:var(--preto);
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    overflow-x:hidden;
  }

  .wrap{
    width:100%;
    max-width:var(--wrap);
    margin:0 auto;
    padding:0 var(--gap);
    box-sizing:border-box;
  }

  /* ===================== GALERIA ===================== */
  .galeria{
    display:grid;
    grid-template-columns: repeat(3, 1fr);
    grid-auto-rows: auto;
    gap: var(--col-gap);
    margin-bottom: calc(var(--rodape-h) + 12px);
  }
  .card{
    position:relative;
  }
  .card img{
    display:block;
    width:100%;
    height:auto;          /* altura livre: preserva proporção */
    border: none;
    box-sizing:border-box;
  }
  .card.selected img{
    border: var(--borda-sel) solid var(--vermelho);
  }
  /* ===================== RODAPÉ ===================== */
  .rodape{
    position:fixed; inset:auto 0 0 0;
    height: var(--rodape-h);
    background: var(--vermelho);
    color: var(--branco);
    z-index: 40;
    user-select:none;
  }
  .rodape .wrap{
    height:100%;
    display:flex; align-items:center; justify-content:space-between;
    gap:16px;
  }
  .rodape__titulo{
    font-weight: 800; letter-spacing: .3px;
    font-size: var(--rodape-font);
    text-transform: none;
  }
  .rodape__acoes{
    display:flex; align-items:center; gap:18px;
  }
  .acao{
    display:flex; align-items:center; gap:8px;
    cursor:pointer; -webkit-tap-highlight-color: transparent;
  }
  .acao .rotulo{
    font-size: var(--rodape-font);
    font-weight: 700;
    transition: opacity .15s linear;
  }
  .acao.off .ico{ filter: grayscale(100%) brightness(0) invert(88%); } /* p/ cinza #bebab0 */
  .acao.off .rotulo{ color: var(--bege); }
  .acao.on .ico{ filter:none; }
  .acao.on .rotulo{ color: var(--branco); }

  .ico{
    width: var(--rodape-icon); height: var(--rodape-icon); display:inline-block;
    background-size:contain; background-repeat:no-repeat; background-position:center;
    position:relative;
  }
  /* Contador circular branco com número vermelho */
  .ico .cnt{
    position:absolute; right:-10px; top:-10px;
    min-width: var(--contador-size); height: var(--contador-size);
    padding:0 5px; border-radius: 999px;
    background: var(--branco); color: var(--vermelho);
    font-weight: 800; font-size: 12px; line-height: var(--contador-size);
    text-align:center;
    display:none;
  }
  .ico.has-items .cnt{ display:inline-block; }

  /* ícones */
  .ico-shop{ background-image:url('https://betshoptv.com/elementos/ticon-SHOP-b.avif'); }
  .acao.off .ico-shop{ background-image:url('https://betshoptv.com/elementos/ticon-SHOP-c.avif'); }

  .ico-rifa{ background-image:url('https://betshoptv.com/elementos/ticon-RIFA-b.avif'); }
  .acao.off .ico-rifa{ background-image:url('https://betshoptv.com/elementos/ticon-RIFA-c.avif'); }

  /* ===================== PAINEL (expansão) ===================== */
  .painel{
    position: fixed; left:0; right:0; bottom: var(--rodape-h);
    background: var(--branco);
    border-top: 2px solid var(--branco);
    z-index: 39; /* abaixo da barra vermelha */
    display:none;
  }
  .painel.aberto{ display:block; }
  .painel .wrap{ padding-top: 12px; padding-bottom: 12px; }

  /* faixa de thumbs */
  .thumbs{
    display:flex; align-items:flex-start; gap:12px;
    overflow-x:auto; overflow-y:hidden;
    max-height: calc(var(--painel-maxh) - 70px);
    padding-bottom:10px;
  }
  .thumb{
    position:relative;
    flex: 0 0 auto;
    height: var(--thumb-h);
    border:1px solid #ddd;
    display:flex; align-items:center; justify-content:center;
    background:#fff;
  }
  .thumb img{
    height:100%; width:auto; display:block; object-fit:contain;
  }
  .thumb .x{
    position:absolute; top:4px; right:4px;
    background:#000; color:#fff; font-size:11px;
    width:18px; height:18px; line-height:18px; text-align:center; cursor:pointer;
  }

  /* barra de rolagem horizontal vermelha */
  .thumbs::-webkit-scrollbar{ height:6px; }
  .thumbs::-webkit-scrollbar-thumb{ background: var(--vermelho); }
  .thumbs::-webkit-scrollbar-track{ background: #eee; }

  /* linha TOTAL + botão */
  .total-linha{
    display:flex; align-items:center; justify-content:space-between;
    gap:12px; padding-top:8px;
  }
  .total{
    font-weight:800; color: var(--preto);
  }
  .btn{
    background:#111; color:#fff; border:none; cursor:pointer;
    padding:10px 16px; font-weight:800; letter-spacing:.3px;
  }

  /* clique-fora */
  .overlay{
    position: fixed; inset:0; background: transparent; display:none; z-index:38;
  }
  .overlay.on{ display:block; }

  /* util */
  .hidden{ display:none !important; }
</style>
</head>
<body>

  <main class="wrap">
    <section id="galeria" class="galeria" aria-label="Galeria de 3 colunas"></section>
  </main>

  <!-- Painel de seleção (acima do rodapé) -->
  <section id="painel" class="painel" aria-live="polite">
    <div class="wrap">
      <div id="thumbs" class="thumbs" aria-label="Itens selecionados (rolagem horizontal)"></div>
      <div class="total-linha">
        <div id="total" class="total">TOTAL: R$ 0,00</div>
        <button id="btnFinalizar" class="btn" type="button">FINALIZAR APOSTA</button>
      </div>
    </div>
  </section>

  <!-- Área de clique-fora -->
  <div id="overlay" class="overlay" tabindex="-1"></div>

  <!-- Rodapé -->
  <footer class="rodape" id="rodape">
    <div class="wrap">
      <div class="rodape__titulo">CENTRAL de APOSTAS</div>
      <nav class="rodape__acoes" aria-label="Abas da central">
        <div id="tabShop" class="acao on" data-tab="shop" role="button" aria-pressed="true">
          <span class="ico ico-shop"><span class="cnt" id="cntShop">0</span></span>
          <span class="rotulo">PEÇAS</span>
        </div>
        <div id="tabRifa" class="acao off" data-tab="rifa" role="button" aria-pressed="false">
          <span class="ico ico-rifa"><span class="cnt" id="cntRifa">0</span></span>
          <span class="rotulo">RIFAS</span>
        </div>
      </nav>
    </div>
  </footer>

<script>
/* ======================== DADOS (fetch + fallback) ======================== */
const PATH_PECAS = '/dados/pecas.json';
const PATH_RIFAS = '/dados/rifas.json';

const fallbackPecas = Array.from({length:12}).map((_,i)=>({
  id: (409 - i).toString().padStart(4,'0'),
  titulo: `Peça ${409 - i}`,
  preco: 150 + (i%3)*50,
  img: `https://picsum.photos/seed/bstv${i}/900/1200`
}));

const fallbackRifas = []; // sem conteúdo por ora

async function loadJSON(url, fallback){
  try{
    const r = await fetch(url, {cache:'no-store'});
    if(!r.ok) throw 0;
    const j = await r.json();
    return j && j.length ? j : fallback;
  }catch(e){
    return fallback;
  }
}

/* ======================== ESTADO ======================== */
let PECAS = [];
let RIFAS = [];
const sel = { shop: new Map(), rifa: new Map() }; // id -> item
let painelAberto = false;
let abaAtiva = 'shop'; // 'shop' | 'rifa'

/* ======================== DOM REFS ======================== */
const galeriaEl = document.getElementById('galeria');
const painelEl  = document.getElementById('painel');
const overlayEl = document.getElementById('overlay');
const thumbsEl  = document.getElementById('thumbs');
const totalEl   = document.getElementById('total');
const btnFinal  = document.getElementById('btnFinalizar');

const tabShop   = document.getElementById('tabShop');
const tabRifa   = document.getElementById('tabRifa');
const cntShop   = document.getElementById('cntShop');
const cntRifa   = document.getElementById('cntRifa');

/* ======================== HELPERS ======================== */
const fmt = v => v.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});

function atualizarContadores(){
  const nShop = sel.shop.size;
  const nRifa = sel.rifa.size;

  cntShop.textContent = nShop;
  cntRifa.textContent = nRifa;

  tabShop.querySelector('.ico').classList.toggle('has-items', nShop>0);
  tabRifa.querySelector('.ico').classList.toggle('has-items', nRifa>0);
}
function totalSelecionado(){
  let total = 0;
  sel.shop.forEach(it => total += Number(it.preco||0));
  sel.rifa.forEach(it => total += Number(it.preco||0));
  return total;
}
function setAba(tab){
  abaAtiva = tab;
  tabShop.classList.toggle('on', tab==='shop');
  tabShop.classList.toggle('off', tab!=='shop');
  tabRifa.classList.toggle('on', tab==='rifa');
  tabRifa.classList.toggle('off', tab!=='rifa');

  if(painelAberto) abrirPainel(); // força refresh do conteúdo
}
function abrirPainel(){
  painelAberto = true;
  painelEl.classList.add('aberto');
  overlayEl.classList.add('on');
  renderThumbs();
  totalEl.textContent = `TOTAL: ${fmt(totalSelecionado())}`;
}
function fecharPainel(){
  painelAberto = false;
  painelEl.classList.remove('aberto');
  overlayEl.classList.remove('on');
}
function togglePainel(tab){
  if(tab) setAba(tab);
  painelAberto ? fecharPainel() : abrirPainel();
}

/* ======================== RENDER GALERIA ======================== */
function renderGaleria(lista){
  galeriaEl.innerHTML = '';
  // ordem: linha por linha, id decrescente
  const itens = [...lista].sort((a,b)=> Number(b.id) - Number(a.id));

  for(const it of itens){
    const card = document.createElement('article');
    card.className = 'card';
    card.dataset.id = it.id;
    card.dataset.preco = it.preco;
    card.dataset.tipo = 'shop'; // só peças nesta galeria por enquanto

    const img = document.createElement('img');
    img.alt = it.titulo || `Peça ${it.id}`;
    img.src = it.img;
    card.appendChild(img);

    // estado selecionado?
    if(sel.shop.has(it.id)) card.classList.add('selected');

    // clique alterna seleção
    card.addEventListener('click', ()=>{
      const id = it.id;
      if(sel.shop.has(id)){
        sel.shop.delete(id);
        card.classList.remove('selected');
      }else{
        sel.shop.set(id, it);
        card.classList.add('selected');
      }
      atualizarContadores();
      if(painelAberto) renderThumbs();
      totalEl.textContent = `TOTAL: ${fmt(totalSelecionado())}`;
    });

    galeriaEl.appendChild(card);
  }
}

/* ======================== THUMBS (PAINEL) ======================== */
function renderThumbs(){
  thumbsEl.innerHTML = '';
  const mapa = abaAtiva==='shop' ? sel.shop : sel.rifa;

  // ordem de adição (inserção) – do mais recente pro mais antigo
  const arr = [...mapa.values()];
  for(const it of arr){
    const t = document.createElement('div');
    t.className = 'thumb';
    t.dataset.id = it.id;
    const im = document.createElement('img');
    im.src = it.img; im.alt = it.titulo || it.id;
    t.appendChild(im);

    const x = document.createElement('span');
    x.className = 'x'; x.textContent = '×';
    x.title = 'Remover';
    x.addEventListener('click', (ev)=>{
      ev.stopPropagation();
      if(abaAtiva==='shop'){
        sel.shop.delete(it.id);
        // remover borda na galeria
        const c = galeriaEl.querySelector(`.card[data-id="${it.id}"]`);
        if(c) c.classList.remove('selected');
      }else{
        sel.rifa.delete(it.id);
      }
      renderThumbs();
      atualizarContadores();
      totalEl.textContent = `TOTAL: ${fmt(totalSelecionado())}`;
    });
    t.appendChild(x);

    thumbsEl.appendChild(t);
  }
}

/* ======================== EVENTOS GLOBAIS ======================== */
tabShop.addEventListener('click', ()=> togglePainel('shop'));
tabRifa.addEventListener('click', ()=> togglePainel('rifa'));

document.getElementById('rodape').addEventListener('click', (e)=>{
  // clique na faixa vermelha fora dos botões também alterna
  const isBtn = e.target.closest('.acao');
  if(!isBtn) togglePainel(abaAtiva);
});

overlayEl.addEventListener('click', fecharPainel);
document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') fecharPainel(); });

btnFinal.addEventListener('click', ()=>{
  // só alerta-resumo por enquanto
  const pecas = [...sel.shop.keys()].join(',');
  const rifas = [...sel.rifa.keys()].join(',');
  alert(`Resumo da aposta:\nPeças: ${pecas}\nRifas: ${rifas}\nTotal: ${fmt(totalSelecionado())}`);
});

/* ======================== BOOT ======================== */
(async function init(){
  PECAS = await loadJSON(PATH_PECAS, fallbackPecas);
  RIFAS = await loadJSON(PATH_RIFAS, fallbackRifas);
  renderGaleria(PECAS);
  atualizarContadores();
})();
</script>
</body>
</html>
