<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BSTV — Central de Apostas</title>
<style>
:root{
  --vermelho:#ff0000; --preto:#2b2424; --bege:#bebab0; --branco:#ffffff;
  --maxw:1200px; --gap:10px; --col-gap:12px;
  --rodape-h:60px; --rodape-font:clamp(14px,1.6vw,18px);
  --painel-h:30vh; --thumb-h:clamp(80px,20vh,120px);
  --contador:clamp(16px,2vw,22px);
}
@media (max-width:480px){
  :root{--rodape-h:52px;--col-gap:8px;}
}
html,body{margin:0;background:var(--bege);color:var(--preto);
  font-family:"Roboto Condensed",system-ui,sans-serif;}
.wrap{max-width:var(--maxw);margin:0 auto;padding:0 var(--gap);}
.galeria{display:grid;grid-template-columns:repeat(3,1fr);gap:var(--col-gap);
  padding-top:10px;padding-bottom:calc(var(--rodape-h) + 10px);}
.card img{width:100%;display:block;border:none;object-fit:cover;}
.card.selected img{border:2px solid var(--vermelho);}
.painel{position:fixed;left:0;right:0;bottom:var(--rodape-h);
  background:var(--branco);border-top:2px solid var(--branco);
  display:none;z-index:40;}
.painel.aberto{display:block;}
.painel .wrap{padding:10px 8px;}
.thumbs{display:flex;gap:10px;overflow-x:auto;padding-bottom:6px;}
.thumb{flex:0 0 auto;height:var(--thumb-h);border:1px solid var(--preto);
  position:relative;background:var(--branco);}
.thumb img{height:100%;width:auto;object-fit:contain;display:block;}
.thumb .x{position:absolute;top:4px;right:4px;background:var(--preto);
  color:var(--branco);border:none;width:18px;height:18px;cursor:pointer;}
.thumbs::-webkit-scrollbar{height:6px;}
.thumbs::-webkit-scrollbar-thumb{background:var(--vermelho);}
.total-line{display:flex;align-items:center;justify-content:space-between;
  padding-top:6px;}
.total{font-weight:800;font-size:clamp(14px,1.6vw,18px);}
.btn{background:var(--preto);color:var(--branco);border:none;
  padding:10px 16px;font-weight:800;cursor:pointer;}
.rodape{position:fixed;left:0;right:0;bottom:0;height:var(--rodape-h);
  background:var(--vermelho);color:var(--branco);z-index:50;}
.rodape .wrap{display:flex;align-items:center;justify-content:space-between;
  height:100%;}
.brand{font-weight:900;font-size:var(--rodape-font);}
.actions{display:flex;align-items:center;gap:clamp(12px,2vw,24px);}
.acao{display:flex;align-items:center;gap:6px;cursor:pointer;}
.acao.off{opacity:.6;}
.acao.off .rotulo{color:var(--bege);}
.acao .rotulo{font-weight:700;font-size:var(--rodape-font);}
.ico{position:relative;width:clamp(22px,2.6vw,28px);height:auto;display:block;}
.cnt{position:absolute;right:-8px;top:-10px;min-width:var(--contador);
  height:var(--contador);border-radius:50%;background:var(--branco);
  color:var(--vermelho);font-weight:900;font-size:12px;display:flex;
  align-items:center;justify-content:center;box-shadow:0 0 0 2px var(--vermelho);}
.cnt.hidden{display:none;}
.overlay{position:fixed;inset:0;background:transparent;display:none;z-index:39;}
.overlay.on{display:block;}
</style>
</head>
<body>
<div class="wrap">
  <div id="galeria" class="galeria"></div>
</div>

<section id="painel" class="painel">
  <div class="wrap">
    <div id="thumbs" class="thumbs"></div>
    <div class="total-line">
      <div id="total" class="total">TOTAL: R$ 0,00</div>
      <button id="btnFinalizar" class="btn">FINALIZAR APOSTA</button>
    </div>
  </div>
</section>
<div id="overlay" class="overlay"></div>

<footer class="rodape">
  <div class="wrap">
    <div class="brand">CENTRAL de APOSTAS</div>
    <div class="actions">
      <div id="btnShop" class="acao on">
        <img src="https://betshoptv.com/elementos/ticon-SHOP-b.avif" class="ico" id="iconShop">
        <span id="cntShop" class="cnt hidden">0</span>
        <span class="rotulo">PEÇAS</span>
      </div>
      <div id="btnRifa" class="acao off">
        <img src="https://betshoptv.com/elementos/ticon-RIFA-c.avif" class="ico" id="iconRifa">
        <span id="cntRifa" class="cnt hidden">0</span>
        <span class="rotulo">RIFAS</span>
      </div>
    </div>
  </div>
</footer>

<script>
const PECAS_JSON='/dados/pecas.json';
const RIFAS_JSON='/dados/rifas.json';

let pecas=[], rifas=[];
let carrinho=new Set(), rifasSel=new Set();
let aba='shop', painelAberto=false;

async function loadData(){
  try{
    const [pj,rj]=await Promise.all([fetch(PECAS_JSON),fetch(RIFAS_JSON)]);
    pecas=await pj.json(); rifas=await rj.json();
    pecas=pecas.filter(p=>String(p.status).toUpperCase()!=='VENDIDAAA');
    renderGaleria();
    atualizarContadores();
  }catch(e){console.error(e);}
}

function thumbURL(n){return `img/tmb/${n}.avif`;}
function fallbackURL(n){return `img/fallback/${n}.jpg`;}
function firstThumb(p){return (p.imagens&&p.imagens[0])||'';}
function money(v){return 'R$ '+Number(v||0).toFixed(2).replace('.',',');}

function renderGaleria(){
  const gal=document.getElementById('galeria'); gal.innerHTML='';
  const ordenadas=[...pecas].sort((a,b)=>b.id_peca.localeCompare(a.id_peca));
  ordenadas.forEach((p,i)=>{
    const card=document.createElement('div');card.className='card';
    const img=document.createElement('img');
    const n=firstThumb(p);
    img.src=thumbURL(n); img.onerror=function(){this.src=fallbackURL(n);};
    card.appendChild(img);
    if(carrinho.has(p.id_peca))card.classList.add('selected');
    card.addEventListener('click',()=>{
      if(carrinho.has(p.id_peca))carrinho.delete(p.id_peca);
      else carrinho.add(p.id_peca);
      card.classList.toggle('selected');
      atualizarContadores(); if(painelAberto)renderThumbs();
    });
    gal.appendChild(card);
  });
}

function abrirPainel(){
  painelAberto=true;
  document.getElementById('painel').classList.add('aberto');
  document.getElementById('overlay').classList.add('on');
  renderThumbs();
}
function fecharPainel(){
  painelAberto=false;
  document.getElementById('painel').classList.remove('aberto');
  document.getElementById('overlay').classList.remove('on');
}
function togglePainel(tab){
  if(aba!==tab)aba=tab;
  painelAberto?fecharPainel():abrirPainel();
}
document.getElementById('btnShop').onclick=()=>togglePainel('shop');
document.getElementById('btnRifa').onclick=()=>togglePainel('rifa');
document.getElementById('overlay').onclick=fecharPainel;
document.addEventListener('keydown',e=>{if(e.key==='Escape')fecharPainel();});

function renderThumbs(){
  const area=document.getElementById('thumbs'); area.innerHTML='';
  const lista=[...carrinho].map(id=>pecas.find(p=>p.id_peca===id)).filter(Boolean);
  lista.forEach(p=>{
    const box=document.createElement('div'); box.className='thumb';
    const n=firstThumb(p);
    const im=document.createElement('img');
    im.src=thumbURL(n); im.onerror=function(){this.src=fallbackURL(n);};
    const x=document.createElement('button');x.className='x';x.textContent='×';
    x.onclick=(ev)=>{ev.stopPropagation();carrinho.delete(p.id_peca);renderGaleria();renderThumbs();atualizarContadores();};
    box.append(im,x); area.append(box);
  });
  document.getElementById('total').textContent='TOTAL: '+money(lista.reduce((s,p)=>s+(p.preco||0),0));
}

function atualizarContadores(){
  const n=carrinho.size, r=rifasSel.size;
  const cShop=document.getElementById('cntShop'), cRifa=document.getElementById('cntRifa');
  cShop.textContent=n; cRifa.textContent=r;
  cShop.classList.toggle('hidden',n===0); cRifa.classList.toggle('hidden',r===0);
}

document.getElementById('btnFinalizar').onclick=()=>{
  alert('Peças selecionadas: '+[...carrinho].join(', ')+'\nTotal: '+money([...carrinho].map(id=>pecas.find(p=>p.id_peca===id)?.preco||0).reduce((a,b)=>a+b,0)));
};

loadData();
</script>
</body>
</html>
