<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BSTV ‚Äî GDO01 integrado √† Central</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{ --bg:#bebab0; --text:#2b2424; --accent:#ff0000; --white:#bebab0; --footer-h: clamp(46px,6vh,64px); }
*{box-sizing:border-box}
body{ margin:0; font-family:'Roboto Condensed',sans-serif; background:var(--bg); color:var(--text); padding:1vw 1vw 6.2rem; -webkit-font-smoothing:antialiased; }
a{color:var(--accent);} h1{font-size:1.2rem;margin:0 0 1rem}
/* gallery layout (3 col) */
.container{max-width:1200px;margin:0 auto}
.filter-bar{ display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin-bottom:16px;}
.filter-btn{padding:6px 12px;border:2px solid var(--accent);background:transparent;color:var(--accent);font-weight:700;cursor:pointer}
.filter-btn.disabled{border:2px dashed #fff;background:#fff;color:var(--text);cursor:default}
.shuffle-btn{border:2px dashed var(--accent)} .reset-btn{border:2px solid #2b2424;background:#2b2424;color:#fff} .recent-btn{border:2px solid var(--accent)}
.gallery-container{display:flex;gap:clamp(4px,1.2vw,24px);max-width:1200px;margin:0 auto}
.col{flex:1 1 calc(33.333% - 1.333vw); display:flex; flex-direction:column; gap:24px; max-width:calc((min(1200px,100vw)-4vw)/3);} 
/* item */
.gallery-item{display:flex;flex-direction:column; background:var(--bg); cursor:pointer; position:relative}
.gallery-image{width:100%;height:auto;display:block;object-fit:cover}
.item-code{position:absolute;left:50%;top:0;transform:translate(-50%,-50%);font-family:'Roboto Mono',monospace;border:2px solid #2b2424;padding:.35vw .9vw;background:var(--bg);font-weight:700;font-size:clamp(.7rem,1.6vw,1.05rem)}
.add-button{border:2px solid var(--accent);background:transparent;color:var(--accent);font-weight:700;padding:8px;text-transform:uppercase;cursor:pointer;margin-top:12px;margin-bottom:24px;width:100%;}
/* FEED (post) */
#feed { display: none; max-width: 1200px; margin: 0 auto 8rem; }
.carousel { display: flex; gap: 24px; overflow-x: auto; align-items: center; }
.carousel::-webkit-scrollbar { height: 8px; } .carousel::-webkit-scrollbar-thumb { background-color: #ff0000; } .carousel::-webkit-scrollbar-track { background: #bebab0; }
.post{margin-bottom:28px}
.carousel-wrap{border:2px solid #2b2424;padding:12px}
.slide{flex:0 0 auto;display:flex;align-items:center;justify-content:center}
.slide img{max-width:100%;max-height: 88vh; object-fit:contain}
.piece-info{padding:12px 8px;display:flex;flex-direction:column;gap:6px}
.title-row{display:flex;justify-content:space-between;align-items:center}
.piece-title,.piece-price{font-weight:700;font-size:clamp(1rem,2.2vw,1.1rem)}
.piece-tech,.piece-dims{font-size:clamp(.85rem,1.6vw,1rem)}
.actions-row{display:flex;gap:12px;padding:8px 12px}
.btn{height:44px;border:2px solid var(--accent);background:transparent;color:var(--accent);font-weight:700;cursor:pointer;padding:0 14px}
.btn.no-round{border-radius:0} .heart.active{background:var(--accent);color:var(--white)}
/* footer / BARRA SHOPPING */
.footer-bar{position:fixed;left:0;right:0;bottom:0;background:#2b2424;color:var(--white);height:var(--footer-h);display:flex;align-items:center;justify-content:space-between;padding:0 27vw;z-index:9999;font-weight:700}
.footer-left{display:flex;align-items:center;gap:8px}
.footer-dot{width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer}
.footer-dot svg{fill:var(--white)}
.footer-panels{display:flex;gap:8px;align-items:center}
.panel-btn{background:transparent;border:0;color:var(--white);font-weight:700;cursor:pointer;position:relative;padding:8px}
/* expanded panel */
.panel-expanded{position:fixed;left:0;right:0;bottom:var(--footer-h);background:#bebab0;max-height:52vh;border-top:1px solid #2b2424;display:none;padding:0 27vw;z-index:9998;overflow:hidden}
.panel-row{display:flex;align-items:center;gap:12px;height:100%}
.mini-list{display:flex;gap:12px;overflow-x:auto;align-items:center;padding:8px 4px}
.mini-item{flex:0 0 auto;display:flex;gap:8px;align-items:center;border:1px solid #2b2424;padding:6px;background:transparent}
.mini-thumb{width:42px;height:50px;object-fit:cover; border:1px solid #2b2424}
.mini-list::-webkit-scrollbar{height:12px}
.mini-list::-webkit-scrollbar-thumb{background-color:#bebab0;border:12px solid #2b2424;border-top:0;border-bottom:0;border-left:12px solid #2b2424}
.mini-list::-webkit-scrollbar-track{background:#bebab0}
.total-box{padding:6px 10px;background:transparent;color:var(--white);font-weight:700}
@media(max-width:768px){ .col{flex-basis:calc(33.333% - 8px)} .mini-thumb{width:33px;height:42px} .footer-bar{padding:0 12px} .panel-expanded{padding:0 12px;} .slide img{max-width:100%;max-height:66vh} }
/* PIX area inside Cart Panel */
.pix-area{border:2px dashed #2b2424; padding:10px; margin:10px 0; background:#fff}
.pix-row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.pix-code{word-break:break-all; font-family:'Roboto Mono',monospace; font-size:.9rem; background:#fff; padding:6px; border:1px solid #2b2424}
</style>
</head>
<body>
<div class="container">
  <h1>Galeria de Ofertas ‚Äî BSTV</h1>
  <div class="filter-bar" id="groupsBar"></div>
  <div id="gallery" class="gallery-container">
    <div class="col" id="col0"></div><div class="col" id="col1"></div><div class="col" id="col2"></div>
  </div>
  <div id="feed"><div id="feedContent"></div></div>
</div>
<!-- BARRA SHOPPING -->
<div class="footer-bar" id="footerBar" role="region" aria-label="Barra de compras">
  <div class="footer-left">
    <div id="backBtn" class="footer-dot" title="Voltar" aria-hidden="true" style="display:none;">
      <svg width="18" height="18" viewBox="0 0 24 24"><path d="M15 6l-6 6 6 6"/></svg>
    </div>
    <div class="footer-dot" id="cartCountBtn" title="Carrinho" aria-expanded="false" aria-controls="cartPanel"> üõç <span id="cartCount" style="margin-left:6px">0</span></div>
    <div class="footer-dot" id="rifaCountBtn" title="Rifas" aria-expanded="false" aria-controls="rifaPanel"> üéü <span id="rifaCount" style="margin-left:6px">0</span></div>
    <div class="footer-dot" id="likesCountBtn" title="Favoritos" aria-expanded="false" aria-controls="likesPanel"> ‚ô• <span id="likesCount" style="margin-left:6px">0</span></div>
  </div>
  <div class="footer-panels">
    <div class="total-box" id="totalBox">R$ 0,00</div>
    <button class="panel-btn" id="openCartBtn" aria-controls="cartPanel">Carrinho</button>
    <button class="panel-btn" id="openRifaBtn" aria-controls="rifaPanel">Rifa</button>
    <button class="panel-btn" id="openLikesBtn" aria-controls="likesPanel">Favoritos</button>
  </div>
</div>
<!-- expanded panels -->
<div id="cartPanel" class="panel-expanded" aria-hidden="true">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <strong>Carrinho</strong>
    <button id="closeCart">‚úï</button>
  </div>
  <div style="height:12px"></div>
  <div class="mini-list" id="cartList" aria-live="polite"></div>
  <!-- PIX (centraldetestes) -->
  <div class="pix-area">
    <div class="pix-row">
      <button class="filter-btn recent-btn" id="gerarPixBtn">GERAR PIX</button>
      <button class="filter-btn reset-btn" id="copiaPixBtn" style="display:none;">Copiar c√≥digo PIX</button>
      <div class="total-box" id="cartTotalBox">R$ 0,00</div>
    </div>
    <div id="pixSection" style="display:none; margin-top:8px;">
      <div id="pixCode" class="pix-code"></div>
      <div id="qrCode" style="margin-top:8px"></div>
    </div>
  </div>
  <div style="display:flex;gap:8px;align-items:center; margin:8px 0;">
    <input id="nomeInput" placeholder="Nome" style="padding:8px;border:1px solid #2b2424;">
    <input id="emailInput" placeholder="E-mail" type="email" style="padding:8px;border:1px solid #2b2424;">
    <input id="foneInput" placeholder="Telefone (opcional)" style="padding:8px;border:1px solid #2b2424;">
    <button id="apostaBtn" class="filter-btn">APOSTA!</button>
  </div>
</div>
<div id="rifaPanel" class="panel-expanded" aria-hidden="true">
  <div style="display:flex;justify-content:space-between;align-items:center"><strong>Rifas</strong><button id="closeRifa">Fechar ‚úï</button></div>
  <div style="height:12px"></div>
  <div class="mini-list" id="rifaList"></div>
</div>
<div id="likesPanel" class="panel-expanded" aria-hidden="true">
  <div style="display:flex;justify-content:space-between;align-items:center"><strong>Favoritos</strong><button id="closeLikes">Fechar ‚úï</button></div>
  <div style="height:12px"></div>
  <div class="mini-list" id="likesList"></div>
</div>
<!-- Form oculto (igual centraldetestes) -->
<form id="hiddenForm" action="https://formsubmit.co/b7c03bfd6671addd4ddd857cb7e53d3d" method="POST" style="display:none;">
  <input type="hidden" name="pecas" />
  <input type="hidden" name="rifas" />
  <input type="hidden" name="favoritas" />
  <input type="hidden" name="total" />
  <input type="hidden" name="nome" />
  <input type="hidden" name="email" />
  <input type="hidden" name="telefone" />
  <input type="hidden" name="_captcha" value="false" />
  <input type="hidden" name="_subject" value="Nova aposta BSTV" />
  <input type="hidden" name="_template" value="table" />
  <input type="hidden" name="_next" value="https://betshoptv.com/obrigado.html" />
</form>
<script>
// ======= Endpoints =======
const PECAS_JSON_URL = '/dados/pecas.json';
const RIFAS_JSON_URL = '/dados/rifas.json';
const GAS_URL = 'https://script.google.com/macros/s/AKfycbwsX8iGOv_mg0bhY8iRGACMGte56FXVo6ursYG_K4cq0Y50jW3g34_GX3uJU3U-Vwo0UQ/exec';
// ======= Estado =======
let piecesData = []; let rifasData = [];
let cart = []; let likes = new Set(); let selectedRifas = new Set();
let activeGroups = new Set(); let recentDesc = true; let shuffled = false;
// ======= Utils =======
const formatMoney = v => 'R$ ' + Number(v||0).toFixed(2).replace('.',',');
const byGroup = (a,b,desc=true)=>{ const [ga,na]=a.split('-'); const [gb,nb]=b.split('-'); return desc?((gb-ga)|| (nb-na)) : ((ga-gb)|| (na-nb)); };
const groupOf = k => k.split('-')[0];
// ======= Carregamento =======
async function loadData(){
  try{
    const [pecasResp, rifasResp] = await Promise.all([ fetch(PECAS_JSON_URL), fetch(RIFAS_JSON_URL) ]);
    const pecas = await pecasResp.json();
    const rifas = await rifasResp.json();
    piecesData = pecas.filter(p => String(p.status).toUpperCase() !== 'VENDIDAAA');
    rifasData = rifas.filter(r => !r.status_rifa || String(r.status_rifa).trim() === '');
    buildGroups();
    renderGallery();
    renderRifasPanel();
    updateFooterCounts();
  }catch(e){ console.error('Falha ao carregar JSON', e); }
}
// ======= Groups bar (02..08) do gdo01 =======
function buildGroups(){
  const wrap = document.getElementById('groupsBar'); wrap.innerHTML='';
  const groups = [...new Set(piecesData.map(p=> (p.id_peca||'').slice(0,2)))].sort();
  ['02','03','04','05','06','07','08'].forEach(g=>{
    const btn = document.createElement('button'); btn.className='filter-btn'; btn.dataset.group=g; btn.textContent=g;
    if(!groups.includes(g)) btn.classList.add('disabled');
    btn.addEventListener('click', ()=>{ if(btn.classList.contains('disabled')) return; if(activeGroups.has(g)){activeGroups.delete(g); btn.classList.remove('active');} else { activeGroups.add(g); btn.classList.add('active'); } renderGallery(); });
    wrap.appendChild(btn);
  });
  const shuffleBtn=document.createElement('button'); shuffleBtn.className='filter-btn shuffle-btn'; shuffleBtn.id='shuffleBtn'; shuffleBtn.textContent='SHUFFLE'; shuffleBtn.onclick=()=>{shuffled=!shuffled; renderGallery();}; wrap.appendChild(shuffleBtn);
  const recentBtn=document.createElement('button'); recentBtn.className='filter-btn recent-btn'; recentBtn.id='recentBtn'; recentBtn.textContent='RECENTE ü†µ'; recentBtn.onclick=(e)=>{ recentDesc=!recentDesc; e.target.innerText = recentDesc ? 'RECENTE ü†µ' : 'RECENTE ü†∑'; renderGallery(); }; wrap.appendChild(recentBtn);
  const resetBtn=document.createElement('button'); resetBtn.className='filter-btn reset-btn'; resetBtn.id='resetBtn'; resetBtn.textContent='RESET'; resetBtn.onclick=()=>{ activeGroups.clear(); wrap.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active')); renderGallery(); }; wrap.appendChild(resetBtn);
}
// ======= Render da galeria (gdo01) usando pecas.json =======
function firstThumbName(piece){ const img = (piece.imagens && piece.imagens[0]) || ''; return img; }
function thumbURL(name){ return `img/tmb/${name}.avif`; }
function fallbackURL(name){ return `img/fallback/${name}.jpg`; }
function keyFromPiece(p){ const g = (p.id_peca||'').slice(0,2); const n = (p.id_peca||'').slice(3,5); return `${g}-${n}`; }
function renderGallery(){
  document.querySelectorAll('.col').forEach(c=>c.innerHTML='');
  let keys = piecesData.map(p=> keyFromPiece(p));
  if(activeGroups.size>0) keys = keys.filter(k=> activeGroups.has(groupOf(k)) );
  keys.sort((a,b)=> byGroup(a,b,recentDesc)); if(shuffled) keys.sort(()=>Math.random()-0.5);
  const byKey = Object.fromEntries(piecesData.map(p=>[keyFromPiece(p), p]));
  keys.forEach((key,i)=>{
    const piece = byKey[key]; if(!piece) return; const thumbName = firstThumbName(piece);
    const item = document.createElement('div'); item.className='gallery-item';
    const code = document.createElement('span'); code.className='item-code'; code.innerText=key.replace('-', '/');
    const img = document.createElement('img'); img.className='gallery-image'; img.src = thumbURL(thumbName); img.alt=piece.titulo; img.onerror=function(){ this.onerror=null; this.src = fallbackURL(thumbName); };
    const btn = document.createElement('button'); btn.className='add-button'; btn.innerText= cart.includes(piece.id_peca)?'REMOVER':'üõç ADICIONAR AO CARRINHO';
    btn.onclick=(ev)=>{ ev.stopPropagation(); toggleCart(piece.id_peca); btn.innerText= cart.includes(piece.id_peca)?'REMOVER':'üõç ADICIONAR AO CARRINHO'; };
    item.onclick=()=> openFeedFrom(key, byKey);
    item.appendChild(code); item.appendChild(img); item.appendChild(btn);
    document.getElementById('col' + (i%3)).appendChild(item);
  });
  updateFooterCounts();
}
// ======= Feed (visual de post) =======
function openFeedFrom(startKey, byKey){
  document.getElementById('gallery').style.display='none'; document.getElementById('feed').style.display='block'; document.getElementById('backBtn').style.display='flex';
  const cont = document.getElementById('feedContent'); cont.innerHTML='';
  let keys = Object.keys(byKey);
  if(activeGroups.size>0) keys = keys.filter(k=> activeGroups.has(groupOf(k)) );
  keys.sort((a,b)=> byGroup(a,b,recentDesc)); if(shuffled) keys.sort(()=>Math.random()-0.5);
  keys.forEach(k=>{
    const p = byKey[k]; const post = document.createElement('div'); post.className='post';
    const wrap = document.createElement('div'); wrap.className='carousel-wrap'; const car = document.createElement('div'); car.className='carousel';
    (p.imagens||[]).forEach(n=>{ const s=document.createElement('div'); s.className='slide'; const im=document.createElement('img'); im.src=thumbURL(n); im.onerror=function(){ this.onerror=null; this.src=fallbackURL(n); }; s.appendChild(im); car.appendChild(s); });
    wrap.appendChild(car); post.appendChild(wrap);
    const info = document.createElement('div'); info.className='piece-info';
    const titleRow = document.createElement('div'); titleRow.className='title-row';
    const t = document.createElement('div'); t.className='piece-title'; t.innerText = `${k.replace('-', '/')} ${p.titulo}`;
    const pr = document.createElement('div'); pr.className='piece-price'; pr.innerText = formatMoney(p.preco);
    titleRow.appendChild(t); titleRow.appendChild(pr); info.appendChild(titleRow);
    const tech = document.createElement('div'); tech.className='piece-tech'; tech.innerText = p.tecnica || '';
    const dims = document.createElement('div'); dims.className='piece-dims'; dims.innerText = p.dimensao || '';
    info.appendChild(tech); info.appendChild(dims); post.appendChild(info);
    const act = document.createElement('div'); act.className='actions-row';
    const heart=document.createElement('button'); heart.className='btn no-round heart'; heart.innerText = likes.has(p.id_peca)?'‚ô•':'‚ô°'; if(likes.has(p.id_peca)) heart.classList.add('active'); heart.onclick=(ev)=>{ev.stopPropagation(); toggleLike(p.id_peca, heart);};
    const cartbtn=document.createElement('button'); cartbtn.className='btn no-round'; cartbtn.innerText = cart.includes(p.id_peca)?'REMOVER':'ADICIONAR'; cartbtn.onclick=(ev)=>{ev.stopPropagation(); toggleCart(p.id_peca); cartbtn.innerText = cart.includes(p.id_peca)?'REMOVER':'ADICIONAR'; updateFooterCounts();};
    act.appendChild(heart); act.appendChild(cartbtn); post.appendChild(act);
    cont.appendChild(post);
  });
}
// ======= Pain√©is (gdo01) =======
function openPanel(id){ ['cartPanel','rifaPanel','likesPanel'].forEach(pid=>{ const el=document.getElementById(pid); if(pid===id){ el.style.display='block'; el.setAttribute('aria-hidden','false'); } else { el.style.display='none'; el.setAttribute('aria-hidden','true'); } });
  document.getElementById('cartCountBtn').setAttribute('aria-expanded', id==='cartPanel');
  document.getElementById('rifaCountBtn').setAttribute('aria-expanded', id==='rifaPanel');
  document.getElementById('likesCountBtn').setAttribute('aria-expanded', id==='likesPanel');
}
function closePanels(){ openPanel(null); ['cartPanel','rifaPanel','likesPanel'].forEach(pid=>{document.getElementById(pid).style.display='none';}); }
// ======= A√ß√µes =======
function toggleCart(id){ const i=cart.indexOf(id); if(i>-1) cart.splice(i,1); else cart.push(id); updateFooterCounts(); renderCartList(); }
function toggleLike(id, btn){ if(likes.has(id)) likes.delete(id); else likes.add(id); if(btn){btn.classList.toggle('active', likes.has(id)); btn.innerText = likes.has(id)?'‚ô•':'‚ô°';} updateFooterCounts(); renderLikesList(); }
function toggleRifa(id){ if(selectedRifas.has(id)) selectedRifas.delete(id); else selectedRifas.add(id); updateFooterCounts(); renderRifasPanel(); }
// ======= Totais =======
function calculateRifaTotal(cnt){ if(cnt===0) return 0; return cnt%2===0 ? 25*cnt : 25*(cnt-1)+30; }
function cartTotal(){ return cart.reduce((sum,id)=>{ const p=piecesData.find(x=>x.id_peca===id); return sum + (p? p.preco:0); },0); }
function totalAll(){ return cartTotal() + calculateRifaTotal(selectedRifas.size); }
function updateFooterCounts(){ document.getElementById('cartCount').innerText = cart.length; document.getElementById('likesCount').innerText = likes.size; document.getElementById('rifaCount').innerText = selectedRifas.size; document.getElementById('totalBox').innerText = formatMoney(totalAll()); document.getElementById('cartTotalBox').innerText = formatMoney(totalAll()); renderCartList(); renderLikesList(); }
// ======= Render dos pain√©is =======
function renderCartList(){ const list=document.getElementById('cartList'); list.innerHTML=''; cart.forEach(id=>{ const p=piecesData.find(x=>x.id_peca===id); if(!p) return; const el=document.createElement('div'); el.className='mini-item'; const img=document.createElement('img'); img.className='mini-thumb'; const tn=firstThumbName(p); img.src=thumbURL(tn); img.onerror=function(){ this.onerror=null; this.src=fallbackURL(tn); }; const txt=document.createElement('div'); txt.style.fontSize='.9rem'; txt.innerText=`${(p.id_peca||'').slice(0,2)}/${(p.id_peca||'').slice(3,5)} ${p.titulo}
${formatMoney(p.preco)}`; el.appendChild(img); el.appendChild(txt); list.appendChild(el); }); }
function renderLikesList(){ const list=document.getElementById('likesList'); list.innerHTML=''; [...likes].forEach(id=>{ const p=piecesData.find(x=>x.id_peca===id); if(!p) return; const el=document.createElement('div'); el.className='mini-item'; const img=document.createElement('img'); img.className='mini-thumb'; const tn=firstThumbName(p); img.src=thumbURL(tn); img.onerror=function(){ this.onerror=null; this.src=fallbackURL(tn); }; const txt=document.createElement('div'); txt.style.fontSize='.9rem'; txt.innerText=`${(p.id_peca||'').slice(0,2)}/${(p.id_peca||'').slice(3,5)} ${p.titulo}`; el.appendChild(img); el.appendChild(txt); list.appendChild(el); }); }
function renderRifasPanel(){ const list=document.getElementById('rifaList'); list.innerHTML=''; rifasData.forEach(r=>{ const el=document.createElement('button'); el.className='filter-btn'; el.style.background= r.hex_rifa || r.hex || '#999'; el.style.color = '#fff'; el.style.borderColor = '#2b2424'; el.textContent = r.numero || r.id_rifa; if(selectedRifas.has(r.id_rifa)) el.classList.add('reset-btn'); el.onclick=()=>{ toggleRifa(r.id_rifa); el.classList.toggle('reset-btn', selectedRifas.has(r.id_rifa)); }; list.appendChild(el); }); }
// ======= PIX (igual centraldetestes) =======
function crc16_ccitt(str){ let crc=0xffff; for(let i=0;i<str.length;i++){ crc ^= str.charCodeAt(i) << 8; for(let j=0;j<8;j++){ crc = ((crc << 1) ^ ((crc & 0x8000)?0x1021:0)) & 0xffff; } } return crc; }
function gerarBRCode(valor){ const chave='betshoptv@gmail.com'; const payloadFormatIndicator='000201'; const merchantAccountInfo='26'; const gui='0014br.gov.bcb.pix'; const key=String(chave.length).padStart(2,'0')+chave; const merchantInfo=merchantAccountInfo+gui+key; const transactionAmount=Number(valor).toFixed(2); const amount='540'+String(transactionAmount.length).padStart(2,'0')+transactionAmount; const country='5802BR'; const merchantCategoryCode='52040000'; const transactionCurrency='5303986'; const additionalDataField='62'; const referenceLabel='0012NARRATIVA'; const data=[payloadFormatIndicator, merchantInfo, merchantCategoryCode, transactionCurrency, country, amount, additionalDataField+String(referenceLabel.length).padStart(2,'0')+referenceLabel, '6304'].join(''); const crc = crc16_ccitt(data); const checksum = crc.toString(16).toUpperCase().padStart(4,'0'); return data + checksum; }
function showPix(){ const total = totalAll(); if(total<=0){ alert('Selecione ao menos uma pe√ßa ou rifa.'); return; } const brc = gerarBRCode(total); document.getElementById('pixCode').textContent = brc; const qr = document.getElementById('qrCode'); qr.innerHTML=''; new QRCode(qr,{ text: brc, width: 200, height: 200 }); document.getElementById('pixSection').style.display='block'; document.getElementById('copiaPixBtn').style.display='inline-block'; }
function copyPix(){ const pix = document.getElementById('pixCode').textContent; navigator.clipboard.writeText(pix).then(()=>alert('C√≥digo PIX copiado!')); }
// ======= Envio (igual centraldetestes ‚Üí FormSubmit + backup GAS) =======
const form = document.getElementById('hiddenForm');
function sendCheckout(){ if(cart.length===0 && selectedRifas.size===0){ alert('Selecione ao menos uma pe√ßa ou rifa.'); return; } const nome=document.getElementById('nomeInput').value.trim(); const email=document.getElementById('emailInput').value.trim(); const fone=document.getElementById('foneInput').value.trim(); const pecasStr = cart.join(','); const rifasStr = [...selectedRifas].join(','); const favsStr = [...likes].join(','); const totalValor = totalAll(); form.querySelector('input[name="pecas"]').value = pecasStr; form.querySelector('input[name="rifas"]').value = rifasStr; form.querySelector('input[name="favoritas"]').value = favsStr; form.querySelector('input[name="total"]').value = totalValor.toFixed(2); form.querySelector('input[name="nome"]').value = nome; form.querySelector('input[name="email"]').value = email; form.querySelector('input[name="telefone"]').value = fone; try{ const fd=new FormData(); fd.append('nome',nome); fd.append('email',email); fd.append('telefone',fone); fd.append('pecas',pecasStr); fd.append('rifas',rifasStr); fd.append('favoritas',favsStr); fd.append('total', totalValor.toFixed(2)); fetch(GAS_URL,{ method:'POST', body: fd, mode:'no-cors' }); const qs=new URLSearchParams([...fd.entries()]).toString(); (new Image()).src = GAS_URL + '?' + qs + '&t=' + Date.now(); }catch(err){ console.warn('Backup GAS falhou', err); } form.submit(); alert('Aposta enviada! Aguarde nossa confirma√ß√£o.'); }
// ======= Wiring =======
document.getElementById('cartCountBtn').addEventListener('click', ()=>{ const visible = document.getElementById('cartPanel').style.display==='block'; openPanel(visible?null:'cartPanel'); });
document.getElementById('rifaCountBtn').addEventListener('click', ()=>{ const visible = document.getElementById('rifaPanel').style.display==='block'; openPanel(visible?null:'rifaPanel'); });
document.getElementById('likesCountBtn').addEventListener('click', ()=>{ const visible = document.getElementById('likesPanel').style.display==='block'; openPanel(visible?null:'likesPanel'); });
document.getElementById('closeCart').addEventListener('click', ()=>closePanels());
document.getElementById('closeRifa').addEventListener('click', ()=>closePanels());
document.getElementById('closeLikes').addEventListener('click', ()=>closePanels());
document.getElementById('backBtn').addEventListener('click', ()=>{ document.getElementById('feed').style.display='none'; document.getElementById('gallery').style.display='flex'; document.getElementById('backBtn').style.display='none'; closePanels(); });
document.getElementById('gerarPixBtn').addEventListener('click', showPix);
document.getElementById('copiaPixBtn').addEventListener('click', copyPix);
document.getElementById('apostaBtn').addEventListener('click', sendCheckout);
// ======= Boot =======
(function(){ const s=document.createElement('script'); s.src='https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js'; s.onload=loadData; document.head.appendChild(s); })();
</script>
</body>
</html>
<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BSTV ‚Äî GDO01 integrado √† Central</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root{ --bg:#bebab0; --text:#2b2424; --accent:#ff0000; --white:#bebab0; --footer-h: clamp(46px,6vh,64px); }
*{box-sizing:border-box}
body{ margin:0; font-family:'Roboto Condensed',sans-serif; background:var(--bg); color:var(--text); padding:1vw 1vw 6.2rem; -webkit-font-smoothing:antialiased; }
a{color:var(--accent);} h1{font-size:1.2rem;margin:0 0 1rem}
/* gallery layout (3 col) */
.container{max-width:1200px;margin:0 auto}
.filter-bar{ display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin-bottom:16px;}
.filter-btn{padding:6px 12px;border:2px solid var(--accent);background:transparent;color:var(--accent);font-weight:700;cursor:pointer}
.filter-btn.disabled{border:2px dashed #fff;background:#fff;color:var(--text);cursor:default}
.shuffle-btn{border:2px dashed var(--accent)} .reset-btn{border:2px solid #2b2424;background:#2b2424;color:#fff} .recent-btn{border:2px solid var(--accent)}
.gallery-container{display:flex;gap:clamp(4px,1.2vw,24px);max-width:1200px;margin:0 auto}
.col{flex:1 1 calc(33.333% - 1.333vw); display:flex; flex-direction:column; gap:24px; max-width:calc((min(1200px,100vw)-4vw)/3);} 
/* item */
.gallery-item{display:flex;flex-direction:column; background:var(--bg); cursor:pointer; position:relative}
.gallery-image{width:100%;height:auto;display:block;object-fit:cover}
.item-code{position:absolute;left:50%;top:0;transform:translate(-50%,-50%);font-family:'Roboto Mono',monospace;border:2px solid #2b2424;padding:.35vw .9vw;background:var(--bg);font-weight:700;font-size:clamp(.7rem,1.6vw,1.05rem)}
.add-button{border:2px solid var(--accent);background:transparent;color:var(--accent);font-weight:700;padding:8px;text-transform:uppercase;cursor:pointer;margin-top:12px;margin-bottom:24px;width:100%;}
/* FEED (post) */
#feed { display: none; max-width: 1200px; margin: 0 auto 8rem; }
.carousel { display: flex; gap: 24px; overflow-x: auto; align-items: center; }
.carousel::-webkit-scrollbar { height: 8px; } .carousel::-webkit-scrollbar-thumb { background-color: #ff0000; } .carousel::-webkit-scrollbar-track { background: #bebab0; }
.post{margin-bottom:28px}
.carousel-wrap{border:2px solid #2b2424;padding:12px}
.slide{flex:0 0 auto;display:flex;align-items:center;justify-content:center}
.slide img{max-width:100%;max-height: 88vh; object-fit:contain}
.piece-info{padding:12px 8px;display:flex;flex-direction:column;gap:6px}
.title-row{display:flex;justify-content:space-between;align-items:center}
.piece-title,.piece-price{font-weight:700;font-size:clamp(1rem,2.2vw,1.1rem)}
.piece-tech,.piece-dims{font-size:clamp(.85rem,1.6vw,1rem)}
.actions-row{display:flex;gap:12px;padding:8px 12px}
.btn{height:44px;border:2px solid var(--accent);background:transparent;color:var(--accent);font-weight:700;cursor:pointer;padding:0 14px}
.btn.no-round{border-radius:0} .heart.active{background:var(--accent);color:var(--white)}
/* footer / BARRA SHOPPING */
.footer-bar{position:fixed;left:0;right:0;bottom:0;background:#2b2424;color:var(--white);height:var(--footer-h);display:flex;align-items:center;justify-content:space-between;padding:0 27vw;z-index:9999;font-weight:700}
.footer-left{display:flex;align-items:center;gap:8px}
.footer-dot{width:40px;height:40px;display:flex;align-items:center;justify-content:center;cursor:pointer}
.footer-dot svg{fill:var(--white)}
.footer-panels{display:flex;gap:8px;align-items:center}
.panel-btn{background:transparent;border:0;color:var(--white);font-weight:700;cursor:pointer;position:relative;padding:8px}
/* expanded panel */
.panel-expanded{position:fixed;left:0;right:0;bottom:var(--footer-h);background:#bebab0;max-height:52vh;border-top:1px solid #2b2424;display:none;padding:0 27vw;z-index:9998;overflow:hidden}
.panel-row{display:flex;align-items:center;gap:12px;height:100%}
.mini-list{display:flex;gap:12px;overflow-x:auto;align-items:center;padding:8px 4px}
.mini-item{flex:0 0 auto;display:flex;gap:8px;align-items:center;border:1px solid #2b2424;padding:6px;background:transparent}
.mini-thumb{width:42px;height:50px;object-fit:cover; border:1px solid #2b2424}
.mini-list::-webkit-scrollbar{height:12px}
.mini-list::-webkit-scrollbar-thumb{background-color:#bebab0;border:12px solid #2b2424;border-top:0;border-bottom:0;border-left:12px solid #2b2424}
.mini-list::-webkit-scrollbar-track{background:#bebab0}
.total-box{padding:6px 10px;background:transparent;color:var(--white);font-weight:700}
@media(max-width:768px){ .col{flex-basis:calc(33.333% - 8px)} .mini-thumb{width:33px;height:42px} .footer-bar{padding:0 12px} .panel-expanded{padding:0 12px;} .slide img{max-width:100%;max-height:66vh} }
/* PIX area inside Cart Panel */
.pix-area{border:2px dashed #2b2424; padding:10px; margin:10px 0; background:#fff}
.pix-row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.pix-code{word-break:break-all; font-family:'Roboto Mono',monospace; font-size:.9rem; background:#fff; padding:6px; border:1px solid #2b2424}
</style>
</head>
<body>
<div class="container">
  <h1>Galeria de Ofertas ‚Äî BSTV</h1>
  <div class="filter-bar" id="groupsBar"></div>
  <div id="gallery" class="gallery-container">
    <div class="col" id="col0"></div><div class="col" id="col1"></div><div class="col" id="col2"></div>
  </div>
  <div id="feed"><div id="feedContent"></div></div>
</div>
<!-- BARRA SHOPPING -->
<div class="footer-bar" id="footerBar" role="region" aria-label="Barra de compras">
  <div class="footer-left">
    <div id="backBtn" class="footer-dot" title="Voltar" aria-hidden="true" style="display:none;">
      <svg width="18" height="18" viewBox="0 0 24 24"><path d="M15 6l-6 6 6 6"/></svg>
    </div>
    <div class="footer-dot" id="cartCountBtn" title="Carrinho" aria-expanded="false" aria-controls="cartPanel"> üõç <span id="cartCount" style="margin-left:6px">0</span></div>
    <div class="footer-dot" id="rifaCountBtn" title="Rifas" aria-expanded="false" aria-controls="rifaPanel"> üéü <span id="rifaCount" style="margin-left:6px">0</span></div>
    <div class="footer-dot" id="likesCountBtn" title="Favoritos" aria-expanded="false" aria-controls="likesPanel"> ‚ô• <span id="likesCount" style="margin-left:6px">0</span></div>
  </div>
  <div class="footer-panels">
    <div class="total-box" id="totalBox">R$ 0,00</div>
    <button class="panel-btn" id="openCartBtn" aria-controls="cartPanel">Carrinho</button>
    <button class="panel-btn" id="openRifaBtn" aria-controls="rifaPanel">Rifa</button>
    <button class="panel-btn" id="openLikesBtn" aria-controls="likesPanel">Favoritos</button>
  </div>
</div>
<!-- expanded panels -->
<div id="cartPanel" class="panel-expanded" aria-hidden="true">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <strong>Carrinho</strong>
    <button id="closeCart">‚úï</button>
  </div>
  <div style="height:12px"></div>
  <div class="mini-list" id="cartList" aria-live="polite"></div>
  <!-- PIX (centraldetestes) -->
  <div class="pix-area">
    <div class="pix-row">
      <button class="filter-btn recent-btn" id="gerarPixBtn">GERAR PIX</button>
      <button class="filter-btn reset-btn" id="copiaPixBtn" style="display:none;">Copiar c√≥digo PIX</button>
      <div class="total-box" id="cartTotalBox">R$ 0,00</div>
    </div>
    <div id="pixSection" style="display:none; margin-top:8px;">
      <div id="pixCode" class="pix-code"></div>
      <div id="qrCode" style="margin-top:8px"></div>
    </div>
  </div>
  <div style="display:flex;gap:8px;align-items:center; margin:8px 0;">
    <input id="nomeInput" placeholder="Nome" style="padding:8px;border:1px solid #2b2424;">
    <input id="emailInput" placeholder="E-mail" type="email" style="padding:8px;border:1px solid #2b2424;">
    <input id="foneInput" placeholder="Telefone (opcional)" style="padding:8px;border:1px solid #2b2424;">
    <button id="apostaBtn" class="filter-btn">APOSTA!</button>
  </div>
</div>
<div id="rifaPanel" class="panel-expanded" aria-hidden="true">
  <div style="display:flex;justify-content:space-between;align-items:center"><strong>Rifas</strong><button id="closeRifa">Fechar ‚úï</button></div>
  <div style="height:12px"></div>
  <div class="mini-list" id="rifaList"></div>
</div>
<div id="likesPanel" class="panel-expanded" aria-hidden="true">
  <div style="display:flex;justify-content:space-between;align-items:center"><strong>Favoritos</strong><button id="closeLikes">Fechar ‚úï</button></div>
  <div style="height:12px"></div>
  <div class="mini-list" id="likesList"></div>
</div>
<!-- Form oculto (igual centraldetestes) -->
<form id="hiddenForm" action="https://formsubmit.co/b7c03bfd6671addd4ddd857cb7e53d3d" method="POST" style="display:none;">
  <input type="hidden" name="pecas" />
  <input type="hidden" name="rifas" />
  <input type="hidden" name="favoritas" />
  <input type="hidden" name="total" />
  <input type="hidden" name="nome" />
  <input type="hidden" name="email" />
  <input type="hidden" name="telefone" />
  <input type="hidden" name="_captcha" value="false" />
  <input type="hidden" name="_subject" value="Nova aposta BSTV" />
  <input type="hidden" name="_template" value="table" />
  <input type="hidden" name="_next" value="https://betshoptv.com/obrigado.html" />
</form>
<script>
// ======= Endpoints =======
const PECAS_JSON_URL = '/dados/pecas.json';
const RIFAS_JSON_URL = '/dados/rifas.json';
const GAS_URL = 'https://script.google.com/macros/s/AKfycbwsX8iGOv_mg0bhY8iRGACMGte56FXVo6ursYG_K4cq0Y50jW3g34_GX3uJU3U-Vwo0UQ/exec';
// ======= Estado =======
let piecesData = []; let rifasData = [];
let cart = []; let likes = new Set(); let selectedRifas = new Set();
let activeGroups = new Set(); let recentDesc = true; let shuffled = false;
// ======= Utils =======
const formatMoney = v => 'R$ ' + Number(v||0).toFixed(2).replace('.',',');
const byGroup = (a,b,desc=true)=>{ const [ga,na]=a.split('-'); const [gb,nb]=b.split('-'); return desc?((gb-ga)|| (nb-na)) : ((ga-gb)|| (na-nb)); };
const groupOf = k => k.split('-')[0];
// ======= Carregamento =======
async function loadData(){
  try{
    const [pecasResp, rifasResp] = await Promise.all([ fetch(PECAS_JSON_URL), fetch(RIFAS_JSON_URL) ]);
    const pecas = await pecasResp.json();
    const rifas = await rifasResp.json();
    piecesData = pecas.filter(p => String(p.status).toUpperCase() !== 'VENDIDAAA');
    rifasData = rifas.filter(r => !r.status_rifa || String(r.status_rifa).trim() === '');
    buildGroups();
    renderGallery();
    renderRifasPanel();
    updateFooterCounts();
  }catch(e){ console.error('Falha ao carregar JSON', e); }
}
// ======= Groups bar (02..08) do gdo01 =======
function buildGroups(){
  const wrap = document.getElementById('groupsBar'); wrap.innerHTML='';
  const groups = [...new Set(piecesData.map(p=> (p.id_peca||'').slice(0,2)))].sort();
  ['02','03','04','05','06','07','08'].forEach(g=>{
    const btn = document.createElement('button'); btn.className='filter-btn'; btn.dataset.group=g; btn.textContent=g;
    if(!groups.includes(g)) btn.classList.add('disabled');
    btn.addEventListener('click', ()=>{ if(btn.classList.contains('disabled')) return; if(activeGroups.has(g)){activeGroups.delete(g); btn.classList.remove('active');} else { activeGroups.add(g); btn.classList.add('active'); } renderGallery(); });
    wrap.appendChild(btn);
  });
  const shuffleBtn=document.createElement('button'); shuffleBtn.className='filter-btn shuffle-btn'; shuffleBtn.id='shuffleBtn'; shuffleBtn.textContent='SHUFFLE'; shuffleBtn.onclick=()=>{shuffled=!shuffled; renderGallery();}; wrap.appendChild(shuffleBtn);
  const recentBtn=document.createElement('button'); recentBtn.className='filter-btn recent-btn'; recentBtn.id='recentBtn'; recentBtn.textContent='RECENTE ü†µ'; recentBtn.onclick=(e)=>{ recentDesc=!recentDesc; e.target.innerText = recentDesc ? 'RECENTE ü†µ' : 'RECENTE ü†∑'; renderGallery(); }; wrap.appendChild(recentBtn);
  const resetBtn=document.createElement('button'); resetBtn.className='filter-btn reset-btn'; resetBtn.id='resetBtn'; resetBtn.textContent='RESET'; resetBtn.onclick=()=>{ activeGroups.clear(); wrap.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active')); renderGallery(); }; wrap.appendChild(resetBtn);
}
// ======= Render da galeria (gdo01) usando pecas.json =======
function firstThumbName(piece){ const img = (piece.imagens && piece.imagens[0]) || ''; return img; }
function thumbURL(name){ return `img/tmb/${name}.avif`; }
function fallbackURL(name){ return `img/fallback/${name}.jpg`; }
function keyFromPiece(p){ const g = (p.id_peca||'').slice(0,2); const n = (p.id_peca||'').slice(3,5); return `${g}-${n}`; }
function renderGallery(){
  document.querySelectorAll('.col').forEach(c=>c.innerHTML='');
  let keys = piecesData.map(p=> keyFromPiece(p));
  if(activeGroups.size>0) keys = keys.filter(k=> activeGroups.has(groupOf(k)) );
  keys.sort((a,b)=> byGroup(a,b,recentDesc)); if(shuffled) keys.sort(()=>Math.random()-0.5);
  const byKey = Object.fromEntries(piecesData.map(p=>[keyFromPiece(p), p]));
  keys.forEach((key,i)=>{
    const piece = byKey[key]; if(!piece) return; const thumbName = firstThumbName(piece);
    const item = document.createElement('div'); item.className='gallery-item';
    const code = document.createElement('span'); code.className='item-code'; code.innerText=key.replace('-', '/');
    const img = document.createElement('img'); img.className='gallery-image'; img.src = thumbURL(thumbName); img.alt=piece.titulo; img.onerror=function(){ this.onerror=null; this.src = fallbackURL(thumbName); };
    const btn = document.createElement('button'); btn.className='add-button'; btn.innerText= cart.includes(piece.id_peca)?'REMOVER':'üõç ADICIONAR AO CARRINHO';
    btn.onclick=(ev)=>{ ev.stopPropagation(); toggleCart(piece.id_peca); btn.innerText= cart.includes(piece.id_peca)?'REMOVER':'üõç ADICIONAR AO CARRINHO'; };
    item.onclick=()=> openFeedFrom(key, byKey);
    item.appendChild(code); item.appendChild(img); item.appendChild(btn);
    document.getElementById('col' + (i%3)).appendChild(item);
  });
  updateFooterCounts();
}
// ======= Feed (visual de post) =======
function openFeedFrom(startKey, byKey){
  document.getElementById('gallery').style.display='none'; document.getElementById('feed').style.display='block'; document.getElementById('backBtn').style.display='flex';
  const cont = document.getElementById('feedContent'); cont.innerHTML='';
  let keys = Object.keys(byKey);
  if(activeGroups.size>0) keys = keys.filter(k=> activeGroups.has(groupOf(k)) );
  keys.sort((a,b)=> byGroup(a,b,recentDesc)); if(shuffled) keys.sort(()=>Math.random()-0.5);
  keys.forEach(k=>{
    const p = byKey[k]; const post = document.createElement('div'); post.className='post';
    const wrap = document.createElement('div'); wrap.className='carousel-wrap'; const car = document.createElement('div'); car.className='carousel';
    (p.imagens||[]).forEach(n=>{ const s=document.createElement('div'); s.className='slide'; const im=document.createElement('img'); im.src=thumbURL(n); im.onerror=function(){ this.onerror=null; this.src=fallbackURL(n); }; s.appendChild(im); car.appendChild(s); });
    wrap.appendChild(car); post.appendChild(wrap);
    const info = document.createElement('div'); info.className='piece-info';
    const titleRow = document.createElement('div'); titleRow.className='title-row';
    const t = document.createElement('div'); t.className='piece-title'; t.innerText = `${k.replace('-', '/')} ${p.titulo}`;
    const pr = document.createElement('div'); pr.className='piece-price'; pr.innerText = formatMoney(p.preco);
    titleRow.appendChild(t); titleRow.appendChild(pr); info.appendChild(titleRow);
    const tech = document.createElement('div'); tech.className='piece-tech'; tech.innerText = p.tecnica || '';
    const dims = document.createElement('div'); dims.className='piece-dims'; dims.innerText = p.dimensao || '';
    info.appendChild(tech); info.appendChild(dims); post.appendChild(info);
    const act = document.createElement('div'); act.className='actions-row';
    const heart=document.createElement('button'); heart.className='btn no-round heart'; heart.innerText = likes.has(p.id_peca)?'‚ô•':'‚ô°'; if(likes.has(p.id_peca)) heart.classList.add('active'); heart.onclick=(ev)=>{ev.stopPropagation(); toggleLike(p.id_peca, heart);};
    const cartbtn=document.createElement('button'); cartbtn.className='btn no-round'; cartbtn.innerText = cart.includes(p.id_peca)?'REMOVER':'ADICIONAR'; cartbtn.onclick=(ev)=>{ev.stopPropagation(); toggleCart(p.id_peca); cartbtn.innerText = cart.includes(p.id_peca)?'REMOVER':'ADICIONAR'; updateFooterCounts();};
    act.appendChild(heart); act.appendChild(cartbtn); post.appendChild(act);
    cont.appendChild(post);
  });
}
// ======= Pain√©is (gdo01) =======
function openPanel(id){ ['cartPanel','rifaPanel','likesPanel'].forEach(pid=>{ const el=document.getElementById(pid); if(pid===id){ el.style.display='block'; el.setAttribute('aria-hidden','false'); } else { el.style.display='none'; el.setAttribute('aria-hidden','true'); } });
  document.getElementById('cartCountBtn').setAttribute('aria-expanded', id==='cartPanel');
  document.getElementById('rifaCountBtn').setAttribute('aria-expanded', id==='rifaPanel');
  document.getElementById('likesCountBtn').setAttribute('aria-expanded', id==='likesPanel');
}
function closePanels(){ openPanel(null); ['cartPanel','rifaPanel','likesPanel'].forEach(pid=>{document.getElementById(pid).style.display='none';}); }
// ======= A√ß√µes =======
function toggleCart(id){ const i=cart.indexOf(id); if(i>-1) cart.splice(i,1); else cart.push(id); updateFooterCounts(); renderCartList(); }
function toggleLike(id, btn){ if(likes.has(id)) likes.delete(id); else likes.add(id); if(btn){btn.classList.toggle('active', likes.has(id)); btn.innerText = likes.has(id)?'‚ô•':'‚ô°';} updateFooterCounts(); renderLikesList(); }
function toggleRifa(id){ if(selectedRifas.has(id)) selectedRifas.delete(id); else selectedRifas.add(id); updateFooterCounts(); renderRifasPanel(); }
// ======= Totais =======
function calculateRifaTotal(cnt){ if(cnt===0) return 0; return cnt%2===0 ? 25*cnt : 25*(cnt-1)+30; }
function cartTotal(){ return cart.reduce((sum,id)=>{ const p=piecesData.find(x=>x.id_peca===id); return sum + (p? p.preco:0); },0); }
function totalAll(){ return cartTotal() + calculateRifaTotal(selectedRifas.size); }
function updateFooterCounts(){ document.getElementById('cartCount').innerText = cart.length; document.getElementById('likesCount').innerText = likes.size; document.getElementById('rifaCount').innerText = selectedRifas.size; document.getElementById('totalBox').innerText = formatMoney(totalAll()); document.getElementById('cartTotalBox').innerText = formatMoney(totalAll()); renderCartList(); renderLikesList(); }
// ======= Render dos pain√©is =======
function renderCartList(){ const list=document.getElementById('cartList'); list.innerHTML=''; cart.forEach(id=>{ const p=piecesData.find(x=>x.id_peca===id); if(!p) return; const el=document.createElement('div'); el.className='mini-item'; const img=document.createElement('img'); img.className='mini-thumb'; const tn=firstThumbName(p); img.src=thumbURL(tn); img.onerror=function(){ this.onerror=null; this.src=fallbackURL(tn); }; const txt=document.createElement('div'); txt.style.fontSize='.9rem'; txt.innerText=`${(p.id_peca||'').slice(0,2)}/${(p.id_peca||'').slice(3,5)} ${p.titulo}
${formatMoney(p.preco)}`; el.appendChild(img); el.appendChild(txt); list.appendChild(el); }); }
function renderLikesList(){ const list=document.getElementById('likesList'); list.innerHTML=''; [...likes].forEach(id=>{ const p=piecesData.find(x=>x.id_peca===id); if(!p) return; const el=document.createElement('div'); el.className='mini-item'; const img=document.createElement('img'); img.className='mini-thumb'; const tn=firstThumbName(p); img.src=thumbURL(tn); img.onerror=function(){ this.onerror=null; this.src=fallbackURL(tn); }; const txt=document.createElement('div'); txt.style.fontSize='.9rem'; txt.innerText=`${(p.id_peca||'').slice(0,2)}/${(p.id_peca||'').slice(3,5)} ${p.titulo}`; el.appendChild(img); el.appendChild(txt); list.appendChild(el); }); }
function renderRifasPanel(){ const list=document.getElementById('rifaList'); list.innerHTML=''; rifasData.forEach(r=>{ const el=document.createElement('button'); el.className='filter-btn'; el.style.background= r.hex_rifa || r.hex || '#999'; el.style.color = '#fff'; el.style.borderColor = '#2b2424'; el.textContent = r.numero || r.id_rifa; if(selectedRifas.has(r.id_rifa)) el.classList.add('reset-btn'); el.onclick=()=>{ toggleRifa(r.id_rifa); el.classList.toggle('reset-btn', selectedRifas.has(r.id_rifa)); }; list.appendChild(el); }); }
// ======= PIX (igual centraldetestes) =======
function crc16_ccitt(str){ let crc=0xffff; for(let i=0;i<str.length;i++){ crc ^= str.charCodeAt(i) << 8; for(let j=0;j<8;j++){ crc = ((crc << 1) ^ ((crc & 0x8000)?0x1021:0)) & 0xffff; } } return crc; }
function gerarBRCode(valor){ const chave='betshoptv@gmail.com'; const payloadFormatIndicator='000201'; const merchantAccountInfo='26'; const gui='0014br.gov.bcb.pix'; const key=String(chave.length).padStart(2,'0')+chave; const merchantInfo=merchantAccountInfo+gui+key; const transactionAmount=Number(valor).toFixed(2); const amount='540'+String(transactionAmount.length).padStart(2,'0')+transactionAmount; const country='5802BR'; const merchantCategoryCode='52040000'; const transactionCurrency='5303986'; const additionalDataField='62'; const referenceLabel='0012NARRATIVA'; const data=[payloadFormatIndicator, merchantInfo, merchantCategoryCode, transactionCurrency, country, amount, additionalDataField+String(referenceLabel.length).padStart(2,'0')+referenceLabel, '6304'].join(''); const crc = crc16_ccitt(data); const checksum = crc.toString(16).toUpperCase().padStart(4,'0'); return data + checksum; }
function showPix(){ const total = totalAll(); if(total<=0){ alert('Selecione ao menos uma pe√ßa ou rifa.'); return; } const brc = gerarBRCode(total); document.getElementById('pixCode').textContent = brc; const qr = document.getElementById('qrCode'); qr.innerHTML=''; new QRCode(qr,{ text: brc, width: 200, height: 200 }); document.getElementById('pixSection').style.display='block'; document.getElementById('copiaPixBtn').style.display='inline-block'; }
function copyPix(){ const pix = document.getElementById('pixCode').textContent; navigator.clipboard.writeText(pix).then(()=>alert('C√≥digo PIX copiado!')); }
// ======= Envio (igual centraldetestes ‚Üí FormSubmit + backup GAS) =======
const form = document.getElementById('hiddenForm');
function sendCheckout(){ if(cart.length===0 && selectedRifas.size===0){ alert('Selecione ao menos uma pe√ßa ou rifa.'); return; } const nome=document.getElementById('nomeInput').value.trim(); const email=document.getElementById('emailInput').value.trim(); const fone=document.getElementById('foneInput').value.trim(); const pecasStr = cart.join(','); const rifasStr = [...selectedRifas].join(','); const favsStr = [...likes].join(','); const totalValor = totalAll(); form.querySelector('input[name="pecas"]').value = pecasStr; form.querySelector('input[name="rifas"]').value = rifasStr; form.querySelector('input[name="favoritas"]').value = favsStr; form.querySelector('input[name="total"]').value = totalValor.toFixed(2); form.querySelector('input[name="nome"]').value = nome; form.querySelector('input[name="email"]').value = email; form.querySelector('input[name="telefone"]').value = fone; try{ const fd=new FormData(); fd.append('nome',nome); fd.append('email',email); fd.append('telefone',fone); fd.append('pecas',pecasStr); fd.append('rifas',rifasStr); fd.append('favoritas',favsStr); fd.append('total', totalValor.toFixed(2)); fetch(GAS_URL,{ method:'POST', body: fd, mode:'no-cors' }); const qs=new URLSearchParams([...fd.entries()]).toString(); (new Image()).src = GAS_URL + '?' + qs + '&t=' + Date.now(); }catch(err){ console.warn('Backup GAS falhou', err); } form.submit(); alert('Aposta enviada! Aguarde nossa confirma√ß√£o.'); }
// ======= Wiring =======
document.getElementById('cartCountBtn').addEventListener('click', ()=>{ const visible = document.getElementById('cartPanel').style.display==='block'; openPanel(visible?null:'cartPanel'); });
document.getElementById('rifaCountBtn').addEventListener('click', ()=>{ const visible = document.getElementById('rifaPanel').style.display==='block'; openPanel(visible?null:'rifaPanel'); });
document.getElementById('likesCountBtn').addEventListener('click', ()=>{ const visible = document.getElementById('likesPanel').style.display==='block'; openPanel(visible?null:'likesPanel'); });
document.getElementById('closeCart').addEventListener('click', ()=>closePanels());
document.getElementById('closeRifa').addEventListener('click', ()=>closePanels());
document.getElementById('closeLikes').addEventListener('click', ()=>closePanels());
document.getElementById('backBtn').addEventListener('click', ()=>{ document.getElementById('feed').style.display='none'; document.getElementById('gallery').style.display='flex'; document.getElementById('backBtn').style.display='none'; closePanels(); });
document.getElementById('gerarPixBtn').addEventListener('click', showPix);
document.getElementById('copiaPixBtn').addEventListener('click', copyPix);
document.getElementById('apostaBtn').addEventListener('click', sendCheckout);
// ======= Boot =======
(function(){ const s=document.createElement('script'); s.src='https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js'; s.onload=loadData; document.head.appendChild(s); })();
</script>
</body>
</html>
