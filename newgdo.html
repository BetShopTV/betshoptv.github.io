<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BSTV – Galeria de Ofertas (Núcleo Consolidado)</title>

<!-- PALETA / TIPOGRAFIA -->
<style>
  :root{
    --vermelho:#ff0000;
    --branco:#ffffff;
    --bege:#bebab0;
    --preto:#2b2424;

    --max-container:1200px;     /* largura máx. do conjunto 3 colunas */
    --gutter:8px;               /* espaçamento entre cards */
    --margem-mobile:4px;        /* borda lateral mínima nos celulares */

    /* tamanhos base escaláveis */
    --fz-rodape: clamp(12px, 1.7vw, 16px);
    --fz-titulo-rodape: clamp(14px, 2vw, 18px);
    --h-rodape: 56px;           /* altura da barra vermelha */
    --h-painel: 30vh;           /* altura máx. do painel branco */
    --thumb-h: 120px;           /* altura dos thumbs no painel */
    --faixa-resumo-h: 64px;     /* bloco TOTAL + FINALIZAR */
    --borda-sel: 2px;           /* borda vermelha quando selecionado */
  }

  /* reset seco */
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%;background:var(--bege);color:var(--preto);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
  a,button{color:inherit}

  /* CONTÊINER MESTRE (3 colunas SEMPRE) */
  .wrap{
    max-width:var(--max-container);
    margin:0 auto;
    padding:0 var(--margem-mobile);
  }

  /* GRADE DE 3 COLUNAS – sempre */
  .grid{
    display:grid;
    grid-template-columns:repeat(3, 1fr);
    gap:var(--gutter);
    padding-bottom: calc(var(--h-rodape) + 12px);
  }

  .card{
    position:relative;
    border:1px solid transparent; /* sem borda por padrão */
    background:transparent;
  }
  .card.selected{
    border:var(--borda-sel) solid var(--vermelho);
  }

  .card .imgbox{
    width:100%;
    background:#ddd;
  }
  .card img{
    display:block;
    width:100%;
    height:auto;           /* mantém proporção (altura livre) */
  }

  /* ============= RODAPÉ ============= */
  .footer-shell{
    position:fixed;
    left:0; right:0; bottom:0;
    background:var(--vermelho);
    height:var(--h-rodape);
    z-index:999;
    border-top:0; /* sem linha preta entre áreas */
  }

  /* conteúdo do rodapé acompanha a largura do painel branco */
  .footer-inner{
    max-width:var(--max-container);
    margin:0 auto;
    height:100%;
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:0 var(--margem-mobile);
    user-select:none;
    cursor:pointer; /* toda a barra abre/fecha */
  }

  .rodape-left{
    display:flex;
    align-items:center;
    gap:12px;
    color:var(--branco);
    font-weight:700;
    font-stretch:condensed;
    font-size:var(--fz-titulo-rodape);
    letter-spacing:0.02em;
    text-transform:uppercase;
  }

  .rodape-right{
    display:flex;
    align-items:center;
    gap:18px; /* mais respiro entre ícones */
  }

  .rodape-item{
    display:flex;
    align-items:center;
    gap:8px;
    color:var(--bege);    /* inativo */
    font-weight:700;
    font-size:var(--fz-rodape);
    text-transform:uppercase;
  }
  .rodape-item.active{ color:var(--branco); }

  .rodape-item img{
    width:22px; height:22px; display:block;
  }

  .badge{
    position:relative;
    min-width:18px;
    height:18px;
    padding:0 4px;
    border-radius:999px; /* badge redondo */
    background:var(--branco);
    color:var(--vermelho);
    font-size:12px;
    font-weight:800;
    line-height:18px;
    text-align:center;
    margin-left:2px;
  }
  .badge.hidden{ display:none; }

  /* ============= PAINEL BRANCO (expansão) ============= */
  .panel-wrap{
    position:fixed;
    left:0; right:0;
    bottom: var(--h-rodape);
    background:transparent; /* “seco”, sem sombra */
    z-index:998;
    display:none; /* fechado por padrão */
  }
  .panel-inner{
    max-width:var(--max-container);
    margin:0 auto;
    background:var(--branco);
    border-top:2px solid var(--branco); /* topo branco */
  }

  .panel-thumbs{
    display:flex;
    gap:12px;
    overflow-x:auto;
    padding:12px var(--margem-mobile) 8px var(--margem-mobile);
    scrollbar-color: var(--vermelho) var(--bege);
    scrollbar-width: thin;
  }
  .panel-thumbs::-webkit-scrollbar{height:6px}
  .panel-thumbs::-webkit-scrollbar-thumb{background:var(--vermelho)}
  .panel-thumbs::-webkit-scrollbar-track{background:var(--bege)}

  .thumb{
    position:relative;
    flex:0 0 auto;
    border:1px solid var(--preto);
    padding:4px;
    background:var(--branco);
  }
  .thumb img{
    display:block;
    height:var(--thumb-h);
    width:auto;
  }
  .thumb .close{
    position:absolute; top:2px; right:2px;
    width:18px; height:18px;
    border:1px solid var(--preto);
    background:var(--branco);
    color:var(--preto);
    font-size:12px;
    line-height:16px;
    text-align:center;
    cursor:pointer;
  }

  .panel-resume{
    display:flex;
    align-items:center;
    justify-content:space-between;
    border-top:1px solid var(--bege);
    padding:10px var(--margem-mobile);
    height:var(--faixa-resumo-h);
  }
  .total{
    font-weight:800;
    color:var(--preto);
    font-size: clamp(14px, 2vw, 18px);
  }
  .btn-finalizar{
    border:0;
    background:var(--preto);
    color:var(--branco);
    padding:10px 18px;
    font-weight:800;
    text-transform:uppercase;
    cursor:pointer;
  }

  /* Clique-fora abrangente (para fechar painel) */
  .click-guard{
    position:fixed;
    inset:0;
    background:transparent;
    display:none; /* só ativa quando painel estiver aberto */
    z-index:997;
  }
</style>
</head>
<body>

<main class="wrap">
  <!-- GRADE DE 3 COLUNAS (id decrescente) -->
  <section id="grid" class="grid" aria-label="Galeria de Ofertas"></section>
</main>

<!-- PAINEL BRANCO (expansão) -->
<section id="panelWrap" class="panel-wrap" aria-label="Painel de Apostas">
  <div class="panel-inner">
    <div id="thumbs" class="panel-thumbs" aria-label="Selecionadas"></div>
    <div class="panel-resume">
      <div id="total" class="total">TOTAL: R$ 0,00</div>
      <button id="finalizar" class="btn-finalizar">Finalizar Aposta</button>
    </div>
  </div>
</section>

<!-- RODAPÉ VERMELHO -->
<footer id="footer" class="footer-shell" aria-label="Central de Apostas">
  <div class="footer-inner">
    <div class="rodape-left">CENTRAL de APOSTAS</div>

    <div class="rodape-right">
      <!-- PEÇAS -->
      <div id="tabPecas" class="rodape-item active" data-tab="pecas">
        <img id="iconPecas" alt="Peças"
             src="https://betshoptv.com/elementos/ticon-SHOP-b.avif">
        <span>Peças</span>
        <span id="badgePecas" class="badge hidden">0</span>
      </div>

      <!-- RIFAS -->
      <div id="tabRifas" class="rodape-item" data-tab="rifas">
        <img id="iconRifas" alt="Rifas"
             src="https://betshoptv.com/elementos/ticon-RIFA-c.avif">
        <span>Rifas</span>
        <span id="badgeRifas" class="badge hidden">0</span>
      </div>
    </div>
  </div>
</footer>

<!-- CLICAR FORA PRA FECHAR -->
<div id="guard" class="click-guard" aria-hidden="true"></div>

<script>
/* ===========================================================
   Núcleo BSTV – Base funcional consolidada
   - Mantém leitura JSON simples (como newgdo30)
   - Seleção múltipla
   - 3 colunas sempre
   - Rodapé vermelho + Painel branco (thumbs em cima, total+finalizar embaixo)
   - Ícones com contadores (badge branco texto vermelho)
   =========================================================== */

const EL = {
  grid:      document.getElementById('grid'),
  panelWrap: document.getElementById('panelWrap'),
  thumbs:    document.getElementById('thumbs'),
  total:     document.getElementById('total'),
  finalizar: document.getElementById('finalizar'),

  footer:    document.getElementById('footer'),
  tabPecas:  document.getElementById('tabPecas'),
  tabRifas:  document.getElementById('tabRifas'),

  iconPecas: document.getElementById('iconPecas'),
  iconRifas: document.getElementById('iconRifas'),
  badgePecas:document.getElementById('badgePecas'),
  badgeRifas:document.getElementById('badgeRifas'),

  guard:     document.getElementById('guard'),
};

const ICONS = {
  pecas_on: "https://betshoptv.com/elementos/ticon-SHOP-b.avif",
  pecas_off:"https://betshoptv.com/elementos/ticon-SHOP-c.avif",
  rifas_on: "https://betshoptv.com/elementos/ticon-RIFA-b.avif",
  rifas_off:"https://betshoptv.com/elementos/ticon-RIFA-c.avif",
};

const state = {
  pecas: [],              // catálogo (vindo do JSON)
  selecionadas: new Map(),// id_peca -> objeto peça
  painelAberto: false,
  abaAtiva: 'pecas',      // 'pecas' | 'rifas' (estrutura pronta p/ rifas)
};

/* ----------------- Carregar JSON (mantendo lógica do newgdo30) ----------------- */
async function carregarPecas() {
  try{
    // Tente buscar o JSON externo (mesma convenção simples)
    const r = await fetch('pecas.json', {cache:'no-store'});
    if(!r.ok) throw new Error('Sem pecas.json');
    const data = await r.json();
    return data;
  }catch(e){
    // FALLBACK equivalente (mesmo formato)
    return [
      {"id_peca":"0407","titulo":"04/07 Peça 02","preco":150,"status":"X","tecnica":"—","dimensao":"—","imagens":["04-07a"]},
      {"id_peca":"0406","titulo":"04/06 Peça 01","preco":150,"status":"X","tecnica":"—","dimensao":"—","imagens":["04-06a"]},
      {"id_peca":"0405","titulo":"04/05 Peça 01","preco":150,"status":"X","tecnica":"—","dimensao":"—","imagens":["04-05a"]},
      {"id_peca":"0404","titulo":"04/04 Peça 01","preco":150,"status":"X","tecnica":"—","dimensao":"—","imagens":["04-04a"]},
      {"id_peca":"0311","titulo":"03/11 Peça 11","preco":150,"status":"X","tecnica":"—","dimensao":"—","imagens":["03-11a"]},
      {"id_peca":"0310","titulo":"03/10 Peça 10","preco":150,"status":"X","tecnica":"—","dimensao":"—","imagens":["03-10a"]},
      {"id_peca":"0305","titulo":"03/05 Peça 05","preco":150,"status":"X","tecnica":"—","dimensao":"—","imagens":["03-05a"]},
      {"id_peca":"0304","titulo":"03/04 Peça 04","preco":150,"status":"X","tecnica":"—","dimensao":"—","imagens":["03-04a"]},
    ];
  }
}

/* ----------------- Renderização da grade (3 colunas sempre) ----------------- */
function ordenarDesc(a,b){
  // numérico a partir de id_peca (ex.: "0407")
  return Number(b.id_peca) - Number(a.id_peca);
}

function primeiraImagem(peca){
  // mesma convenção do newgdo30: imagens[0] -> <id>.jpg em /imagens
  // ajuste a URL conforme sua estrutura real
  const nome = peca.imagens && peca.imagens.length ? peca.imagens[0] : peca.id_peca;
  // exemplo estático (troque para sua pasta final)
  return `https://betshoptv.com/imagens/${nome}.jpg`;
}

function renderGrid(){
  EL.grid.innerHTML = '';
  const frag = document.createDocumentFragment();

  state.pecas.sort(ordenarDesc).forEach(peca=>{
    const card = document.createElement('article');
    card.className = 'card';
    card.dataset.id = peca.id_peca;

    // ativa visual se já estiver selecionada
    if(state.selecionadas.has(peca.id_peca)) card.classList.add('selected');

    const box = document.createElement('div');
    box.className = 'imgbox';

    const img = document.createElement('img');
    img.src = primeiraImagem(peca);
    img.alt = peca.titulo || peca.id_peca;

    box.appendChild(img);
    card.appendChild(box);

    // clique seleciona/deseleciona (múltiplo)
    card.addEventListener('click', ()=>toggleSelecionada(peca));

    frag.appendChild(card);
  });

  EL.grid.appendChild(frag);
}

/* ----------------- Seleção múltipla (sincronizada com painel) ----------------- */
function toggleSelecionada(peca){
  const id = peca.id_peca;
  if(state.selecionadas.has(id)){
    state.selecionadas.delete(id);
  }else{
    state.selecionadas.set(id, peca);
  }
  // atualizar UI
  renderGrid();
  renderPainelThumbs();
  atualizarResumoERodape();
}

/* ----------------- Painel Branco: thumbs + total ----------------- */
function renderPainelThumbs(){
  EL.thumbs.innerHTML = '';
  const frag = document.createDocumentFragment();

  [...state.selecionadas.values()].forEach(peca=>{
    const t = document.createElement('div');
    t.className = 'thumb';

    const img = document.createElement('img');
    img.src = primeiraImagem(peca);
    img.alt = peca.titulo || peca.id_peca;

    const x = document.createElement('button');
    x.className = 'close';
    x.type = 'button';
    x.textContent = 'x';
    x.addEventListener('click', (ev)=>{
      ev.stopPropagation();
      state.selecionadas.delete(peca.id_peca);
      renderGrid();
      renderPainelThumbs();
      atualizarResumoERodape();
    });

    t.appendChild(img);
    t.appendChild(x);
    frag.appendChild(t);
  });

  EL.thumbs.appendChild(frag);
}

/* ----------------- Total e badges ----------------- */
function atualizarResumoERodape(){
  const total = [...state.selecionadas.values()].reduce((acc,p)=>acc+(Number(p.preco)||0),0);
  EL.total.textContent = `TOTAL: R$ ${total.toFixed(2).replace('.',',')}`;

  const qP = state.selecionadas.size;
  // badges: só aparecem se > 0
  EL.badgePecas.textContent = qP;
  EL.badgePecas.classList.toggle('hidden', qP===0);

  // (rifas ainda 0, estrutura pronta)
  EL.badgeRifas.textContent = 0;
  EL.badgeRifas.classList.toggle('hidden', true);

  // botão “Finalizar Aposta” só aparece com itens e painel aberto
  EL.finalizar.style.display = (qP>0 && state.painelAberto) ? 'inline-block' : 'none';
}

/* ----------------- Abrir/fechar painel ----------------- */
function setAba(qual){
  state.abaAtiva = qual;
  if(qual==='pecas'){
    EL.tabPecas.classList.add('active');
    EL.tabRifas.classList.remove('active');
    EL.iconPecas.src = ICONS.pecas_on;
    EL.iconRifas.src = ICONS.rifas_off;
  }else{
    EL.tabRifas.classList.add('active');
    EL.tabPecas.classList.remove('active');
    EL.iconPecas.src = ICONS.pecas_off;
    EL.iconRifas.src = ICONS.rifas_on;
  }
}

function abrirPainel(){
  state.painelAberto = true;
  EL.panelWrap.style.display = 'block';
  EL.guard.style.display = 'block';
  atualizarResumoERodape();
}
function fecharPainel(){
  state.painelAberto = false;
  EL.panelWrap.style.display = 'none';
  EL.guard.style.display = 'none';
  atualizarResumoERodape();
}

/* Clique na barra inteira abre/fecha a expansão */
EL.footer.addEventListener('click', (ev)=>{
  // Se clicou em algum item de aba, ainda assim alterna o painel
  if(state.painelAberto){ fecharPainel(); }
  else{ abrirPainel(); }
});

/* Tabs explicitamente trocam ícones/labels (e também abrem/fecham via footer) */
EL.tabPecas.addEventListener('click', (ev)=>{ setAba('pecas'); });
EL.tabRifas.addEventListener('click', (ev)=>{ setAba('rifas'); });

/* Clique fora fecha */
EL.guard.addEventListener('click', fecharPainel);
document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') fecharPainel(); });

/* Finalizar – (placeholder sem alert nativo do browser) */
EL.finalizar.addEventListener('click', ()=>{
  // Exemplo simples: exibe um mini resumo no painel (sem modal do navegador)
  const ids = [...state.selecionadas.keys()].join(', ');
  console.log('APOSTA:', {pecas: ids, total: EL.total.textContent});
  // Aqui você plugaria no FormSubmit + Apps Script
  EL.finalizar.textContent = 'Aposta Concluída!';
  setTimeout(()=>{ EL.finalizar.textContent = 'Finalizar Aposta'; }, 1200);
});

/* ----------------- Boot ----------------- */
(async function init(){
  setAba('pecas');

  state.pecas = await carregarPecas();
  renderGrid();
  renderPainelThumbs();
  atualizarResumoERodape();
})();
</script>
</body>
</html>
