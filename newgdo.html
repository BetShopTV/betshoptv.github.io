<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BSTV — Central de Apostas</title>
<style>
:root{
  --vermelho:#ff0000; --bege:#bebab0; --preto:#2b2424; --branco:#fff;
  --footer-h:60px; --thumb-h:110px;
}
body{
  margin:0;background:var(--bege);color:var(--preto);
  font-family:"Roboto Condensed",sans-serif;
  padding-bottom:var(--footer-h);
}
/* === GALERIA === */
.galeria{
  display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
  gap:16px;padding:20px;
}
.item{position:relative;cursor:pointer;}
.item img{width:100%;display:block;object-fit:cover;}
.heart{
  position:absolute;top:8px;right:8px;width:22px;height:22px;
  border:none;background:url('https://betshoptv.github.io/elementos/ticon-FAV-OFF-p2.avif') center/contain no-repeat;
  cursor:pointer;
}
.heart.active{background-image:url('https://betshoptv.github.io/elementos/ticon-FAV-ON-v.avif');}
/* === CENTRAL === */
.footer{
  position:fixed;left:0;right:0;bottom:0;height:var(--footer-h);
  background:var(--vermelho);display:flex;align-items:center;justify-content:center;gap:30px;
  z-index:1001;
}
.footer img.icon{height:32px;cursor:pointer;filter:grayscale(1) brightness(.8);}
.footer img.icon.active{filter:none;}
.panel{
  position:fixed;left:0;bottom:var(--footer-h);width:100%;
  background:var(--branco);border-top:4px solid var(--vermelho);
  display:none;flex-direction:column;align-items:center;z-index:1000;
}
.panel.open{display:flex;}
.thumbs{
  display:flex;gap:10px;overflow-x:auto;overflow-y:hidden;width:100%;padding:10px;background:var(--branco);
}
.thumbs::-webkit-scrollbar{height:6px;}
.thumbs::-webkit-scrollbar-thumb{background:var(--vermelho);}
.thumbs::-webkit-scrollbar-track{background:var(--bege);}
.thumb{position:relative;flex:0 0 auto;height:var(--thumb-h);aspect-ratio:1/1;border:1px solid var(--preto);}
.thumb img{width:100%;height:100%;object-fit:cover;}
.thumb button.x{
  position:absolute;top:4px;right:4px;background:rgba(0,0,0,.7);color:var(--branco);
  border:none;width:20px;height:20px;cursor:pointer;
}
.finalizar{
  margin:10px;padding:10px 18px;font-weight:bold;background:var(--preto);
  color:var(--branco);border:none;cursor:pointer;
}
.hidden{display:none;}
</style>
</head>
<body>
<!-- GALERIA -->
<div class="galeria" id="galeria"></div>

<!-- CENTRAL -->
<div class="panel" id="panel">
  <div class="thumbs" id="thumbsContainer"></div>
  <button id="finalizarBtn" class="finalizar hidden">FINALIZAR APOSTA</button>
</div>

<div class="footer" id="footer">
  <img id="btnPecas" src="https://betshoptv.com/elementos/ticon-SHOP-c.avif" class="icon" alt="Peças"/>
  <img id="btnRifas" src="https://betshoptv.com/elementos/ticon-RIFA-c.avif" class="icon" alt="Rifas"/>
  <img id="btnFavs"  src="https://betshoptv.com/elementos/ticon-FAV-ON-c.avif" class="icon" alt="Favoritos"/>
</div>

<script>
const PECAS_JSON_URL='/dados/pecas.json';
const RIFAS_JSON_URL='/dados/rifas.json';
let pecas=[], rifas=[];
let carrinho=[], favoritos=new Set(), rifasSelecionadas=new Set();
let abaAtiva=null;

// ===== CARREGAMENTO =====
async function carregarDados(){
  try{
    const [r1,r2]=await Promise.all([fetch(PECAS_JSON_URL),fetch(RIFAS_JSON_URL)]);
    pecas=(await r1.json()).filter(p=>p.status!=="VENDIDAAA");
    rifas=await r2.json();
    renderGaleria();
  }catch(e){console.error('Erro ao carregar JSONs',e);}
}

// ===== GALERIA =====
function renderGaleria(){
  const g=document.getElementById('galeria'); g.innerHTML='';
  // ordenação maior->menor
  pecas.sort((a,b)=>b.id_peca.localeCompare(a.id_peca));
  pecas.forEach(p=>{
    const div=document.createElement('div');
    div.className='item';
    div.innerHTML=`<img src="img/tmb/${(p.imagens||[])[0]}.avif" 
                      onerror="this.src='img/fallback/${(p.imagens||[])[0]}.jpg'">
                   <button class="heart ${favoritos.has(p.id_peca)?'active':''}"></button>`;
    div.onclick=()=>toggleCarrinho(p.id_peca);
    const h=div.querySelector('.heart');
    h.onclick=(e)=>{e.stopPropagation();toggleFavorito(p.id_peca,h);};
    g.appendChild(div);
  });
}

// ===== AÇÕES GALERIA =====
function toggleCarrinho(id){
  const i=carrinho.indexOf(id);
  if(i>-1) carrinho.splice(i,1); else carrinho.push(id);
  renderGaleria();
  if(abaAtiva==='pecas') renderThumbs();
}
function toggleFavorito(id,btn){
  if(favoritos.has(id)) favoritos.delete(id); else favoritos.add(id);
  btn.classList.toggle('active',favoritos.has(id));
  if(abaAtiva==='fav') renderThumbs();
}

// ===== ABAS =====
const panel=document.getElementById('panel');
document.getElementById('btnPecas').onclick=()=>toggleAba('pecas');
document.getElementById('btnRifas').onclick=()=>toggleAba('rifas');
document.getElementById('btnFavs').onclick =()=>toggleAba('fav');

function toggleAba(tipo){
  if(abaAtiva===tipo){fecharPainel();return;}
  abaAtiva=tipo; abrirPainel();
}
function abrirPainel(){
  panel.classList.add('open');
  renderThumbs();
  atualizarIcones();
}
function fecharPainel(){
  panel.classList.remove('open');
  abaAtiva=null;
  atualizarIcones();
}
document.addEventListener('keydown',e=>{if(e.key==='Escape')fecharPainel();});
document.addEventListener('click',e=>{
  if(!panel.contains(e.target)&&!document.getElementById('footer').contains(e.target)) fecharPainel();
});

// ===== RENDER THUMBS =====
function renderThumbs(){
  const thumbs=document.getElementById('thumbsContainer');
  thumbs.innerHTML='';
  let lista=[];
  if(abaAtiva==='pecas') lista=carrinho.map(id=>pecas.find(p=>p.id_peca===id)).filter(Boolean);
  if(abaAtiva==='rifas') lista=rifas.filter(r=>rifasSelecionadas.has(r.id_rifa));
  if(abaAtiva==='fav')   lista=[...favoritos].map(id=>pecas.find(p=>p.id_peca===id)).filter(Boolean);

  lista.forEach(item=>{
    const div=document.createElement('div');
    div.className='thumb';
    const imgSrc=item.img || (item.imagens&&item.imagens[0]) || '';
    div.innerHTML=`<img src="img/tmb/${imgSrc}.avif" 
                       onerror="this.src='img/fallback/${imgSrc}.jpg'">
                   <button class="x">&times;</button>`;
    div.querySelector('.x').onclick=()=>removerItem(item);
    thumbs.appendChild(div);
  });
  document.getElementById('finalizarBtn')
    .classList.toggle('hidden',lista.length===0 || !panel.classList.contains('open'));
}

// ===== REMOÇÃO E SINCRONISMO =====
function removerItem(item){
  if(abaAtiva==='pecas'){
    carrinho=carrinho.filter(x=>x!==item.id_peca);
  }else if(abaAtiva==='rifas'){
    rifasSelecionadas.delete(item.id_rifa);
  }else if(abaAtiva==='fav'){
    favoritos.delete(item.id_peca);
  }
  renderGaleria(); renderThumbs();
}

// ===== ATUALIZA ÍCONES =====
function atualizarIcones(){
  const icones={
    pecas:document.getElementById('btnPecas'),
    rifas:document.getElementById('btnRifas'),
    fav:document.getElementById('btnFavs')
  };
  Object.entries(icones).forEach(([tipo,el])=>{
    const ativo=(tipo===abaAtiva);
    el.src=`https://betshoptv.com/elementos/ticon-${tipo==='fav'?'FAV-ON':tipo.toUpperCase()}-${ativo?'b':'c'}.avif`;
    el.classList.toggle('active',ativo);
  });
}

carregarDados();
</script>
</body>
</html>
