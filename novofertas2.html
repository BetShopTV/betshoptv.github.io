<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BSTV — Galeria + Feed (acessível)</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">
<style>
  /* ===== Scrollbars conforme pedido ===== */
  body::-webkit-scrollbar { width: 8px; height: 8px; }
  body::-webkit-scrollbar-thumb { background-color: #2b2424; }
  body::-webkit-scrollbar-track { background: #bebab0; }

  textarea#selected-text::-webkit-scrollbar { width: 4px; height: 4px; }
  textarea#selected-text::-webkit-scrollbar-thumb { background-color: #ff0000; }
  textarea#selected-text::-webkit-scrollbar-track { background: #bebab0; }

  :root{
    --cor-fundo:#bebab0;
    --cor-texto:#2b2424;
    --cor-destaque:#ff0000;
    --maxW:1200px;
    --btn-h:48px; /* base button height */
    --border-w:2px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:'Roboto Condensed',sans-serif;
    background:var(--cor-fundo); color:var(--cor-texto); padding:1vw;
  }

  /* ===== BACK BAR (aparece apenas no feed) ===== */
  .back-bar{
    display:none; /* shown only in feed */
    position:fixed;
    inset:0 0 auto 0;
    background:var(--cor-destaque);
    color:#bebab0;
    z-index:9999;
    height: clamp(42px,6vh,60px); /* responsive */
    display:flex; align-items:center; justify-content:flex-start;
    padding:0 clamp(12px,2vw,20px);
    cursor:pointer;
  }
  .back-bar .label{ font-weight:700; font-size: clamp(0.9rem, 2vw, 1.1rem); color:#bebab0; }
  /* slight 5% reduction relative to original if needed - already built into clamp values */

  /* leave page content space for fixed bar */
  .page-padding-top{ padding-top: calc(clamp(42px,6vh,60px) + 12px); }

  /* ===== GALERIA (mantida) ===== */
  .gallery-container {
      max-width: var(--maxW);
      margin: 0 auto;
      display: flex;
      gap: clamp(8px, 1.2vw, 24px);
  }
  .col {
      flex: 1 1 calc(33.333% - 1.333vw);
      max-width: calc((min(var(--maxW), 100vw) - 4vw) / 3);
      display: flex; flex-direction: column; gap: 38px;
  }
  .gallery-item {
      background-color: var(--cor-fundo);
      display: flex;
      flex-direction: column;
      width: 100%;
      box-sizing: border-box;
      position: relative;
      cursor: pointer;
  }
  .item-code{
      font-family:'Roboto Mono', monospace;
      font-weight:500;
      font-size:clamp(0.7em,1.8vw,1.2em);
      white-space:nowrap;
      padding:0.38vw 1.8vw;
      color:var(--cor-texto);
      background:var(--cor-fundo);
      border: var(--border-w) solid var(--cor-texto);
      width:fit-content;
      position:absolute;
      top:0;
      left:50%;
      transform:translate(-50%,-50%);
      z-index:10;
    }
  .gallery-image{
      width:100%; height:auto; display:block;
      border: var(--border-w) solid var(--cor-texto);
      border-right:0; border-left:0; border-bottom:0;
      margin-bottom:0; cursor:pointer;
  }
  .item-price{
      font-family:'Roboto Mono', monospace;
      font-weight:500;
      font-size:clamp(0.8em,1.8vw,1.2em);
      padding:0.5vw 1vw; background:var(--cor-texto); color:var(--cor-fundo);
      line-height:1.2; position:absolute; bottom:0; left:0; z-index:10;
  }
  .add-button{
      background-image:url('https://betshoptv.com/images/fofertas_hover.gif');
      color: #fff; font-family:'Roboto Mono', monospace; border:0; font-weight:500;
      font-size:clamp(0.8em,1.8vw,1.2em); padding:0.5vw 1vw; cursor:pointer; text-transform:uppercase;
      align-self:flex-end; margin-top:0;
  }
  @media(max-width:768px){ .col{ flex-basis:calc(50% - 2vw); max-width:calc(50% - 1vw); } }

  /* ===== FEED ===== */
  #feed{ display:none; max-width:var(--maxW); margin:0 auto; box-sizing:border-box; }
  .feed-content{ padding:12px; box-sizing:border-box; }

  .post{ margin-bottom:28px; position:relative; background:transparent; }

  /* carousel wrapper with border as requested */
  .carousel-wrap{
    border: var(--border-w) solid var(--cor-texto);
    padding: 12px;
    box-sizing:border-box;
  }
  /* border width reduces on smaller screens (and item-code too) */
  @media(max-width:600px){ :root{ --border-w:1px; } .item-code{ border-width:1px; } }

  /* continuous scroller */
  .carousel{
    display:flex; overflow-x:auto; gap:24px; align-items:center; padding-bottom:8px;
    scroll-behavior:auto; -webkit-overflow-scrolling:touch;
    padding-left:0; margin-left:0;
  }
  .carousel::-webkit-scrollbar{ height: 8px; }
  .carousel::-webkit-scrollbar-thumb{ background: var(--cor-destaque); }
  .carousel::-webkit-scrollbar-track{ background: transparent; }

  /* slides inline, left-aligned starting from first (a) */
  .slide{ flex:0 0 auto; display:flex; align-items:center; justify-content:center; min-width:unset; box-sizing:border-box; }
  .slide img{
    max-width:100%; max-height:80vh; width:auto; height:auto; object-fit:contain; display:block;
    vertical-align:middle;
    border-radius:0;
  }

  /* piece info below carousel */
  .piece-info{ padding:12px 8px; font-family:'Roboto Condensed',sans-serif; color:var(--cor-texto); display:flex; flex-direction:column; gap:6px; }
  .title-row{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
  .piece-title{ font-weight:700; font-size: clamp(1rem, 2.2vw, 1.1rem); text-align:left; }
  .piece-price{ font-weight:500; font-size: clamp(1rem, 2.2vw, 1.1rem); text-align:right; }
  .piece-tech{ font-size: clamp(0.85rem, 1.6vw, 1rem); color:var(--cor-texto); }
  .piece-dims{ font-size: clamp(0.8rem, 1.4vw, 0.95rem); color:var(--cor-texto); }

  /* actions row: equal-height buttons, square corners, border 2px or 1px on small */
  .actions-row{ display:flex; gap:12px; padding:8px 12px; align-items:center; }
  .btn{
    height: var(--btn-h);
    min-height: var(--btn-h);
    padding: 0 14px;
    border: 2px solid var(--cor-destaque);
    background: transparent;
    color: var(--cor-destaque);
    font-weight:700;
    cursor:pointer;
    border-radius:0;
    display:inline-flex; align-items:center; justify-content:center;
    font-family:'Roboto Condensed',sans-serif;
  }
  .btn.small-border{ border-width:1px; }
  .heart{ width: calc(var(--btn-h)); } /* square */
  .heart.active{ background:var(--cor-destaque); color:var(--cor-fundo); }

  @media(max-width:600px){
    :root{ --btn-h:40px; }
    .btn{ border-width:1px; }
    .item-code{ border-width:1px; }
  }

  /* focus styles (accessibility) */
  .btn:focus, .carousel:focus { outline: 2px solid rgba(255,0,0,0.02); outline-offset:2px; }

  /* visually-hidden (for aria-live region) */
  .visually-hidden{ position:absolute !important; height:1px; width:1px; overflow:hidden; clip:rect(1px,1px,1px,1px); white-space:nowrap; border:0; padding:0; margin:-1px; }

</style>
</head>
<body class="page-padding-top">

  <!-- BACK BAR (click anywhere to go back) -->
  <div id="backBar" class="back-bar" aria-hidden="true" role="button" tabindex="0">
    <span class="label">← Voltar</span>
  </div>

  <!-- GALERIA -->
  <div id="gallery" class="gallery-container" aria-hidden="false">
    <div class="col" id="col0"></div>
    <div class="col" id="col1"></div>
    <div class="col" id="col2"></div>
  </div>

  <!-- FEED -->
  <div id="feed" role="region" aria-hidden="true">
    <div id="feedContent" class="feed-content"></div>
  </div>

  <!-- aria-live region (visually hidden) to announce current slide for screen readers -->
  <div id="sr-live" class="visually-hidden" aria-live="polite" aria-atomic="true"></div>

<script>
/* ===== Data & piece metadata (titles, técnica, dimensões, preço) ===== */
const fileList = [
"03-01a.jpg","03-01b.jpg","03-01c.jpg","03-01d.jpg",
"03-02a.jpg","03-02b.jpg","03-02c.jpg",
"03-03a.jpg","03-03b.jpg","03-03c.jpg",
"03-04a.jpg","03-04b.jpg",
"03-05a.jpg","03-05b.jpg","03-05c.jpg",
"03-06a.jpg","03-06b.jpg",
"03-07a.jpg","03-07b.jpg",
"03-08a.jpg","03-08b.jpg","03-08c.jpg",
"03-09a.jpg","03-09b.jpg",
"03-10a.jpg","03-10b.jpg","03-10c.jpg",
"03-11a.jpg","03-11b.jpg","03-11c.jpg",
"03-12a.jpg","03-12b.jpg","03-12c.jpg",
"03-13a.jpg","03-13b.jpg","03-13c.jpg",
"04-01a.jpg","04-01b.jpg",
"04-02a.jpg","04-02b.jpg",
"04-03a.jpg","04-03b.jpg","04-03c.jpg",
"04-04a.jpg","04-04b.jpg",
"04-05a.jpg","04-05b.jpg","04-05c.jpg","04-05d.jpg",
"04-06a.jpg","04-06b.jpg","04-06c.jpg","04-06d.jpg"
];
const basePath = "https://betshoptv.com/peças/";
/* pieceData: título, técnica (we'll use titulo field for "técnica" if provided), medidas, preco */
const pieceData = {
  "03-01": { titulo:"Rádio 01", tecnica:"Página da edição de março de 1990 da revista Playboy brasileira transferida para EVA estampado e parafusos.", medidas:"57 x 18 x 15 cm", preco:"200" },
  "03-02": { titulo:"Câmera fotográfica 01", tecnica:"Técnica X aplicada sobre madeira", medidas:"45 x 20 x 12 cm", preco:"150" },
  "03-03": { titulo:"Polaroid 01", tecnica:"Técnica Y com verniz", medidas:"30 x 20 x 10 cm", preco:"150" },
  "03-04": { titulo:"Câmera fotográfica 02", tecnica:"Técnica Z", medidas:"40 x 18 x 12 cm", preco:"200" },
  "03-05": { titulo:"Rádio 02", tecnica:"Montagem com componentes reciclados", medidas:"50 x 22 x 14 cm", preco:"200" },
  "03-06": { titulo:"Rádio 03", tecnica:"Técnica A", medidas:"48 x 20 x 13 cm", preco:"150" },
  "03-07": { titulo:"Câmera fotográfica 03", tecnica:"Técnica B", medidas:"44 x 19 x 12 cm", preco:"150" },
  "03-08": { titulo:"Rádio 04", tecnica:"Técnica C", medidas:"60 x 25 x 18 cm", preco:"250" },
  "03-09": { titulo:"Conjunto de som e imagem 01", tecnica:"Técnica D", medidas:"57 x 18 x 15 cm", preco:"1800" },
  "03-10": { titulo:"Rádio 05", tecnica:"Técnica E", medidas:"40 x 15 x 12 cm", preco:"150" },
  "03-11": { titulo:"Rádio 06", tecnica:"Técnica F", medidas:"42 x 16 x 13 cm", preco:"150" },
  "03-12": { titulo:"Câmera fotográfica 04", tecnica:"Técnica G", medidas:"46 x 18 x 12 cm", preco:"250" },
  "03-13": { titulo:"Polaroid 03", tecnica:"Técnica H", medidas:"34 x 20 x 11 cm", preco:"350" },
  "04-01": { titulo:"Rádio 07", tecnica:"Técnica I", medidas:"48 x 21 x 14 cm", preco:"150" },
  "04-02": { titulo:"Câmera fotográfica 05", tecnica:"Técnica J", medidas:"44 x 18 x 12 cm", preco:"150" },
  "04-03": { titulo:"Polaroid 04", tecnica:"Técnica K", medidas:"32 x 18 x 12 cm", preco:"150" },
  "04-04": { titulo:"Câmera fotográfica 06", tecnica:"Técnica L", medidas:"50 x 20 x 15 cm", preco:"150" },
  "04-05": { titulo:"Rádio 08", tecnica:"Técnica M", medidas:"58 x 22 x 16 cm", preco:"150" },
  "04-06": { titulo:"Rádio 09", tecnica:"Técnica N", medidas:"59 x 23 x 17 cm", preco:"150" }
};

/* ===== build pieces map ===== */
const pieces = {};
fileList.forEach(fn=>{
  const m = fn.match(/^(\d{2})-(\d{2})([a-z])\.jpg$/i);
  if(!m) return;
  const group = m[1], number = m[2], letter = m[3].toLowerCase();
  const key = `${group}-${number}`;
  if(!pieces[key]) pieces[key] = { group, number, images: [] };
  pieces[key].images.push({ letter, filename: fn, url: basePath+fn });
});
Object.values(pieces).forEach(p=> p.images.sort((a,b)=> a.letter.localeCompare(b.letter)));

/* ordered keys (group then number) */
let orderedKeys = Object.keys(pieces).sort((a,b)=>{
  if(pieces[a].group === pieces[b].group) return pieces[a].number.localeCompare(pieces[b].number);
  return pieces[a].group.localeCompare(pieces[b].group);
});

/* ===== render gallery (keeps exact design) ===== */
const cols = [document.getElementById('col0'), document.getElementById('col1'), document.getElementById('col2')];
orderedKeys.forEach((key, idx)=>{
  const p = pieces[key];
  if(!p.images[0]) return;
  const galleryItem = document.createElement('div');
  galleryItem.className = 'gallery-item';
  galleryItem.onclick = ()=> openFeed(key);

  const itemCode = document.createElement('span');
  itemCode.className = 'item-code';
  itemCode.textContent = `${p.group} / ${p.number}`;

  const image = document.createElement('img');
  image.className = 'gallery-image';
  image.src = p.images[0].url;
  image.alt = `Peça ${p.group}-${p.number}`;

  const price = document.createElement('span');
  price.className = 'item-price';
  price.textContent = p.group === '03' ? "R$ 200" : "R$ 250";

  const btn = document.createElement('button');
  btn.className = 'add-button';
  btn.textContent = 'ADICIONAR';

  galleryItem.appendChild(itemCode);
  galleryItem.appendChild(image);
  galleryItem.appendChild(price);
  galleryItem.appendChild(btn);
  cols[idx % 3].appendChild(galleryItem);
});

/* ===== Accessibility helpers ===== */
const srLive = document.getElementById('sr-live');
function announce(text){ srLive.textContent = text; }

/* intersection observer to detect which slide is most visible for accessibility */
function createVisibilityObserver(carousel){
  const slides = Array.from(carousel.querySelectorAll('.slide'));
  const options = { root: carousel, threshold: buildThresholdList() };
  const obs = new IntersectionObserver((entries)=>{
    // pick slide with max intersectionRatio
    let best = {ratio:0, target:null, index:0};
    entries.forEach(e=>{
      const idx = slides.indexOf(e.target);
      if(e.intersectionRatio > best.ratio){ best = {ratio: e.intersectionRatio, target: e.target, index: idx}; }
    });
    if(best.target){
      // announce (for screen reader only)
      const total = slides.length;
      const current = Math.min(Math.max(1, best.index + 1), total);
      announce(`Imagem ${current} de ${total}`);
      // set aria-current attributes
      slides.forEach((s,i)=> s.setAttribute('aria-current', (i===best.index) ? 'true' : 'false'));
    }
  }, options);
  slides.forEach(s=> obs.observe(s));
  return obs;
}
function buildThresholdList() {
  const thresholds = [];
  for (let i=0; i<=100; i++){ thresholds.push(i/100); }
  return thresholds;
}

/* keyboard navigation for carousel: left/right arrows */
function attachCarouselKeyboard(carousel){
  carousel.addEventListener('keydown', (e)=>{
    if(e.key === 'ArrowLeft'){ e.preventDefault(); carousel.scrollBy({ left: -Math.round(carousel.clientWidth - 24), behavior: 'auto' }); }
    if(e.key === 'ArrowRight'){ e.preventDefault(); carousel.scrollBy({ left: Math.round(carousel.clientWidth - 24), behavior: 'auto' }); }
  });
}

/* ===== openFeed implementation with requested UI changes ===== */
function openFeed(startKey){
  // show back bar
  const backBar = document.getElementById('backBar');
  backBar.style.display = 'flex';
  backBar.setAttribute('aria-hidden','false');

  const feed = document.getElementById('feed');
  const feedContent = document.getElementById('feedContent');
  feedContent.innerHTML = '';

  orderedKeys.forEach((k, index)=>{
    const p = pieces[k];
    const post = document.createElement('div');
    post.className = 'post';

    // carousel wrap with border
    const wrap = document.createElement('div');
    wrap.className = 'carousel-wrap';
    // container carousel (continuous)
    const carousel = document.createElement('div');
    carousel.className = 'carousel';
    carousel.setAttribute('role','group');
    carousel.setAttribute('tabindex','0');
    carousel.setAttribute('aria-label', `${k} — imagens`);

    // append slides
    p.images.forEach((imgObj,i)=>{
      const slide = document.createElement('div');
      slide.className = 'slide';
      slide.setAttribute('role','img');
      slide.setAttribute('aria-label', `Imagem ${i+1} de ${p.images.length}`);
      const img = document.createElement('img');
      img.src = imgObj.url;
      img.alt = `${k} - ${imgObj.letter}`;
      img.loading = 'lazy';
      slide.appendChild(img);
      carousel.appendChild(slide);
    });

    wrap.appendChild(carousel);
    post.appendChild(wrap);

    /* piece info area */
    const info = document.createElement('div');
    info.className = 'piece-info';
    const meta = pieceData[k] || { titulo:k, tecnica:'', medidas:'-', preco:'-' };
    // title row with code/title left and price right
    const titleRow = document.createElement('div');
    titleRow.className = 'title-row';
    const title = document.createElement('div');
    title.className = 'piece-title';
    title.innerText = `${p.group}/${p.number} ${meta.titulo}`;
    const price = document.createElement('div');
    price.className = 'piece-price';
    price.innerText = `R$ ${meta.preco}`;
    titleRow.appendChild(title); titleRow.appendChild(price);

    const tech = document.createElement('div'); tech.className = 'piece-tech';
    tech.innerText = meta.tecnica;

    const dims = document.createElement('div'); dims.className = 'piece-dims';
    dims.innerText = meta.medidas;

    info.appendChild(titleRow);
    info.appendChild(tech);
    info.appendChild(dims);

    /* actions row */
    const actions = document.createElement('div');
    actions.className = 'actions-row';
    const heart = document.createElement('button');
    heart.className = 'btn heart';
    heart.setAttribute('aria-pressed','false');
    heart.title = 'Favoritar';
    heart.innerText = '♡';
    heart.onclick = ()=>{
      const active = heart.classList.toggle('active');
      heart.setAttribute('aria-pressed', active ? 'true' : 'false');
      heart.innerText = active ? '♥' : '♡';
    };
    const addCart = document.createElement('button');
    addCart.className = 'btn';
    addCart.innerText = '🛍 ADICIONAR AO CARRINHO';
    addCart.setAttribute('aria-label', `Adicionar ${meta.titulo} ao carrinho`);
    addCart.onclick = ()=>{
      const cart = JSON.parse(localStorage.getItem('bstv_cart_v1') || '[]');
      cart.push({ key:k, title: meta.titulo, price: meta.preco });
      localStorage.setItem('bstv_cart_v1', JSON.stringify(cart));
      addCart.innerText = 'ADICIONADO ✓';
      setTimeout(()=> addCart.innerText = '🛍 ADICIONAR AO CARRINHO', 1200);
    };
    actions.appendChild(heart);
    actions.appendChild(addCart);

    post.appendChild(info);
    post.appendChild(actions);

    feedContent.appendChild(post);

    /* accessibility: observe visibility of slides inside this carousel */
    // create observer after appending to DOM (done later)
  });

  /* show feed, hide gallery */
  document.getElementById('gallery').style.display = 'none';
  feed.style.display = 'block';
  // make back bar clickable: click anywhere returns to gallery
  document.getElementById('backBar').onclick = backToGallery;
  document.getElementById('backBar').onkeydown = (e)=> { if(e.key === 'Enter' || e.key === ' ') backToGallery(); };

  // scroll to requested post without animation
  const idx = orderedKeys.indexOf(startKey);
  if(idx >= 0){
    const posts = document.querySelectorAll('#feedContent .post');
    const target = posts[idx];
    if(target){
      // compute top offset to leave back bar visible
      const topOffset = target.getBoundingClientRect().top + window.scrollY - document.querySelector('.back-bar').offsetHeight - 8;
      window.scrollTo({ top: topOffset, left:0, behavior:'auto' });
      // ensure first image aligned left
      const car = target.querySelector('.carousel');
      if(car) car.scrollLeft = 0;
    }
  }

  /* After feed built: attach observers and keyboard to each carousel */
  document.querySelectorAll('#feedContent .post').forEach(postEl=>{
    const carousel = postEl.querySelector('.carousel');
    if(!carousel) return;
    // create observer to update SR live region and aria-current per slide
    createVisibilityObserver(carousel);
    attachCarouselKeyboard(carousel);
    // initial announce: first image
    const slides = carousel.querySelectorAll('.slide');
    if(slides.length) announce(`Imagem 1 de ${slides.length}`);
  });
}

/* back to gallery */
function backToGallery(){
  document.getElementById('feed').style.display = 'none';
  document.getElementById('gallery').style.display = 'flex';
  // hide back bar
  document.getElementById('backBar').style.display = 'none';
  document.getElementById('backBar').setAttribute('aria-hidden','true');
  // scroll to top of gallery (respect back bar height)
  const topOffset = document.querySelector('.gallery-container').getBoundingClientRect().top + window.scrollY - 24;
  window.scrollTo({ top: topOffset, left:0, behavior:'auto' });
}

/* init: gallery already rendered earlier */
</script>
</body>
</html>
