<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Galeria de Ofertas — Central de Apostas</title>

<!-- Tipografia base -->
  <link rel="preload" href="/fonts/Roboto_Condensed-Medium.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/fonts/Roboto_Condensed-Regular.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/fonts/Roboto_Condensed-Bold.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/fonts/Roboto_Condensed-ExtraBold.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/fonts/Roboto_Condensed-Black.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/fonts/Roboto_SemiCondensed-Medium.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/fonts/Roboto_SemiCondensed-Regular.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/fonts/Roboto_SemiCondensed-Bold.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/fonts/Roboto_SemiCondensed-SemiBold.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/fonts/Roboto_SemiCondensed-ExtraBold.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/fonts/Roboto_SemiCondensed-Black.woff2" as="font" type="font/woff2" crossorigin>

<style>
:root{
  --bg:#bebab0;
  --ink:#2b2424;
  --red:#ff0000;
  --white:#ffffff;
  --footer-h: clamp(66px, calc(4.2vh + 1.8vw), 88px);
  --panel-max: 30vh;
  --vermelho:#ff0000;
  --branco:#ffffff;
  --cinza:#bebab0;
  --preto:#2b2424;
  --largura-max:1160px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; background:var(--bg); color:var(--ink);
  font-family:"Roboto Condensed", "Roboto SemiCondensed", sans-serif;
  -webkit-font-smoothing:antialiased; padding-bottom:var(--footer-h);
}





   /* === INÍCIO INSERÇÃO FEED CSS === */
   /* === INÍCIO INSERÇÃO FEED CSS === */
   /* === INÍCIO INSERÇÃO FEED CSS === */
  
  main.feed {
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:20px 0 60px;
  }

  /* === POST === */
  .post {
    width:100%;
    max-width:var(--largura-max);
    background:var(--cinza);
    border:2px solid var(--preto);
    margin-bottom:40px;
    display:flex;
    flex-direction:column;
    padding:10px;
    box-sizing:border-box;
  }

  /* === GALERIA HORIZONTAL === */
  .carousel {
    display:flex;
    overflow-x:auto;
    scroll-snap-type:x mandatory;
    scroll-behavior:smooth;
    scrollbar-width:thin;
    scrollbar-color:var(--vermelho) var(--cinza);
    background:var(--cinza);
    margin-bottom:8px;
  }

  .carousel::-webkit-scrollbar {
    height:6px;
  }
  .carousel::-webkit-scrollbar-thumb {
    background:var(--vermelho);
  }
  .carousel::-webkit-scrollbar-track {
    background:var(--cinza);
  }

  .carousel img {
    flex:-1 0 100%;
    width:100%;
    height:auto;
    max-height:66vh;
    object-fit:contain;
    margin-right: 38px;
    background:var(--cinza);
    scroll-snap-align:center;
  }

  @media(max-width:768px){
    .carousel img {
      flex:0 0 100%;
      max-height:55vh;
      margin-right: 0px;
    }
  }

  /* === INFO === */
  .info {
    display:flex;
    flex-direction:column;
    gap:10px;
    padding:10px;
  }

  .line1 {
    display:flex;
    justify-content:space-between;
    align-items:center;
    font-weight:700;
    margin-bottom:4px;
  }

  .title { font-size:1rem; }
  .price { color:var(--preto); font-weight:700; }

  .tech, .dims {
    font-size:0.9rem;
  }

  /* === BOTÃO === */
  .btn {
    background:transparent;
    border:2px solid var(--vermelho);
    color:var(--vermelho);
    padding:6px 16px;
    text-transform:uppercase;
    font-weight:700;
    cursor:pointer;
    transition:all .2s ease-in-out;
    display:inline-flex;
    align-items:center;
    gap:6px;
    align-self:flex-end;
    margin-top:6px;
  }
  .btn:hover {
    background:var(--vermelho);
    color:var(--branco);
  }
  .btn.active {
    background:var(--vermelho);
    color:var(--branco);
  }
   /* === FIM INSERÇÃO FEED CSS === */
   /* === FIM INSERÇÃO FEED CSS === */
   /* === FIM INSERÇÃO FEED CSS === */


  
/* ===== RODAPÉ ===== */
.footer{
  position:fixed;left:0;right:0;bottom:0;height:var(--footer-h);
  background:var(--red); color:var(--white); z-index:1000;
  display:flex; align-items:center; gap:16px; padding:0 clamp(10px,2vw,24px);
  user-select:none;
  border-top:0; /* sem borda! */
  margin:0 auto;
  max-width:1200px;
}
.footer .brand{font-weight:900; letter-spacing:.3px; font-size:clamp(16px,2.4vw,24px)}
.actions{display:flex;gap:20px;margin-left:auto;align-items:center}
.action{
  display:flex; align-items:center; gap:8px; cursor:pointer;
  color:#ffffff; text-transform:uppercase; font-weight:800; letter-spacing:.4px;
}
.action.inactive{color:var(--bg); opacity:1}
.action img{height:30px;width:auto;display:block}
.badge{
  position:relative; display:inline-block; line-height:1; border-radius: 888px;
}
.badge .dot{
  position:absolute; top: -10px; right: 0px; left:4px; bottom: -1px;
  margin-left: 15px;
  border-radius: 999px; background:#fff; color:var(--red);
  border:2px solid var(--red);
  font-weight:700; font-size:13px; min-width:22px; height:22px;
  display:flex; align-items:center; justify-content:center; padding:2px 6px;
}

/* ===== PAINEL EXPANSÃO ===== */
.panel-wrap{
  position:fixed; left:0; right:0; bottom:var(--footer-h);
  display:none; z-index:999; /* aparece acima do conteúdo e abaixo do footer vermelho que sobe */
}
.panel{
  margin:0 auto; max-width:1200px; background:#fff; border-top:2px solid var(--white);
  padding:8px 8px 12px;
}
.thumb-row{
  display:flex; gap:10px; overflow-x:auto; padding:6px 4px 2px; align-items:flex-start;
}
.thumb{
  position:relative; flex:0 0 auto; border:1px solid var(--ink); background:#fff;
  padding:0px; min-width:130px; max-width:160px;
}
.thumb img{display:block; width:100%; max-height:88px; object-fit:cover}
.thumb .close{
  position:absolute; right:4px; top:4px; background:var(--ink); color:#fff; border:0;
  width:22px; height:22px; cursor:pointer; font-weight:700; line-height:1; padding:0;
}
.thumb-row::-webkit-scrollbar{height:8px}
.thumb-row::-webkit-scrollbar-thumb{background:var(--red)}
.thumb-row::-webkit-scrollbar-track{background:var(--bg)}

/* total + finalizar */
.panel-bottom{
  display:flex; justify-content:space-between; align-items:center; gap:12px;
  padding:8px 2px 0;
}
.total{font-weight:500; color:var(--ink); font-size:18px; margin-left: 12px;}
.finalizar{
  background:var(--ink); color:#fff; border:0; font-weight:700; cursor:pointer;
  padding:10px 16px; text-transform:uppercase; letter-spacing:.4px; margin-left: 12px;
}

/* overlay invisível p/ click fora */
.backdrop{
  position:fixed; inset:0; background:transparent; display:none; z-index:994;
}

/* util */
.hidden{display:none !important}

/* responsivo */
@media (max-width:720px){
  .container{padding:4px}
  .footer{height:64px}
  .footer .brand{font-weight:700; font-size: 16px;}
  :root{ --footer-h: 64px; }
  .action img{height:18px}
  .badge .dot{font-size:11px; font-weight: 500; margin-left: 10px; min-width:16px; height:16px; }
  .thumb{min-width:88px}
  .total{font-size:15px}
}
</style>
</head>


  <!-- INÍCIO BODY ODY ODY -->
  <!-- INÍCIO BODY ODY ODY -->
  <!-- INÍCIO BODY ODY ODY -->
<body>
  <main class="feed" id="feed"></main>

  <!-- EXPANSÃO (branca) -->
  <div id="backdrop" class="backdrop" aria-hidden="true"></div>
  <div id="panelWrap" class="panel-wrap" aria-hidden="true">
    <div class="panel" role="region" aria-label="Itens selecionados">
      <div id="thumbRow" class="thumb-row"></div>
      <div class="panel-bottom">
        <div class="total" id="totalBox">TOTAL: R$ 0,00</div>
        <button id="finalizarBtn" class="finalizar hidden">Finalizar Aposta</button>
      </div>
    </div>
  </div>

  <!-- RODAPÉ -->
  <div class="footer" id="footer">
    <div class="brand" style="margin-left: 10px;">CENTRAL de APOSTAS</div>
    <div class="actions">
      <div id="btnShop" class="action inactive" data-tab="shop" role="button" aria-controls="panelWrap" aria-expanded="false">
        <span class="badge">
          <img id="iconShop" src="/elementos/ticon-SHOP-c.avif" alt="Peças">
          <span id="countShop" class="dot hidden">0</span>
        </span>
        <span style="margin-left: 4px;">Peças</span>
      </div>
      <div id="btnRifa" class="action inactive" data-tab="rifa" role="button" aria-controls="panelWrap" aria-expanded="false">
        <span class="badge">
          <img id="iconRifa" src="/elementos/ticon-RIFA-c.avif" alt="Rifas">
          <span id="countRifa" class="dot hidden">0</span>
        </span>
        <span style="margin-right: 18px; padding: 0 4px;">Rifas</span>&nbsp;
      </div>
    </div>
  </div>


  <!-- INÍCIO INSERÇÃO JAVASCRIPT -->
  <!-- INÍCIO INSERÇÃO JAVASCRIPT -->
  <!-- INÍCIO INSERÇÃO JAVASCRIPT -->


  
  <script>
  const PECAS_JSON_URL='/dados/pecas.json';
  let piecesData=[];
  const selectedPieces=new Set();

  const money=v=>'R$ '+Number(v||0).toFixed(2).replace('.',',');

  /* === Carrega JSON === */
  async function loadJSON(url){
    const r=await fetch(url,{cache:'no-store'});
    if(!r.ok) throw new Error('Erro ao carregar JSON');
    return r.json();
  }

  function sortDescById(arr){
    return [...arr].sort((a,b)=>{
      const ai=parseInt((a.id_peca||'').replace(/\D/g,''),10);
      const bi=parseInt((b.id_peca||'').replace(/\D/g,''),10);
      return bi-ai;
    });
  }

  /* === Render Feed === */
  function renderFeed(){
    const feed=document.getElementById('feed');
    feed.innerHTML='';
    const items=sortDescById(piecesData);

    for(const p of items){
      const post=document.createElement('div');
      post.className='post';

      /* GALERIA */
      const carousel=document.createElement('div');
      carousel.className='carousel';
      (p.imagens||[]).forEach(name=>{
        const img=document.createElement('img');
        img.src=`img/otm/${name}.avif`;
        img.alt=p.titulo;
        img.onerror=()=>img.src=`img/fallback/${name}.jpg`;
        carousel.appendChild(img);
      });

      /* INFO */
      const info=document.createElement('div');
      info.className='info';

      /* Linha 1: título + preço */
      const line1=document.createElement('div');
      line1.className='line1';

      const title=document.createElement('div');
      title.className='title';
      title.textContent=p.titulo;

      const price=document.createElement('div');
      price.className='price';
      price.textContent=money(p.preco);

      line1.append(title,price);

      /* Linha 2: técnica */
      const tech=document.createElement('div');
      tech.className='tech';
      tech.textContent=p.tecnica;

      /* Linha 3: dimensões */
      const dims=document.createElement('div');
      dims.className='dims';
      dims.textContent=p.dimensao;

      /* Linha 4: botão à direita */
      const btn=document.createElement('button');
      btn.className='btn';
      btn.textContent=selectedPieces.has(p.id_peca)?'REMOVER':'ADICIONAR';
      if(selectedPieces.has(p.id_peca)) btn.classList.add('active');
      btn.addEventListener('click',()=>{
        togglePiece(p.id_peca);
        btn.textContent=selectedPieces.has(p.id_peca)?'REMOVER':'ADICIONAR';
        btn.classList.toggle('active',selectedPieces.has(p.id_peca));
      });

      info.append(line1,tech,dims,btn);
      post.append(carousel,info);
      feed.appendChild(post);
    }
  }

  /* === Toggle Peça === */
  function togglePiece(id){
    if(selectedPieces.has(id)) selectedPieces.delete(id);
    else selectedPieces.add(id);
  }

  /* === Init === */
  (async()=>{
    try{
      const raw=await loadJSON(PECAS_JSON_URL);
      piecesData=raw.filter(p=>String(p.status||'').toUpperCase()!=='VENDIDAAA');
      renderFeed();
    }catch(e){ console.error(e); }
  })();
  </script>






  <!-- FIM INSERÇÃO JAVASCRIPT -->  <!-- FIM INSERÇÃO JAVASCRIPT -->   <!-- FIM INSERÇÃO JAVASCRIPT -->  <!-- FIM INSERÇÃO JAVASCRIPT -->  <!-- FIM INSERÇÃO JAVASCRIPT -->
  <!-- FIM INSERÇÃO JAVASCRIPT -->  <!-- FIM INSERÇÃO JAVASCRIPT -->   <!-- FIM INSERÇÃO JAVASCRIPT -->  <!-- FIM INSERÇÃO JAVASCRIPT -->  <!-- FIM INSERÇÃO JAVASCRIPT -->
  <!-- FIM INSERÇÃO JAVASCRIPT -->  <!-- FIM INSERÇÃO JAVASCRIPT -->   <!-- FIM INSERÇÃO JAVASCRIPT -->  <!-- FIM INSERÇÃO JAVASCRIPT -->  <!-- FIM INSERÇÃO JAVASCRIPT -->




  
  
  <script>
/* =================== Endpoints =================== */
const PECAS_JSON_URL = '/dados/pecas.json';
const RIFAS_JSON_URL = '/dados/rifas.json';

/* =================== Estado =================== */
let piecesData = [];         // pecas.json (somente disponíveis)
let rifasData  = [];         // rifas.json (somente disponíveis)
const selectedPieces = new Set();   // id_peca
const selectedRifas  = new Set();   // id_rifa
let openTab = null; // 'shop' | 'rifa' | null

/* =================== Utils =================== */
const money = v => 'R$ ' + Number(v||0).toFixed(2).replace('.', ',');
const idKey = p => (p.id_peca||'');
const firstThumb = p => (p.imagens && p.imagens[0]) || '';
const tmb = name => `img/tmb/${name}.avif`;
const tmbFallback = name => `img/fallback/${name}.jpg`;

/* rifa: par 25 cada; ímpar = (n-1)*25 + 30 */
function rifaTotal(cnt){ if(!cnt) return 0; return (cnt%2===0) ? 25*cnt : 25*(cnt-1)+30; }
function piecesTotal(){
  let sum=0;
  selectedPieces.forEach(id=>{
    const p = piecesData.find(x=>x.id_peca===id);
    if(p) sum += Number(p.preco||0);
  });
  return sum;
}
function totalAll(){ return piecesTotal() + rifaTotal(selectedRifas.size); }

/* =================== Carregamento =================== */
async function loadData(){
  try{
    const [pecasResp, rifasResp] = await Promise.all([ fetch(PECAS_JSON_URL), fetch(RIFAS_JSON_URL) ]);
    const pecas = await pecasResp.json();
    const rifas = await rifasResp.json();

    // filtra apenas disponíveis
    piecesData = (pecas||[]).filter(p => (String(p.status||'').toUpperCase() !== 'VENDIDAAA'));
    rifasData  = (rifas||[]).filter(r => !(r.status_rifa && String(r.status_rifa).trim() !== ''));

    renderGallery();
    refreshFooter();
  }catch(e){
    console.error('Falha ao carregar JSON', e);
  }
}

/* =================== Galeria: 3 colunas / ordem por linha, desc =================== */
function renderGallery(){
  // limpa colunas
  for(let i=0;i<3;i++) document.getElementById('col'+i).innerHTML='';

  // ordena desc pelo id (ex: "0409", "0408", ...)
  const ordered = [...piecesData].sort((a,b)=> (b.id_peca||'').localeCompare(a.id_peca||''));

  // distribui por linha: 0->col0, 1->col1, 2->col2, 3->col0, ...
  ordered.forEach((p, idx)=>{
    const col = document.getElementById('col'+(idx%3));
    const card = document.createElement('a');
    card.className = 'card' + (selectedPieces.has(p.id_peca)?' selected':'');
    card.href = 'javascript:void(0)';
    const img = document.createElement('img');
    const n = firstThumb(p);
    img.src = tmb(n);
    img.alt = p.titulo || p.id_peca;
    img.onerror = function(){ this.onerror=null; this.src = tmbFallback(n); };
    card.appendChild(img);
    card.addEventListener('click', ()=> togglePiece(p.id_peca));
    col.appendChild(card);
  });
}

/* =================== Seleção =================== */
function togglePiece(id){
  if(selectedPieces.has(id)) selectedPieces.delete(id); else selectedPieces.add(id);
  renderGallery();
  if(openTab==='shop') renderPanelThumbs(); // mantém sincronizado
  refreshFooter();
}

function toggleRifa(id){
  if(selectedRifas.has(id)) selectedRifas.delete(id); else selectedRifas.add(id);
  if(openTab==='rifa') renderPanelThumbs();
  refreshFooter();
}

/* =================== Painel (expansão) =================== */
const panelWrap  = document.getElementById('panelWrap');
const thumbRow   = document.getElementById('thumbRow');
const totalBox   = document.getElementById('totalBox');
const finalizar  = document.getElementById('finalizarBtn');
const backdrop   = document.getElementById('backdrop');

function openPanel(tab){
  openTab = tab;
  // marca ícones ativos/inativos + ícone colorido
  setIcons();

  // renderiza conteúdo
  renderPanelThumbs();

  // mostra expansão
  panelWrap.style.display='block';
  backdrop.style.display='block';

  // mostra botão finalizar só se houver itens
  finalizar.classList.toggle('hidden', (selectedPieces.size+selectedRifas.size)===0);

  // scroll horizontal começa no fim (último adicionado)
  setTimeout(()=> { thumbRow.scrollLeft = thumbRow.scrollWidth; }, 0);
}
function closePanel(){
  openTab = null; setIcons();
  panelWrap.style.display='none';
  backdrop.style.display='none';
}

function setIcons(){
  const shopActive = (openTab==='shop');
  const rifaActive = (openTab==='rifa');

  const btnShop = document.getElementById('btnShop');
  const btnRifa = document.getElementById('btnRifa');
  const iconShop = document.getElementById('iconShop');
  const iconRifa = document.getElementById('iconRifa');

  btnShop.classList.toggle('inactive', !shopActive);
  btnRifa.classList.toggle('inactive', !rifaActive);

  iconShop.src = shopActive ? '/elementos/ticon-SHOP-b.avif' : '/elementos/ticon-SHOP-c.avif';
  iconRifa.src = rifaActive ? '/elementos/ticon-RIFA-b.avif' : '/elementos/ticon-RIFA-c.avif';

  btnShop.setAttribute('aria-expanded', shopActive);
  btnRifa.setAttribute('aria-expanded', rifaActive);
}

function renderPanelThumbs(){
  thumbRow.innerHTML='';

  if(openTab==='shop'){
    // mostrar thumbs das peças
    selectedPieces.forEach(id=>{
      const p = piecesData.find(x=>x.id_peca===id);
      if(!p) return;
      const n = firstThumb(p);
      const box = document.createElement('div'); box.className='thumb';
      const img = document.createElement('img');
      img.src=tmb(n); img.onerror=function(){this.onerror=null;this.src=tmbFallback(n);};
      const x = document.createElement('button'); x.className='close'; x.textContent='×';
      x.title='Remover'; x.onclick=()=>{ selectedPieces.delete(id); renderGallery(); renderPanelThumbs(); refreshFooter(); };
      box.appendChild(img); box.appendChild(x);
      thumbRow.appendChild(box);
    });
  }else if(openTab==='rifa'){
    // thumbs de rifas: criamos botões coloridos com o número
    selectedRifas.forEach(id=>{
      const r = rifasData.find(x=>x.id_rifa===id || x.numero===id);
      const box = document.createElement('div'); box.className='thumb';
      const inner = document.createElement('div');
      inner.style="display:flex;align-items:center;justify-content:center;height:80px;font-weight:900;font-size:22px;border:2px solid var(--ink);";
      inner.textContent = r ? (r.numero || r.id_rifa) : id;
      const x = document.createElement('button'); x.className='close'; x.textContent='×';
      x.title='Remover'; x.onclick=()=>{ selectedRifas.delete(id); renderPanelThumbs(); refreshFooter(); };
      box.appendChild(inner); box.appendChild(x);
      thumbRow.appendChild(box);
    });

    // também mostramos botões de rifas disponíveis para selecionar rapidamente?
    // (mantemos simples nesta etapa para focar no fluxo)
  }

  // total + botão finalizar
  totalBox.textContent = 'TOTAL: ' + money(totalAll());
  finalizar.classList.toggle('hidden', (selectedPieces.size+selectedRifas.size)===0);
}

/* =================== Footer (contadores e cliques) =================== */
function refreshFooter(){
  const cShop = document.getElementById('countShop');
  const cRifa = document.getElementById('countRifa');

  const nShop = selectedPieces.size;
  const nRifa = selectedRifas.size;

  cShop.textContent = nShop; cRifa.textContent = nRifa;
  cShop.classList.toggle('hidden', nShop===0);
  cRifa.classList.toggle('hidden', nRifa===0);
}

/* eventos de abrir/fechar painel */
document.getElementById('btnShop').addEventListener('click', ()=>{
  if(openTab==='shop'){ closePanel(); } else { openPanel('shop'); }
});
document.getElementById('btnRifa').addEventListener('click', ()=>{
  if(openTab==='rifa'){ closePanel(); } else { openPanel('rifa'); }
});
backdrop.addEventListener('click', closePanel);
document.addEventListener('keydown', (ev)=>{ if(ev.key==='Escape') closePanel(); });

document.getElementById('finalizarBtn').addEventListener('click', ()=>{
  if((selectedPieces.size+selectedRifas.size)===0) return;
  const pecas = [...selectedPieces].join(',');
  const rifas = [...selectedRifas].join(',');
  alert('Resumo da aposta:\nPeças: '+pecas+'\nRifas: '+rifas+'\nTotal: '+money(totalAll()));
  // Aqui manteremos só o preview funcional. Integração FormSubmit/GAS entra na próxima etapa.
});

/* =================== Boot =================== */
loadData();
</script>
</body>
</html>
