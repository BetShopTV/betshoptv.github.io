<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Organizador Santacosta - V6 (Edição & Ordem)</title>
<style>
    body { margin: 0; display: flex; height: 100vh; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; }
    
    :root {
        --bg-color: #3c4743;
        --text-color: #4aff98;
        --border-color: #2f3835;
        --hover-color: #44504c;
        --accent-bg: #2f3835;
        --collection-bg: #222826;
        --remove-color: #ff6b6b;
    }

    #sidebar { 
        width: 360px; 
        background: var(--bg-color); 
        color: var(--text-color); 
        display: flex; 
        flex-direction: column; 
        border-right: 1px solid var(--border-color);
        flex-shrink: 0;
    }

    /* CONTROLES */
    #controls {
        padding: 15px;
        background: var(--accent-bg);
        border-bottom: 1px solid var(--text-color);
        display: flex;
        flex-direction: column;
        gap: 8px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        z-index: 10;
    }

    .btn-row { display: flex; gap: 5px; }

    button {
        padding: 6px;
        cursor: pointer;
        border: 1px solid var(--text-color);
        border-radius: 4px;
        font-weight: bold;
        font-size: 10px;
        text-transform: uppercase;
        background: transparent;
        color: var(--text-color);
        flex-grow: 1;
        transition: 0.2s;
    }

    button:hover { background: var(--text-color); color: var(--bg-color); }
    #btnCreateGroup { background: rgba(74, 255, 152, 0.2); }
    #btnCreateCollection { background: rgba(255, 255, 255, 0.1); border-color: #fff; color: #fff; }
    #btnCreateCollection:hover { background: #fff; color: #000; }

    /* ÁREA DE ROLAGEM */
    #sidebar-content {
        overflow-y: auto;
        flex-grow: 1;
        padding-bottom: 50px;
    }

    .section-title {
        padding: 10px 15px;
        background: rgba(0,0,0,0.2);
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: #8fa399;
        border-top: 1px solid var(--border-color);
        border-bottom: 1px solid var(--border-color);
    }

    /* --- SUPER GRUPO (COLEÇÃO) --- */
    .collection-container {
        border-bottom: 1px solid var(--border-color);
        background: var(--collection-bg);
        margin-bottom: 5px;
    }
    .collection-header {
        padding: 8px 10px;
        font-size: 13px;
        font-weight: 900;
        color: #fff;
        background: #1a1f1d;
        cursor: pointer;
        display: flex; justify-content: space-between;
        border-left: 4px solid #fff;
    }
    .collection-content { padding-left: 10px; }

    /* --- GRUPO --- */
    .group-container {
        border-bottom: 1px solid var(--border-color);
        margin-top: 1px;
    }
    
    .group-header {
        padding: 8px 10px;
        background: #36403c;
        display: flex;
        align-items: center;
        user-select: none;
    }
    .group-header:hover { background: var(--hover-color); }
    .group-check { margin-right: 8px; }

    .group-title-area {
        flex-grow: 1;
        cursor: pointer;
        display: flex; justify-content: space-between;
        font-size: 13px;
        font-weight: bold;
    }
    .group-count { font-size: 10px; opacity: 0.7; font-weight: normal; }

    .group-items {
        display: block; 
        background: rgba(0,0,0,0.1);
        padding-bottom: 5px;
    }
    .group-items.collapsed { display: none; }

    /* --- ITEM DENTRO DO GRUPO (Com Botão Remover) --- */
    .sub-item-row {
        display: flex;
        align-items: center;
        padding: 0 10px 0 25px; /* Recuo */
        transition: background 0.2s;
    }
    .sub-item-row:hover { background: rgba(255,255,255,0.05); }

    .sub-item {
        padding: 6px 0;
        font-size: 12px;
        color: var(--text-color);
        cursor: pointer;
        text-decoration: none;
        flex-grow: 1;
        opacity: 0.9;
        border-left: 2px solid transparent;
        padding-left: 5px;
    }
    .sub-item:hover { opacity: 1; color: #fff; }
    .sub-item.active { border-left: 4px solid var(--text-color); font-weight: bold; opacity: 1; }

    /* Botão Remover (X) */
    .btn-remove-item {
        color: var(--remove-color);
        font-weight: bold;
        cursor: pointer;
        padding: 4px 8px;
        font-size: 14px;
        opacity: 0; /* Invisível até passar o mouse */
        transition: opacity 0.2s;
    }
    .sub-item-row:hover .btn-remove-item { opacity: 1; }
    .btn-remove-item:hover { background: rgba(255,0,0,0.2); border-radius: 4px; }


    /* ITEM GERAL (Lista solta) */
    .list-item {
        display: flex; align-items: center;
        border-bottom: 1px solid var(--border-color);
        padding: 6px 10px;
    }
    .list-item.selected-bg { background: #45524d; } 
    
    input[type="checkbox"] {
        cursor: pointer; accent-color: var(--text-color);
        width: 14px; height: 14px; margin-right: 8px;
    }

    #preview { flex-grow: 1; border: none; background: #fff; }

    /* MODAL */
    .modal {
        display: none; position: fixed; z-index: 100; 
        left: 0; top: 0; width: 100%; height: 100%; 
        background-color: rgba(0,0,0,0.8); 
        align-items: center; justify-content: center;
    }
    .modal-content {
        background-color: var(--bg-color); padding: 20px;
        border: 1px solid var(--text-color); width: 450px;
        display: flex; flex-direction: column; gap: 10px;
    }
    textarea {
        width: 100%; height: 250px; background: #222; color: #fff;
        border: 1px solid #555; padding: 10px; resize: none; font-family: monospace;
        font-size: 11px;
    }

</style>
</head>
<body>

<div id="sidebar">
    <div id="controls">
        <button id="btnCreateGroup" onclick="createGroup()">1. Criar Grupo (Itens Selecionados)</button>
        <button id="btnCreateCollection" onclick="createCollection()">2. Agrupar Grupos Selecionados</button>
        
        <div class="btn-row" style="margin-top:5px; border-top: 1px solid #555; padding-top: 5px;">
            <button onclick="copyStructure()">Copiar Relatório</button>
            <button onclick="openImportModal()">Carregar Relatório</button>
        </div>
        <button onclick="toggleGeneralList()" id="btnToggleList">Esconder Lista Geral</button>
        
        <div id="status" style="font-size: 10px; color: #8fa399; margin-top: 2px;">Pronto.</div>
    </div>

    <div id="sidebar-content">
        <div id="structure-container"></div> <div class="section-title" id="general-title">Lista Geral</div>
        <div id="general-list"></div>
    </div>
</div>

<iframe id="preview" name="previewFrame" src="about:blank"></iframe>

<div id="importModal" class="modal">
    <div class="modal-content">
        <h3 style="margin:0; color: #fff;">Carregar Relatório</h3>
        <textarea id="importText" placeholder="Cole aqui seu relatório..."></textarea>
        <div class="btn-row">
            <button onclick="closeImportModal()">Cancelar</button>
            <button onclick="processImport()" style="background: var(--text-color); color: var(--bg-color);">Carregar</button>
        </div>
    </div>
</div>

<script>
    // --- DADOS ---
    let links = [
        { name: "1. Walkie-Talkie", url: "https://www.santacosta.net/walkie-talkie", grouped: false },
        { name: "2. Escultura-Desenho", url: "https://www.santacosta.net/escultura-desenho", grouped: false },
        { name: "3. Draco", url: "https://www.santacosta.net/draco", grouped: false },
        { name: "4. pilha 10", url: "https://www.santacosta.net/serie-pilha-n10", grouped: false },
        { name: "5. pilha 11", url: "https://www.santacosta.net/serie-pilha-n11", grouped: false },
        { name: "6. Baby’s on fire I", url: "https://www.santacosta.net/babys-on-fire-i", grouped: false },
        { name: "7. Pequeno Deslocamento", url: "https://www.santacosta.net/pequeno-deslocamento", grouped: false },
        { name: "8. pilha 15", url: "https://www.santacosta.net/serie-pilha-n15", grouped: false },
        { name: "9. Estrutura II", url: "https://www.santacosta.net/estrutura-ii", grouped: false },
        { name: "10. Reflexos Trinos", url: "https://www.santacosta.net/reflexos-trinos", grouped: false },
        { name: "11. Cópia 3pra1 2 2017", url: "https://www.santacosta.net/copia-3pra1-2-2017", grouped: false },
        { name: "12. Over I", url: "https://www.santacosta.net/over-i", grouped: false },
        { name: "13. Over V", url: "https://www.santacosta.net/over-v", grouped: false },
        { name: "14. Cassiopeia", url: "https://www.santacosta.net/cassiopeia", grouped: false },
        { name: "15. pilha 4", url: "https://www.santacosta.net/serie-pilha-n4", grouped: false },
        { name: "16. Estrutura IV", url: "https://www.santacosta.net/estrutura-iv", grouped: false },
        { name: "17. Wilson Levitante", url: "https://www.santacosta.net/wilson-levitante", grouped: false },
        { name: "18. Winnie 1", url: "https://www.santacosta.net/winnie-1", grouped: false },
        { name: "19. Dragão Negro 1", url: "https://www.santacosta.net/dragao-negro-1", grouped: false },
        { name: "20. Coral IV", url: "https://www.santacosta.net/coral-iv", grouped: false },
        { name: "21. Lua de Cristal", url: "https://www.santacosta.net/lua-de-cristal", grouped: false },
        { name: "22. A Nascente", url: "https://www.santacosta.net/a-nascente", grouped: false },
        { name: "23. Hércules & Luna", url: "https://www.santacosta.net/hercules-luna", grouped: false },
        { name: "24. Over VI", url: "https://www.santacosta.net/over-vi", grouped: false },
        { name: "25. Pilha Ascendente", url: "https://www.santacosta.net/pilha-ascendente", grouped: false },
        { name: "26. Insght e Odenacao", url: "https://www.santacosta.net/insght-e-odenacao", grouped: false },
        { name: "27. Exora", url: "https://www.santacosta.net/exora", grouped: false },
        { name: "28. O Equilibrista", url: "https://www.santacosta.net/o-equilibrista", grouped: false },
        { name: "29. 3pra1", url: "https://www.santacosta.net/3pra1", grouped: false },
        { name: "30. pilha 6", url: "https://www.santacosta.net/serie-pilha-n6", grouped: false },
        { name: "31. Over IV", url: "https://www.santacosta.net/over-iv", grouped: false },
        { name: "32. Lili Marleen", url: "https://www.santacosta.net/lili-marleen", grouped: false },
        { name: "33. Over The Fridge III", url: "https://www.santacosta.net/over-the-fridge-iii", grouped: false },
        { name: "34. pilha 18", url: "https://www.santacosta.net/serie-pilha-n18", grouped: false },
        { name: "35. Bloco Bivolt", url: "https://www.santacosta.net/bloco-bivolt", grouped: false },
        { name: "36. Spark", url: "https://www.santacosta.net/spark", grouped: false },
        { name: "37. Over The Fridge II", url: "https://www.santacosta.net/over-the-fridge-ii", grouped: false },
        { name: "38. pilha 12", url: "https://www.santacosta.net/serie-pilha-n12", grouped: false },
        { name: "39. Cópia Lua de Cristal 2017", url: "https://www.santacosta.net/copia-lua-de-cristal-2017", grouped: false },
        { name: "40. Rock n Roll", url: "https://www.santacosta.net/rock-n-roll", grouped: false },
        { name: "41. Variação VIII", url: "https://www.santacosta.net/variacao-viii", grouped: false },
        { name: "42. Cópia Meia Saco 2016", url: "https://www.santacosta.net/copia-meia-saco-2016", grouped: false },
        { name: "43. It's All Over", url: "https://www.santacosta.net/its-all-over-2017", grouped: false },
        { name: "44. Pequenos Traumas Urbantes II", url: "https://www.santacosta.net/pequenos-traumas-urbantes-ii", grouped: false },
        { name: "45. pilha 5", url: "https://www.santacosta.net/serie-pilha-n5", grouped: false },
        { name: "46. Junção Encoberta", url: "https://www.santacosta.net/juncao-encoberta", grouped: false },
        { name: "47. Sobreposição Infantário", url: "https://www.santacosta.net/sobreposicao-infantario", grouped: false },
        { name: "48. Rimbaud", url: "https://www.santacosta.net/rimbaud", grouped: false },
        { name: "49. Trava Negra", url: "https://www.santacosta.net/trava-negra", grouped: false },
        { name: "50. Objeto de Parede", url: "https://www.santacosta.net/objeto-de-parede", grouped: false },
        { name: "51. Britney", url: "https://www.santacosta.net/britney", grouped: false },
        { name: "52. White Stripes", url: "https://www.santacosta.net/white-stripes", grouped: false },
        { name: "53. Swish Wish 4", url: "https://www.santacosta.net/swish-wish-4", grouped: false },
        { name: "54. Sobreposição Deslocamento", url: "https://www.santacosta.net/sobreposicao-deslocamento", grouped: false },
        { name: "55. Bluezinho", url: "https://www.santacosta.net/bluezinho", grouped: false },
        { name: "56. Junção Exposta", url: "https://www.santacosta.net/juncao-exposta", grouped: false },
        { name: "57. Objeto de Parede V", url: "https://www.santacosta.net/objeto-de-parede-v", grouped: false },
        { name: "58. Over Geeta", url: "https://www.santacosta.net/over-geeta-2015", grouped: false },
        { name: "59. Bug", url: "https://www.santacosta.net/bug", grouped: false },
        { name: "60. Swish Wish 2", url: "https://www.santacosta.net/swish-wish-2", grouped: false },
        { name: "61. N4", url: "https://www.santacosta.net/n4", grouped: false },
        { name: "62. Voadora Delícia", url: "https://www.santacosta.net/voadora-delicia", grouped: false },
        { name: "63. O Sol e o Unicórnio", url: "https://www.santacosta.net/o-sol-e-o-unicornio", grouped: false },
        { name: "64. Sweet Manba", url: "https://www.santacosta.net/sweet-manba", grouped: false },
        { name: "65. Insight & Ordenação II", url: "https://www.santacosta.net/insight-ordenacao-ii", grouped: false },
        { name: "66. Cópia Frozen 2018", url: "https://www.santacosta.net/copia-frozen-2018", grouped: false },
        { name: "67. Auf Wiedersehen, Herr Diktator", url: "https://www.santacosta.net/auf-wiedersehen-her-diktator", grouped: false },
        { name: "68. Agonia e Êxtase", url: "https://www.santacosta.net/agonia-e-extase", grouped: false },
        { name: "69. Ghetto Freak", url: "https://www.santacosta.net/ghetto-freak", grouped: false },
        { name: "70. Sexta Marte", url: "https://www.santacosta.net/sexta-marte", grouped: false },
        { name: "71. Pequenos Traumas Urbantes 1", url: "https://www.santacosta.net/pequenos-traumas-urbantes-1", grouped: false },
        { name: "72. Long Hard Road Out of Hell", url: "https://www.santacosta.net/long-hard-road-out-of-hell", grouped: false },
        { name: "73. La Escalera", url: "https://www.santacosta.net/la-escalera", grouped: false },
        { name: "74. Swish Wish 3", url: "https://www.santacosta.net/swish-wish-3", grouped: false },
        { name: "75. Estrutura VIII", url: "https://www.santacosta.net/estrutura-viii", grouped: false },
        { name: "76. Trago do Silêncio", url: "https://www.santacosta.net/trago-do-silencio", grouped: false },
        { name: "77. Estrutura III", url: "https://www.santacosta.net/estrutura-iii", grouped: false },
        { name: "78. Baby’s on fire III", url: "https://www.santacosta.net/babys-on-fire-iii", grouped: false },
        { name: "79. Outra Língua", url: "https://www.santacosta.net/outra-lingua", grouped: false },
        { name: "80. pilha 9", url: "https://www.santacosta.net/serie-pilha-n9", grouped: false },
        { name: "81. Nino", url: "https://www.santacosta.net/nino", grouped: false },
        { name: "82. pilha 20", url: "https://www.santacosta.net/serie-pilha-n20", grouped: false },
        { name: "83. Pintura D splay", url: "https://www.santacosta.net/pintura-d-splay", grouped: false },
        { name: "84. pilha 14", url: "https://www.santacosta.net/serie-pilha-n14", grouped: false },
        { name: "85. Enfeito", url: "https://www.santacosta.net/enfeito", grouped: false },
        { name: "86. Escultura de Colagem", url: "https://www.santacosta.net/escultura-de-colagem", grouped: false },
        { name: "87. Leo H", url: "https://www.santacosta.net/leo-h", grouped: false },
        { name: "88. Serpentarius", url: "https://www.santacosta.net/serpentarius", grouped: false },
        { name: "89. Dragão Verde", url: "https://www.santacosta.net/dragao-verde", grouped: false },
        { name: "90. pilha 19", url: "https://www.santacosta.net/serie-pilha-n19", grouped: false },
        { name: "91. Balyba", url: "https://www.santacosta.net/balyba", grouped: false },
        { name: "92. Orion", url: "https://www.santacosta.net/orion", grouped: false },
        { name: "93. Objeto de Parede VI", url: "https://www.santacosta.net/objeto-de-parede-vi", grouped: false },
        { name: "94. Estrutura VI", url: "https://www.santacosta.net/estrutura-vi", grouped: false },
        { name: "95. Objeto Contrastante", url: "https://www.santacosta.net/objeto-contrastante", grouped: false },
        { name: "96. Napalm", url: "https://www.santacosta.net/napalm", grouped: false },
        { name: "97. Variação II", url: "https://www.santacosta.net/variacao-ii", grouped: false },
        { name: "98. Blackbird", url: "https://www.santacosta.net/blackbird", grouped: false },
        { name: "99. pilha 2", url: "https://www.santacosta.net/serie-pilha-n2", grouped: false },
        { name: "100. Meia Saco", url: "https://www.santacosta.net/meia-saco", grouped: false },
        { name: "101. O Xamã e a Desculpa", url: "https://www.santacosta.net/o-xama-e-a-desculpa", grouped: false },
        { name: "102. Infantário Pareado", url: "https://www.santacosta.net/infantario-pareado", grouped: false },
        { name: "103. Baby’s on fire II", url: "https://www.santacosta.net/babys-on-fire-ii", grouped: false },
        { name: "104. Over The Fridge", url: "https://www.santacosta.net/over-the-fridge-2016", grouped: false },
        { name: "105. pilha 1", url: "https://www.santacosta.net/serie-pilha-n1", grouped: false },
        { name: "106. B&G", url: "https://www.santacosta.net/b-g", grouped: false },
        { name: "107. Junção Estranha", url: "https://www.santacosta.net/juncao-estranha", grouped: false },
        { name: "108. Escultura de Paisagem", url: "https://www.santacosta.net/escultura-de-paisagem", grouped: false },
        { name: "109. Lua", url: "https://www.santacosta.net/lua", grouped: false },
        { name: "110. Fardo", url: "https://www.santacosta.net/fardo", grouped: false },
        { name: "111. Estrutura I", url: "https://www.santacosta.net/estrutura-i", grouped: false },
        { name: "112. Madam", url: "https://www.santacosta.net/madam", grouped: false },
        { name: "113. Ninho", url: "https://www.santacosta.net/ninho", grouped: false },
        { name: "114. pilha 17", url: "https://www.santacosta.net/serie-pilha-n17", grouped: false },
        { name: "115. Swish Wish", url: "https://www.santacosta.net/swish-wish", grouped: false },
        { name: "116. Estrutura V", url: "https://www.santacosta.net/estrutura-v", grouped: false },
        { name: "117. Dragão Vermelho", url: "https://www.santacosta.net/dragao-vermelho", grouped: false },
        { name: "118. Pequenos Traumas Urbanos III", url: "https://www.santacosta.net/pequenos-traumas-urbanos-iii", grouped: false },
        { name: "119. Mafalda", url: "https://www.santacosta.net/mafalda", grouped: false },
        { name: "120. O Noivo", url: "https://www.santacosta.net/o-noivo", grouped: false },
        { name: "121. Matrix Medusa", url: "https://www.santacosta.net/matrix-medusa", grouped: false },
        { name: "122. Clayborn", url: "https://www.santacosta.net/clayborn", grouped: false },
        { name: "123. Over The Fridge IV", url: "https://www.santacosta.net/over-the-fridge-iv", grouped: false },
        { name: "124. Estrutura VII", url: "https://www.santacosta.net/estrutura-vii", grouped: false },
        { name: "125. Coral", url: "https://www.santacosta.net/coral", grouped: false },
        { name: "126. pilha 16", url: "https://www.santacosta.net/serie-pilha-n16", grouped: false },
        { name: "127. Cópia Pequenos Traumas Urbanos II 2", url: "https://www.santacosta.net/copia-pequenos-traumas-urbanos-ii-2", grouped: false },
        { name: "128. pilha 7", url: "https://www.santacosta.net/serie-pilha-n7", grouped: false },
        { name: "129. pilha 8", url: "https://www.santacosta.net/serie-pilha-n8", grouped: false },
        { name: "130. Over The Fridge I", url: "https://www.santacosta.net/over-the-fridge-i-2016", grouped: false },
        { name: "131. 11 Degraus", url: "https://www.santacosta.net/11-degraus", grouped: false },
        { name: "132. Over Bikini Wasabi", url: "https://www.santacosta.net/over-bikini-wasabi", grouped: false },
        { name: "133. Petit Voiture", url: "https://www.santacosta.net/petit-voiture", grouped: false },
        { name: "134. pilha 3", url: "https://www.santacosta.net/serie-pilha-n3", grouped: false },
        { name: "135. Over II", url: "https://www.santacosta.net/over-ii", grouped: false },
        { name: "136. Over III", url: "https://www.santacosta.net/over-iii", grouped: false },
        { name: "137. Animal Negro", url: "https://www.santacosta.net/animal-negro", grouped: false },
        { name: "138. Tensão e Ruptura", url: "https://www.santacosta.net/tensao-e-ruptura", grouped: false },
        { name: "139. 3pra1 2", url: "https://www.santacosta.net/3pra1-2", grouped: false },
        { name: "140. Cova", url: "https://www.santacosta.net/cova", grouped: false },
        { name: "141. 1, 2, 33", url: "https://www.santacosta.net/1-2-33", grouped: false },
        { name: "142. Variação I", url: "https://www.santacosta.net/variacao-i", grouped: false },
        { name: "143. 12:21", url: "https://www.santacosta.net/1221", grouped: false },
        { name: "144. Badalo", url: "https://www.santacosta.net/badalo", grouped: false },
        { name: "145. Residência W", url: "https://www.santacosta.net/residencia-w", grouped: false },
        { name: "146. Textos", url: "https://www.santacosta.net/textos", grouped: false },
        { name: "147. Exposição Over Witty - Galeria Emma Thomas", url: "https://www.santacosta.net/exposicao-over-witty-2016", grouped: false },
        { name: "148. Cópia Exp 2", url: "https://www.santacosta.net/copia-exp-2", grouped: false },
        { name: "149. Biografia", url: "https://www.santacosta.net/biografia", grouped: false },
        { name: "150. Lava", url: "https://www.santacosta.net/lava", grouped: false },
        { name: "151. 26º SLAC", url: "https://www.santacosta.net/26o-slac", grouped: false },
        { name: "152. Exposição Over Witty", url: "https://www.santacosta.net/exposicao-over-witty", grouped: false },
        { name: "153. Fullscreen Page", url: "https://www.santacosta.net/fullscreen-page", grouped: false },
        { name: "154. It's All Over", url: "https://www.santacosta.net/it-s-all-over-2017", grouped: false },
        { name: "155. Currículo", url: "https://www.santacosta.net/curriculo", grouped: false },
        { name: "156. Notícias", url: "https://www.santacosta.net/noticias", grouped: false },
        { name: "157. Santacosta", url: "https://www.santacosta.net/santacosta", grouped: false },
        { name: "158. Sirva-se do que quiser", url: "https://www.santacosta.net/sirva-se-do-que-quiser", grouped: false },
        { name: "159. Trabalhos / Works", url: "https://www.santacosta.net/trabalhos-works", grouped: false },
        { name: "160. Exposições - Galeria Lamb Arts", url: "https://www.santacosta.net/exposicoes-galeria-lamb-arts", grouped: false },
        { name: "161. Cópia Exp 1", url: "https://www.santacosta.net/copia-exp-1", grouped: false },
    ];

    // Groups & Collections
    let groups = [];
    let collections = [];

    // Pre-load exclusions
    const preloadedExclusions = [
        "https://www.santacosta.net/walkie-talkie",
        "https://www.santacosta.net/serie-pilha-n11",
        "https://www.santacosta.net/serie-pilha-n15",
        "https://www.santacosta.net/copia-3pra1-2-2017",
        "https://www.santacosta.net/over-v",
        "https://www.santacosta.net/serie-pilha-n4",
        "https://www.santacosta.net/lua-de-cristal",
        "https://www.santacosta.net/a-nascente",
        "https://www.santacosta.net/over-vi",
        "https://www.santacosta.net/exora",
        "https://www.santacosta.net/serie-pilha-n6",
        "https://www.santacosta.net/lili-marleen",
        "https://www.santacosta.net/serie-pilha-n18",
        "https://www.santacosta.net/over-the-fridge-ii",
        "https://www.santacosta.net/serie-pilha-n12",
        "https://www.santacosta.net/copia-lua-de-cristal-2017",
        "https://www.santacosta.net/rock-n-roll",
        "https://www.santacosta.net/copia-meia-saco-2016",
        "https://www.santacosta.net/pequenos-traumas-urbantes-ii",
        "https://www.santacosta.net/serie-pilha-n5",
        "https://www.santacosta.net/sobreposicao-infantario",
        "https://www.santacosta.net/rimbaud",
        "https://www.santacosta.net/swish-wish-4",
        "https://www.santacosta.net/bluezinho",
        "https://www.santacosta.net/over-geeta-2015",
        "https://www.santacosta.net/bug",
        "https://www.santacosta.net/voadora-delicia",
        "https://www.santacosta.net/sweet-manba",
        "https://www.santacosta.net/auf-wiedersehen-her-diktator",
        "https://www.santacosta.net/ghetto-freak",
        "https://www.santacosta.net/sexta-marte",
        "https://www.santacosta.net/pequenos-traumas-urbantes-1",
        "https://www.santacosta.net/babys-on-fire-iii",
        "https://www.santacosta.net/serie-pilha-n20",
        "https://www.santacosta.net/enfeito",
        "https://www.santacosta.net/leo-h",
        "https://www.santacosta.net/serie-pilha-n19",
        "https://www.santacosta.net/objeto-contrastante",
        "https://www.santacosta.net/napalm",
        "https://www.santacosta.net/serie-pilha-n2",
        "https://www.santacosta.net/meia-saco",
        "https://www.santacosta.net/o-xama-e-a-desculpa",
        "https://www.santacosta.net/serie-pilha-n1",
        "https://www.santacosta.net/juncao-estranha",
        "https://www.santacosta.net/madam",
        "https://www.santacosta.net/o-noivo",
        "https://www.santacosta.net/matrix-medusa",
        "https://www.santacosta.net/copia-pequenos-traumas-urbanos-ii-2",
        "https://www.santacosta.net/serie-pilha-n7",
        "https://www.santacosta.net/over-the-fridge-i-2016",
        "https://www.santacosta.net/serie-pilha-n3",
        "https://www.santacosta.net/over-ii"
    ];

    function init() {
        // 1. Limpeza de Nomes (Remove numeração)
        links.forEach(l => {
            // Regex: Começa com numeros, seguido de ponto e espaços opcional
            l.name = l.name.replace(/^\d+\.\s*/, '');
        });

        // 2. Setup Grupo Excluídos
        groups.push({ name: "EXCLUÍDOS", collection: null, selected: false, collapsed: true });
        
        links.forEach(link => {
            if (preloadedExclusions.includes(link.url)) {
                link.grouped = "EXCLUÍDOS";
            }
        });
        
        render();
    }

    // --- RENDER ---
    const structureContainer = document.getElementById('structure-container');
    const generalListContainer = document.getElementById('general-list');
    const iframe = document.getElementById('preview');
    let generalListVisible = true;

    function render() {
        structureContainer.innerHTML = "";
        generalListContainer.innerHTML = "";

        // 1. RENDER COLLECTIONS
        collections.forEach(col => {
            const colDiv = document.createElement('div');
            colDiv.className = 'collection-container';
            const header = document.createElement('div');
            header.className = 'collection-header';
            header.textContent = col.name;
            colDiv.appendChild(header);

            const contentDiv = document.createElement('div');
            contentDiv.className = 'collection-content';

            const childGroups = groups.filter(g => g.collection === col.name);
            childGroups.forEach(g => contentDiv.appendChild(createGroupElement(g)));

            colDiv.appendChild(contentDiv);
            structureContainer.appendChild(colDiv);
        });

        // 2. RENDER INDEPENDENT GROUPS
        const indepGroups = groups.filter(g => g.collection === null);
        indepGroups.forEach(g => structureContainer.appendChild(createGroupElement(g)));

        // 3. RENDER GENERAL LIST (Sorted Alphabetically)
        const ungrouped = links.filter(l => l.grouped === false);
        // ORDENAÇÃO A-Z
        ungrouped.sort((a, b) => a.name.localeCompare(b.name));

        ungrouped.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'list-item';
            
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.checked = item.selected || false;
            checkbox.onchange = (e) => {
                item.selected = e.target.checked;
                if(item.selected) div.classList.add('selected-bg');
                else div.classList.remove('selected-bg');
                updateStatus();
            };

            const a = document.createElement('a');
            a.textContent = item.name;
            a.style.fontSize = "12px"; a.style.cursor="pointer"; a.style.color="var(--text-color)";
            a.onclick = (e) => loadPreview(item.url, e.target);

            div.appendChild(checkbox);
            div.appendChild(a);
            generalListContainer.appendChild(div);
        });

        updateStatus();
    }

    function createGroupElement(group) {
        // Items in this group
        const items = links.filter(l => l.grouped === group.name);
        // ORDENAÇÃO A-Z DENTRO DO GRUPO
        items.sort((a, b) => a.name.localeCompare(b.name));

        const groupDiv = document.createElement('div');
        groupDiv.className = 'group-container';

        const header = document.createElement('div');
        header.className = 'group-header';

        const check = document.createElement('input');
        check.type = 'checkbox';
        check.className = 'group-check';
        check.checked = group.selected || false;
        check.onchange = (e) => {
            group.selected = e.target.checked;
            updateStatus();
        };

        const titleArea = document.createElement('div');
        titleArea.className = 'group-title-area';
        const arrow = group.collapsed ? '►' : '▼';
        titleArea.innerHTML = `<span>${group.name}</span><span class="group-count">(${items.length}) ${arrow}</span>`;
        
        const itemsDiv = document.createElement('div');
        itemsDiv.className = 'group-items';
        if (group.collapsed) itemsDiv.classList.add('collapsed');

        titleArea.onclick = () => {
            group.collapsed = !group.collapsed;
            render();
        };

        // Render items inside with Remove Button
        items.forEach(item => {
            const row = document.createElement('div');
            row.className = 'sub-item-row';

            // Link
            const sub = document.createElement('a');
            sub.className = 'sub-item';
            sub.textContent = item.name;
            sub.onclick = (e) => loadPreview(item.url, e.target);

            // Remove Button
            const btnRemove = document.createElement('span');
            btnRemove.className = 'btn-remove-item';
            btnRemove.textContent = '✕';
            btnRemove.title = "Remover do grupo";
            btnRemove.onclick = (e) => {
                removeFromGroup(item);
                e.stopPropagation(); // Impede clique no item
            };

            row.appendChild(sub);
            row.appendChild(btnRemove); // Botão à direita
            itemsDiv.appendChild(row);
        });

        header.appendChild(check);
        header.appendChild(titleArea);
        groupDiv.appendChild(header);
        groupDiv.appendChild(itemsDiv);

        return groupDiv;
    }

    // --- ACTIONS ---

    function removeFromGroup(item) {
        item.grouped = false; // Volta pra lista geral
        item.selected = false;
        render();
    }

    function createGroup() {
        const selectedItems = links.filter(l => l.grouped === false && l.selected);
        if (selectedItems.length === 0) {
            alert("Selecione itens da lista geral.");
            return;
        }
        const name = prompt("Nome do Grupo:");
        if(!name) return;

        groups.unshift({ name: name, collection: null, selected: false });
        selectedItems.forEach(i => { i.grouped = name; i.selected = false; });
        render();
    }

    function createCollection() {
        const selectedGroups = groups.filter(g => g.selected && g.collection === null);
        if (selectedGroups.length === 0) {
            alert("Selecione grupos independentes para criar um Super Grupo.");
            return;
        }
        const name = prompt("Nome do Super Grupo (Coleção):");
        if(!name) return;

        collections.unshift({ name: name });
        selectedGroups.forEach(g => {
            g.collection = name;
            g.selected = false;
        });
        render();
    }

    function loadPreview(url, el) {
        iframe.src = url;
        document.querySelectorAll('.active').forEach(e => e.classList.remove('active'));
        if(el) el.classList.add('active');
    }

    function toggleGeneralList() {
        generalListVisible = !generalListVisible;
        document.getElementById('general-list').style.display = generalListVisible ? 'block' : 'none';
        document.getElementById('general-title').style.display = generalListVisible ? 'block' : 'none';
        document.getElementById('btnToggleList').textContent = generalListVisible ? "Esconder Lista Geral" : "Mostrar Lista Geral";
    }

    function updateStatus() {
        const iCount = links.filter(l => l.grouped === false && l.selected).length;
        const gCount = groups.filter(g => g.selected).length;
        document.getElementById('status').textContent = `Sel: ${iCount} itens, ${gCount} grupos`;
    }

    // --- IMPORT / EXPORT ---
    function copyStructure() {
        let text = "### RELATÓRIO HIERÁRQUICO SANTACOSTA ###\n\n";
        collections.forEach(col => {
            text += `>>> SUPER: ${col.name}\n`;
            const childGroups = groups.filter(g => g.collection === col.name);
            childGroups.forEach(g => {
                text += `   ### GRUPO: ${g.name}\n`;
                links.filter(l => l.grouped === g.name).forEach(i => {
                    text += `   - ${i.name} (${i.url})\n`;
                });
            });
            text += "\n";
        });
        const indepGroups = groups.filter(g => g.collection === null);
        if(indepGroups.length > 0) {
            text += ">>> INDEPENDENTES\n";
            indepGroups.forEach(g => {
                text += `### GRUPO: ${g.name}\n`;
                links.filter(l => l.grouped === g.name).forEach(i => {
                    text += `- ${i.name} (${i.url})\n`;
                });
            });
        }
        navigator.clipboard.writeText(text).then(() => alert("Copiado!"));
    }

    function openImportModal() { document.getElementById('importModal').style.display = 'flex'; }
    function closeImportModal() { document.getElementById('importModal').style.display = 'none'; }

    function processImport() {
        const text = document.getElementById('importText').value;
        if(!text) return;

        groups = [];
        collections = [];
        links.forEach(l => { l.grouped = false; l.selected = false; });

        const lines = text.split('\n');
        let currentCollection = null;
        let currentGroup = null;

        lines.forEach(line => {
            line = line.trim();
            if(!line) return;

            if(line.startsWith('>>> SUPER:')) {
                currentCollection = line.replace('>>> SUPER:', '').trim();
                collections.push({ name: currentCollection });
                currentGroup = null;
            }
            else if(line.startsWith('>>> INDEPENDENTES')) {
                currentCollection = null;
                currentGroup = null;
            }
            else if(line.startsWith('### GRUPO:')) {
                const gName = line.replace('### GRUPO:', '').trim();
                currentGroup = gName;
                groups.push({ name: gName, collection: currentCollection, selected: false });
            }
            else if(line.startsWith('- ') && currentGroup) {
                const urlMatch = line.match(/\((https?:\/\/.*?)\)/);
                if (urlMatch) {
                    const found = links.find(l => l.url === urlMatch[1]);
                    if(found) found.grouped = currentGroup;
                }
            }
        });
        render();
        closeImportModal();
        alert("Restaurado!");
    }

    init();
</script>
</body>
</html>
