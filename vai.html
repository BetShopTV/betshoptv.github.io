<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Checkout</title>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    :root {
      --red: #FF0000;
      --ink: #2B2424;
      --white: #FFFFFF;
      --gray: #BEBAB0;
    }

    html, body {
      margin: 0;
      background: var(--gray);
      color: var(--ink);
      font-family: Arial, sans-serif;
      font-size: 16px;
    }

    .app {
      max-width: 1100px;
      margin: 0 auto;
      padding: 16px;
    }

    h1 {
      font-size: 1.6rem;
      font-weight: bold;
      margin-bottom: 16px;
    }

    .modal {
      width: 100%;
      max-width: 1100px;
      background: var(--gray);
      border: 2px solid var(--red);
      display: flex;
      flex-direction: column;
    }

    .bar, .foot {
      background: var(--gray);
      border-top: 2px solid var(--red);
      border-bottom: 2px solid var(--red);
      padding: 10px 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .sheet {
      padding: 16px;
      flex: 1;
    }

    .btn {
      background: var(--gray);
      color: var(--ink);
      border: 2px solid var(--ink);
      font-weight: bold;
      padding: 8px 14px;
      cursor: pointer;
    }

    .btn.red {
      background: var(--red);
      color: var(--white);
      border-color: var(--red);
    }

    .row {
      display: grid;
      grid-template-columns: 40px 1fr 110px;
      gap: 8px;
      align-items: center;
      margin-bottom: 10px;
    }

    .btn-x {
      width: 36px;
      height: 36px;
      background: var(--white);
      border: 2px solid var(--ink);
      font-weight: bold;
      cursor: pointer;
    }

    .thumb {
      width: 46px;
      height: 46px;
      object-fit: cover;
      background: var(--white);
      border: 2px solid var(--ink);
    }

    .price {
      text-align: right;
      padding: 6px 8px;
      border: 2px solid var(--ink);
      background: var(--white);
    }

    .form label {
      font-weight: bold;
      display: block;
      margin: 12px 0 4px;
    }

    .form input {
      width: 100%;
      height: 42px;
      padding: 8px;
      border: 2px solid var(--ink);
      background: var(--white);
      box-sizing: border-box;
    }

    .qrBox {
      width: 180px;
      height: 180px;
      border: 2px solid var(--ink);
      background: var(--white);
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 12px;
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>Checkout</h1>

    <div class="modal" id="modal">
      <div class="bar">
        <div id="stepTitle">1 | CONFIRA</div>
        <button class="btn" onclick="resetAll()">FECHAR</button>
      </div>

      <div class="sheet" id="sheet"></div>

      <div class="foot">
        <div id="total">Total: R$ 0</div>
        <div>
          <button class="btn" id="btnVoltar" onclick="prevStep()">Voltar</button>
          <button class="btn red" id="btnAvancar" onclick="nextStep()">Avançar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Form Submit -->
  <form id="hiddenForm" method="POST">
    <input type="hidden" name="_next" value="https://betshoptv.com/obrigado.html">
    <input type="hidden" name="_captcha" value="false">
    <input type="hidden" name="_subject" value="Nova Aposta BSTV">
    <input type="hidden" name="nome" id="fNome">
    <input type="hidden" name="email" id="fEmail">
    <input type="hidden" name="telefone" id="fTelefone">
    <input type="hidden" name="pecas" id="fPecas">
    <input type="hidden" name="rifas" id="fRifas">
    <input type="hidden" name="favoritas" id="fFav">
    <input type="hidden" name="total" id="fTotal">
  </form>

  <script>
    const FORMSUBMIT_URL = "https://formsubmit.co/b7c03bfd6671addd4ddd857cb7e53d3d";
    const GAS_URL = "https://script.google.com/macros/s/AKfycbwsX8iGOv_mg0bhY8iRGACMGte56FXVo6ursYG_K4cq0Y50jW3g34_GX3uJU3U-Vwo0UQ/exec";

    const rifasData = [
      { id: "0301", label: "Rifa 0301" },
      { id: "0302", label: "Rifa 0302" },
      { id: "0303", label: "Rifa 0303" }
    ];
    const pecasData = [
      { id: "0403", titulo: "Peça 0403", preco: 150, thumb: "https://via.placeholder.com/46" }
    ];
    const favoritasData = [
      { id: "0407", titulo: "Favorita 0407", thumb: "https://via.placeholder.com/46" }
    ];

    let rifasSel = new Set(["0301"]);
    let pecasSel = new Set(["0403"]);
    let favSel = new Set(["0407"]);
    let step = 1;

    const fmt = v => 'R$ ' + Math.round(Number(v || 0));
    const totalAtual = () => pecasData.filter(p => pecasSel.has(p.id)).reduce((s, p) => s + p.preco, 0);

    function resetAll() {
      location.reload();
    }

    function prevStep() {
      step = Math.max(1, step - 1);
      render();
    }

    function nextStep() {
      if (step === 1) return step = 2, render();
      if (step === 2) {
        const nome = document.getElementById('inNome').value.trim();
        const email = document.getElementById('inEmail').value.trim();
        if (!nome || !email) return alert("Preencha nome e e-mail.");
        step = 3; return render();
      }
      if (step === 3) return enviarDados();
    }

    function render() {
      document.getElementById("stepTitle").textContent =
        step === 1 ? "1 | CONFIRA" : step === 2 ? "2 | DADOS" : "3 | PAGAMENTO";
      document.getElementById("sheet").innerHTML = "";
      document.getElementById("total").textContent = "Total: " + fmt(totalAtual());
      document.getElementById("btnVoltar").disabled = step === 1;
      document.getElementById("btnAvancar").textContent = step === 3 ? "Confirmar" : "Avançar";

      if (step === 1) renderStep1();
      if (step === 2) renderStep2();
      if (step === 3) renderStep3();
    }

    function renderStep1() {
      const root = document.getElementById("sheet");
      pecasData.forEach(p => {
        if (!pecasSel.has(p.id)) return;
        const row = document.createElement("div");
        row.className = "row";
        row.innerHTML = `
          <button class="btn-x" onclick="pecasSel.delete('${p.id}'); render()">X</button>
          <div><img src="${p.thumb}" class="thumb"> ${p.titulo}</div>
          <div class="price">${fmt(p.preco)}</div>`;
        root.appendChild(row);
      });
    }

    function renderStep2() {
      const root = document.getElementById("sheet");
      root.innerHTML = `
        <div class="form">
          <label for="inNome">Nome *</label>
          <input id="inNome" type="text">
          <label for="inEmail">Email *</label>
          <input id="inEmail" type="email">
          <label for="inTel">Telefone</label>
          <input id="inTel" type="tel">
        </div>`;
    }

    function renderStep3() {
      const root = document.getElementById("sheet");
      const qrBox = document.createElement("div");
      qrBox.className = "qrBox";
      qrBox.id = "qrCode";

      root.innerHTML = `<div>
        <div class="qrBox" id="qrCode"></div>
        <p><strong>Total:</strong> ${fmt(totalAtual())}</p>
      </div>`;

      new QRCode(document.getElementById("qrCode"), {
        text: "PIX simulando...",
        width: 170,
        height: 170
      });
    }

    function enviarDados() {
      const nome = document.getElementById("inNome").value.trim();
      const email = document.getElementById("inEmail").value.trim();
      const telefone = document.getElementById("inTel").value.trim();
      const pecas = [...pecasSel].join(",");
      const rifas = [...rifasSel].join(",");
      const favoritas = [...favSel].join(",");
      const total = totalAtual();

      document.getElementById("fNome").value = nome;
      document.getElementById("fEmail").value = email;
      document.getElementById("fTelefone").value = telefone;
      document.getElementById("fPecas").value = pecas;
      document.getElementById("fRifas").value = rifas;
      document.getElementById("fFav").value = favoritas;
      document.getElementById("fTotal").value = total;

      // GAS
      try {
        const fd = new FormData();
        fd.append("nome", nome);
        fd.append("email", email);
        fd.append("telefone", telefone);
        fd.append("pecas", pecas);
        fd.append("rifas", rifas);
        fd.append("favoritas", favoritas);
        fd.append("total", String(total));
        fetch(GAS_URL, { method: "POST", body: fd, mode: "no-cors" });
      } catch (e) {
        console.warn("GAS falhou", e);
      }

      // FormSubmit
      const form = document.getElementById("hiddenForm");
      form.action = FORMSUBMIT_URL;
      form.submit();
    }

    render();
  </script>
</body>
</html>
