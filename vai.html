<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BetShopTV – Galeria + Feed + Rifas (Versão B)</title>
<link rel="preconnect" href="https://betshoptv.com/fonts/">
<style>
  /* TOKENS */
  :root{
    --red:#ff0000; --ink:#2b2424; --beige:#bebab0; --white:#ffffff;
    --bd-thin:1px; --bd-thick:2px;
    --ff-cta:"Roboto Condensed", system-ui, -apple-system, Segoe UI, Arial, sans-serif;
    --ff-body:"Roboto SemiCondensed", system-ui, -apple-system, Segoe UI, Arial, sans-serif;
    --fs-h1:clamp(1.4rem,3vw,2rem); --fs-h2:clamp(1.1rem,2vw,1.4rem);
    --fs-p:clamp(.9rem,1.2vw,1rem); --fs-sm:clamp(.78rem,1vw,.9rem);
    --gap-xxs:4px; --gap-xs:6px; --gap-s:8px; --gap-m:12px; --gap-l:16px;
  }
  html,body{margin:0;padding:0;background:var(--beige);color:var(--ink);font-family:var(--ff-body);}
  /* Cabeçalho vermelho */
  header{position:sticky;top:0;z-index:10;background:var(--red);color:#fff;border-bottom:var(--bd-thick) solid var(--ink);}
  .hdr-inner{max-width:1200px;margin:0 auto;display:flex;align-items:center;gap:12px;padding:10px var(--gap-m);}
  .logo{font:700 var(--fs-h2)/1 var(--ff-cta);text-transform:uppercase;}
  .nav{margin-left:auto;display:flex;gap:8px;flex-wrap:wrap}
  .nav a{display:inline-flex;align-items:center;justify-content:center;height:36px;padding:0 10px;border:var(--bd-thin) solid #fff;color:#fff;text-decoration:none;font:700 var(--fs-sm)/1 var(--ff-cta);text-transform:uppercase}
  .nav a:hover{background:#fff;color:var(--ink)}
  /* Seções */
  main{max-width:1200px;margin:0 auto;padding:var(--gap-m);}
  section{margin-bottom:24px}
  h2{font:700 var(--fs-h2)/1.2 var(--ff-cta);margin:0 0 8px}
  /* Galeria 3 colunas SEMPRE */
  .galeria{display:grid;grid-template-columns:repeat(3,1fr);gap:var(--gap-xs)}
  .gal-item{border:var(--bd-thin) solid var(--ink);background:#fff;cursor:pointer}
  .gal-item img{display:block;width:100%;height:auto}
  .gal-item .ttl{padding:6px;font:700 var(--fs-sm)/1.2 var(--ff-cta)}
  /* Feed (lista vertical) */
  .feed{display:flex;flex-direction:column;gap:var(--gap-s)}
  .post{border:var(--bd-thin) solid var(--ink);background:#fff}
  .post .carousel{display:flex;gap:var(--gap-xxs);overflow-x:auto;scroll-snap-type:x mandatory;padding:var(--gap-xxs);background:var(--white)}
  .post .carousel img{flex:0 0 86%;max-width:86%;height:auto;scroll-snap-align:center;border:var(--bd-thin) solid var(--ink)}
  .post .meta{padding:8px 10px}
  .post .meta .linha1{display:flex;justify-content:space-between;align-items:center;gap:8px}
  .preco{font:600 var(--fs-p)/1 var(--ff-body)}
  .titulo{font:700 var(--fs-p)/1.2 var(--ff-cta)}
  .ficha{font:400 var(--fs-sm)/1.4 var(--ff-body);opacity:.9}
  .acoes{display:flex;gap:8px;margin-top:8px}
  .btn{font:700 var(--fs-sm)/1 var(--ff-cta);text-transform:uppercase;border:var(--bd-thin) solid var(--ink);background:var(--ink);color:#fff;padding:6px 10px;cursor:pointer}
  .btn--sec{background:var(--red);border-color:var(--ink)}
  .btn:hover{filter:brightness(1.05)}
  .fav{background:#fff;color:var(--ink)}
  .fav.active{background:var(--red);color:#fff}
  /* Rifas “tijolo” */
  .rifas{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:var(--gap-xs)}
  .rifa-btn{display:flex;align-items:center;justify-content:center;min-height:56px;text-align:center;padding:6px;border:var(--bd-thin) solid var(--ink);color:#fff;font:700 var(--fs-sm)/1.1 var(--ff-cta);text-transform:uppercase;cursor:pointer}
  .rifa-btn span{display:block}
  .rifa-btn .ln2{opacity:.95}
  .rifa-btn.sold{opacity:.45;cursor:not-allowed;filter:grayscale(1)}
  /* Rodapé preto */
  footer{position:sticky;bottom:0;background:var(--ink);color:#fff;border-top:var(--bd-thick) solid var(--ink)}
  .ftr-inner{max-width:1200px;margin:0 auto;display:flex;gap:10px;align-items:center;justify-content:space-between;padding:10px var(--gap-m)}
  .contadores{display:flex;gap:8px;flex-wrap:wrap}
  .pill{background:#fff;color:var(--ink);border:var(--bd-thin) solid var(--ink);padding:4px 8px;font:700 var(--fs-sm)/1 var(--ff-cta)}
  .cta-final{background:var(--red);color:#fff;border:var(--bd-thin) solid #fff;padding:8px 12px;font:700 var(--fs-sm)/1 var(--ff-cta);text-transform:uppercase;cursor:pointer}
 /* Drawer / carrinho */
#carrinho{position:relative;margin:0 0 24px}
.cart-wrap{border:var(--bd-thin) solid var(--ink);background:#fff}
.cart-tabs{display:flex;gap:6px;align-items:center;justify-content:flex-start;padding:6px;background:var(--beige);border-bottom:var(--bd-thin) solid var(--ink)}
.cart-tab{border:var(--bd-thin) solid var(--ink);background:var(--ink);color:#fff;font:700 var(--fs-sm)/1 var(--ff-cta);text-transform:uppercase;padding:6px 10px;cursor:pointer}
.cart-tab.is-active{background:var(--red)}
.cart-close{margin-left:auto;border:var(--bd-thin) solid var(--ink);background:#fff;color:var(--ink);font:700 var(--fs-sm)/1 var(--ff-cta);padding:6px 10px;cursor:pointer}
.cart-body{padding:10px}
.cart-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:8px}
.cart-item{border:var(--bd-thin) solid var(--ink);background:#fff}
.cart-item img{width:100%;height:auto;display:block;border-bottom:var(--bd-thin) solid var(--ink)}
.cart-item .ci-meta{padding:6px}
.cart-item .ci-ttl{font:700 var(--fs-sm)/1.2 var(--ff-cta)}
.cart-item .ci-act{margin-top:6px;display:flex;gap:6px}
.cart-item .btn-remove{border:var(--bd-thin) solid var(--ink);background:var(--red);color:#fff;font:700 var(--fs-sm)/1 var(--ff-cta);padding:4px 8px;cursor:pointer}
  /* Suporte a foco na peça via âncora */
  .post:target{outline:2px solid var(--red)}
  /* Scrollbars (opcional) */
  .post .carousel::-webkit-scrollbar{height:6px}
  .post .carousel::-webkit-scrollbar-thumb{background:var(--red)}
</style>
</head>
<body>
<header>
  <div class="hdr-inner">
    <div class="logo">BetShopTV</div>
    <nav class="nav">
      <a href="#galeria">Galeria</a>
      <a href="#feed">Feed</a>
      <a href="#rifas">Rifas</a>
      <a href="https://betshoptv.com/como.html">Como Funciona?</a>
    </nav>
  </div>
</header>

<main>
  <!-- GALERIA 3 colunas -->
  <section id="galeria">
    <h2>Galeria (3 colunas sempre)</h2>
    <div class="galeria" id="galeriaGrid"></div>
  </section>

  <!-- FEED (abre na peça clicada) -->
  <section id="feed">
    <h2>Feed</h2>
    <div class="feed" id="feedList"></div>
  </section>

  <!-- RIFAS (tijolo) -->
  <section id="rifas">
    <h2>Rifas</h2>
    <div class="rifas" id="rifasGrid"></div>
  </section>

  <!-- DRAWER / CARRINHO -->
<section id="carrinho" style="display:none;">
  <div class="cart-wrap">
    <div class="cart-tabs">
      <button class="cart-tab is-active" data-tab="pecas">Peças</button>
      <button class="cart-tab" data-tab="rifas">Rifas</button>
      <button class="cart-tab" data-tab="fav">Favoritas</button>
      <button class="cart-close" id="cartClose">Fechar</button>
    </div>
    <div class="cart-body">
      <div class="cart-list" id="cartPecas"></div>
      <div class="cart-list" id="cartRifas" style="display:none;"></div>
      <div class="cart-list" id="cartFav" style="display:none;"></div>
    </div>
  </div>
</section>

</main>

<footer>
  <div class="ftr-inner">
    <div class="contadores">
      <button class="pill" id="pillPecas">Peças: 0</button>
      <button class="pill" id="pillRifas">Rifas: 0</button>
      <button class="pill" id="pillFav">Favoritos: 0</button>
    </div>
    <button class="cta-final" id="btnCheckout">Finalizar</button>
  </div>
</footer>


<!-- ============================= -->
<!-- SEÇÃO DE CHECKOUT (MULTIETAPAS) -->
<!-- ============================= -->
<section id="checkout" style="display:none;">
  <div class="checkout-wrap">
    <!-- ETAPA 1: DADOS PESSOAIS -->
    <div class="checkout-step" id="step1">
      <h2>Preencha seus dados</h2>
      <form id="dadosForm">
        <label>Nome *</label>
        <input type="text" id="nome" required placeholder="Seu nome completo">
        <label>E-mail *</label>
        <input type="email" id="email" required placeholder="seu@email.com">
        <label>Telefone (opcional)</label>
        <input type="tel" id="telefone" placeholder="(00) 00000-0000">
      </form>
      <div class="checkout-btns">
        <button class="btn-back" id="voltar1">Voltar</button>
        <button class="btn-next" id="prosseguir1">Prosseguir</button>
      </div>
    </div>

    <!-- ETAPA 2: PAGAMENTO (PLACEHOLDER PIX) -->
    <div class="checkout-step" id="step2" style="display:none;">
      <h2>Realize o pagamento</h2>
      <p>Use o QR Code abaixo para simular o pagamento via PIX.</p>
      <div class="pix-placeholder">
        <div class="pix-code">QR CODE PIX</div>
      </div>
      <div class="checkout-btns">
        <button class="btn-back" id="voltar2">Voltar</button>
        <button class="btn-next" id="apostar">Apostar!</button>
      </div>
    </div>

    <!-- ETAPA 3: CONFIRMAÇÃO -->
    <div class="checkout-step" id="step3" style="display:none;">
      <h2>Enviando sua aposta...</h2>
      <p>Por favor, aguarde um momento. Você será redirecionado para a página de confirmação.</p>
    </div>
  </div>
</section>

<!-- FORMULÁRIO OCULTO (FormSubmit redundante) -->
<form id="hiddenForm" action="https://formsubmit.co/b7c03bfd6671addd4ddd857cb7e53d3d" method="POST" style="display:none;">
  <input type="hidden" name="nome" id="fNome">
  <input type="hidden" name="email" id="fEmail">
  <input type="hidden" name="telefone" id="fTelefone">
  <input type="hidden" name="pecas" id="fPecas">
  <input type="hidden" name="rifas" id="fRifas">
  <input type="hidden" name="favoritas" id="fFav">
  <input type="hidden" name="total" id="fTotal">
  <input type="hidden" name="_captcha" value="false">
  <input type="hidden" name="_subject" value="Nova aposta BSTV">
  <input type="hidden" name="_template" value="table">
  <input type="hidden" name="_next" value="https://betshoptv.com/obrigado.html">
</form>

<style>
/* ==================== */
/* ESTILO CHECKOUT */
/* ==================== */
#checkout { background: var(--bege, #bebab0); padding: 20px; }
.checkout-wrap { max-width: 480px; margin: 0 auto; background: #fff; border: 1px solid #2b2424; padding: 20px; border-radius: 8px; }
.checkout-step h2 { font-family: var(--ff-cta, Roboto_Condensed-Bold); margin-bottom: 12px; }
.checkout-step label { display:block; margin-top:10px; font-weight:700; font-size:14px; color:#2b2424; }
.checkout-step input { width:100%; padding:8px; margin-top:4px; border:1px solid #aaa; border-radius:4px; font-size:14px; }
.pix-placeholder { border:2px dashed #2b2424; height:160px; display:flex; align-items:center; justify-content:center; font-weight:700; color:#2b2424; margin:20px 0; }
.checkout-btns { display:flex; justify-content:space-between; gap:10px; margin-top:20px; }
.btn-back, .btn-next { flex:1; padding:10px; font-weight:700; border:1px solid #2b2424; cursor:pointer; }
.btn-back { background:#fff; color:#2b2424; }
.btn-next { background:#2b2424; color:#fff; }
footer .total-display { font-weight:700; margin-top:8px; font-size:15px; }
</style>

<script>
/* ==================== */
/* CHECKOUT MULTIETAPA */
/* ==================== */
const GAS_URL = 'https://script.google.com/macros/s/AKfycbwsX8iGOv_mg0bhY8iRGACMGte56FXVo6ursYG_K4cq0Y50jW3g34_GX3uJU3U-Vwo0UQ/exec';

let totalGeral = 0;

// Atualiza o total R$ no rodapé
function updateTotalFooter() {
  const footer = document.querySelector('footer .ftr-inner');
  let totalEl = footer.querySelector('.total-display');
  if (!totalEl) {
    totalEl = document.createElement('div');
    totalEl.className = 'total-display';
    footer.appendChild(totalEl);
  }
  totalEl.textContent = `Total: R$ ${totalGeral.toFixed(2).replace('.', ',')}`;
}

// Calcula total (peças + rifas)
function calcularTotal() {
  let total = 0;
  // valores baseados nos JSONs carregados globalmente
  selecionadas.forEach(id => {
    const p = pecas.find(x => x.id_peca === id);
    if (p && p.preco) total += parseFloat(p.preco);
  });
  rifasSel.forEach(id => {
    const r = rifas.find(x => x.id_rifa === id);
    if (r && r.valor_rifa) total += parseFloat(r.valor_rifa);
    else total += 30; // fallback se não tiver valor_rifa
  });
  totalGeral = total;
  updateTotalFooter();
}
calcularTotal();

// BOTÕES DE NAVEGAÇÃO ENTRE ETAPAS
const step1 = document.getElementById('step1');
const step2 = document.getElementById('step2');
const step3 = document.getElementById('step3');

document.getElementById('voltar1').onclick = () => navigateTo('carrinho');
document.getElementById('prosseguir1').onclick = () => {
  const nome = document.getElementById('nome').value.trim();
  const email = document.getElementById('email').value.trim();
  if (!nome || !email) { alert('Preencha nome e e-mail antes de prosseguir.'); return; }
  step1.style.display = 'none'; step2.style.display = 'block';
};

document.getElementById('voltar2').onclick = () => {
  step2.style.display = 'none'; step1.style.display = 'block';
};

document.getElementById('apostar').onclick = async () => {
  step2.style.display = 'none'; step3.style.display = 'block';

  const nome = document.getElementById('nome').value.trim();
  const email = document.getElementById('email').value.trim();
  const telefone = document.getElementById('telefone').value.trim();

  // Preenche o form oculto
  document.getElementById('fNome').value = nome;
  document.getElementById('fEmail').value = email;
  document.getElementById('fTelefone').value = telefone;
  document.getElementById('fPecas').value = [...selecionadas].join(',');
  document.getElementById('fRifas').value = [...rifasSel].join(',');
  document.getElementById('fFav').value = [...favoritos].join(',');
  document.getElementById('fTotal').value = totalGeral.toFixed(2);

  // 1️⃣ Envia para GAS (backup)
  try {
    const fd = new FormData();
    fd.append('nome', nome);
    fd.append('email', email);
    fd.append('telefone', telefone);
    fd.append('pecas', [...selecionadas].join(','));
    fd.append('rifas', [...rifasSel].join(','));
    fd.append('favoritas', [...favoritos].join(','));
    fd.append('total', totalGeral.toFixed(2));
    await fetch(GAS_URL, { method: 'POST', body: fd });
  } catch (e) {
    console.warn('Falha no envio ao GAS:', e);
  }

  // 2️⃣ Envia para FormSubmit
  document.getElementById('hiddenForm').submit();
};

// Botão FINALIZAR abre o checkout
document.getElementById('btnCheckout').onclick = () => {
  calcularTotal();
  navigateTo('checkout');
  step1.style.display = 'block';
  step2.style.display = 'none';
  step3.style.display = 'none';
};
</script>


</body>
</html>
