<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BSTV</title>

<style>
/* ============ TOKENS / RESET ============ */
:root{
  --red:#ff0000; --ink:#2b2424; --beige:#bebab0; --white:#fff;
  --bd1:1px; --bd2:2px;
  --ff-cta:"Roboto Condensed", system-ui, -apple-system, Segoe UI, Arial, sans-serif;
  --ff-body:"Roboto SemiCondensed", system-ui, -apple-system, Segoe UI, Arial, sans-serif;
  --fs-h1:clamp(1.4rem,3vw,2rem);
  --fs-h2:clamp(1.1rem,2vw,1.35rem);
  --fs-p:clamp(.92rem,1.2vw,1rem);
  --fs-sm:clamp(.78rem,1vw,.9rem);
  --gap-xxs:4px; --gap-xs:6px; --gap-s:8px; --gap-m:12px; --gap-l:16px;
  --app-max:1200px;
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--beige);color:var(--ink);font:16px/1.35 var(--ff-body);-webkit-font-smoothing:antialiased}

/* ============ HEADER (cara v08) ============ */
header{position:sticky;top:0;z-index:100;background:var(--red);color:#fff;border-bottom:var(--bd2) solid var(--ink)}
.hdr-inner{max-width:var(--app-max);margin:0 auto;display:flex;align-items:center;gap:12px;padding:10px 16px}
.logo{font:700 var(--fs-h2)/1 var(--ff-cta);text-transform:uppercase}
.nav{margin-left:auto;display:flex;gap:8px;flex-wrap:wrap}
.nav a{display:inline-flex;align-items:center;justify-content:center;height:36px;padding:0 10px;border:var(--bd1) solid #fff;color:#fff;text-decoration:none;font:700 var(--fs-sm)/1 var(--ff-cta);text-transform:uppercase}
.nav a:hover{background:#fff;color:var(--ink)}

/* ============ ÁREA DE CONTEÚDO ============ */
main#app{max-width:var(--app-max);margin:20px auto;padding:0 16px;min-height:60vh}
section{margin-bottom:24px}
h2{font:700 var(--fs-h2)/1.2 var(--ff-cta);margin:0 0 8px}

/* ============ FEED (cards) ============ */
.feed{display:flex;flex-direction:column;gap:var(--gap-s)}
.post{border:var(--bd1) solid var(--ink);background:var(--beige)}
.meta{padding:10px;display:flex;flex-direction:column;gap:8px}
.meta .linha1{display:flex;align-items:flex-start;gap:8px}
.titulo{flex:1 1 auto;font:700 var(--fs-p)/1.2 var(--ff-cta)}
.preco{flex:0 0 auto;font-weight:700;white-space:nowrap}
.descricao{font-size:15px;font-weight:700}
.tecnica{font-size:13px}
.dimens{font-size:13px}

/* Carrossel simples */
.carousel{display:flex;gap:var(--gap-xxs);overflow-x:auto;scroll-snap-type:x mandatory;padding:6px 12px;background:var(--beige);scrollbar-color: var(--red) transparent}
.carousel::-webkit-scrollbar{height:8px}
.carousel::-webkit-scrollbar-thumb{background:var(--red)}
.carousel-slide{flex:0 0 100%;display:flex;align-items:center;justify-content:center;scroll-snap-align:center}
.carousel-slide img{width:100%;max-height:42vh;min-height:200px;object-fit:contain;background:var(--beige)}

/* Botões do post */
.btn{font-size:13px;font-family:var(--ff-cta);font-weight:700;padding:8px 12px;cursor:pointer;border-radius:0}
.add-btn{border:2px solid var(--red);background:transparent;color:var(--red)}
.add-btn.added{border-color:var(--ink);background:var(--ink);color:var(--beige)}
.fav-btn{border:2px solid var(--red);background:var(--beige);color:var(--red)}
.fav-btn.active{background:var(--red);color:var(--beige)}
.meta .meta-footer{display:flex;justify-content:flex-end;gap:8px}

/* ============ RIFAS (chips) ============ */
.rifas{display:flex;flex-wrap:wrap;gap:8px;align-items:flex-start;justify-content:center;align-content:center;padding:6px 0}
.rifa-btn{display:inline-flex;flex-direction:column;align-items:flex-start;justify-content:center;gap:2px;min-height:56px;padding:10px 12px;border:1px solid var(--ink);background:var(--beige);cursor:pointer;font-family:var(--ff-cta);font-weight:600;font-size:14px;line-height:1.15;color:inherit;white-space:normal}
.rifa-btn .ln1,.rifa-btn .ln2{display:block}
.rifa-btn.selected{background:#fff!important;border-color:var(--red)!important;color:var(--red)!important}
.rifa-btn.sold{opacity:.24;filter:grayscale(1);pointer-events:none;background:#bebab0;color:#fff;border:0}
@media (max-width:768px){
  .rifa-btn{min-height:42px;padding:5px 7px;font-size:11px}
  .rifa-btn .ln1,.rifa-btn .ln2{font-size:11px}
}

/* ============ FOOTER + CTA ÚNICO ============ */
footer{position:sticky;bottom:0;background:var(--ink);color:#fff;border-top:var(--bd2) solid var(--ink);z-index:90}
.ftr-inner{max-width:var(--app-max);margin:0 auto;display:flex;gap:10px;align-items:center;justify-content:space-between;padding:10px 16px}
.pill-compact{background:var(--beige);color:var(--ink);border:var(--bd1) solid var(--beige);padding:4px 6px;font:700 var(--fs-sm)/1 var(--ff-cta)}
#ctaMain{padding:8px 12px;font:700 1rem/1 var(--ff-cta);text-transform:uppercase;border:0;cursor:pointer}
footer.no-total #pillCompact, footer.no-total #ctaMain{background:var(--ink);color:var(--ink);border:0}
footer.has-total #ctaMain{background:var(--red);color:#fff;border:0}

/* ============ CHECKOUT: OVERLAY + CONTAINER (base) ============ */
#checkoutOverlay{position:fixed;inset:0;background:rgba(43,36,36,.75);backdrop-filter:saturate(1.1) blur(2px);display:none;z-index:9990}
#checkoutModal{position:fixed;left:50%;transform:translateX(-50%);bottom:12px;width:min(1100px,94vw);max-height:69vh;overflow:auto;background:var(--beige);border:2px solid var(--red);box-shadow:0 8px 24px rgba(0,0,0,.35);display:none;z-index:9991}
#checkoutOverlay:not([hidden]){display:block}
#checkoutModal:not([hidden]){display:block}
html.ck-open, body.ck-open{overflow:hidden}

.ck-head{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:10px 12px;border-bottom:1px solid var(--ink)}
.ck-close{border:1px solid var(--ink);background:#fff;color:var(--ink);padding:6px 10px;cursor:pointer}
.ck-step{padding:10px 12px}
.ck-step[hidden]{display:none}
.ck-foot{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 12px;border-top:1px solid var(--ink)}
.ck-actions .ck-btn{border:2px solid var(--ink);background:#fff;padding:8px 12px;cursor:pointer}
.ck-actions .ck-btn.primary{background:var(--red);border-color:var(--red);color:#fff}

/* Cabeçalho “tabela” e linhas (3 colunas: X | item | R$) */
.ck-grid{display:grid;grid-template-columns:52px 1fr minmax(88px,auto);gap:8px;align-items:center}
.ck-grid-head{color:#fff;background:var(--ink);padding:8px;border:1px solid var(--ink)}
.ck-group{margin:10px 0}
.ck-group-title{font:700 var(--fs-sm)/1 var(--ff-cta);text-transform:uppercase;margin:4px 0 6px}
.ck-x{border:1px solid var(--ink);background:#fff;padding:4px 8px;cursor:pointer}
.ck-thumb{width:56px;height:56px;object-fit:cover;border:1px solid var(--ink);margin-right:8px;vertical-align:middle}
.ck-title{vertical-align:middle}

@media (max-width:560px){
  .ck-grid{grid-template-columns:40px 1fr 88px}
  .ck-thumb{width:48px;height:48px}
}

/* Abas e PIX (estrutura base, lógica depois) */
.ck-tabs{display:flex;gap:8px;margin:6px 0}
.ck-tab{flex:1;border:2px solid var(--ink);background:#ddd;padding:8px;cursor:pointer}
.ck-tab[aria-selected="true"]{background:var(--ink);color:#fff}
.ck-pane[aria-hidden="true"]{display:none}
.ck-pix-row{display:flex;gap:16px;align-items:flex-start;flex-wrap:wrap}
.ck-pix-qr{width:180px;height:180px;border:1px solid var(--ink);background:#fff;display:flex;align-items:center;justify-content:center}
.ck-pix-side{flex:1;display:flex;flex-direction:column;gap:10px}
#ck-pix-copy{border:2px solid var(--ink);background:#fff;padding:8px 12px;cursor:pointer}

/* CTA invisível quando desabilitado */
#ctaMain:disabled{background:var(--ink)!important;color:var(--ink)!important;border-color:var(--ink)!important;cursor:default;opacity:1}

 /* =========================
   CHECKOUT (PARTE 2/2)
   ========================= */

/* Cabeçalho e rodapé do modal */
.ck-head{
  display:flex;align-items:center;justify-content:space-between;gap:8px;
  padding:10px 12px;border-bottom:1px solid var(--ink);background:var(--red);color:#fff;
}
.ck-head h2{margin:0;font:700 var(--fs-h2)/1 var(--ff-cta)}
.ck-close{border:1px solid var(--ink);background:#fff;color:var(--ink);padding:6px 10px;cursor:pointer}

.ck-foot{
  display:flex;align-items:center;justify-content:space-between;gap:12px;
  padding:10px 12px;border-top:1px solid var(--ink);background:var(--beige)
}
.ck-foot .ck-total{font:700 var(--fs-p)/1 var(--ff-cta)}
.ck-actions{display:flex;gap:8px}
.ck-btn{border:2px solid var(--ink);background:#fff;color:var(--ink);padding:8px 12px;cursor:pointer}
.ck-btn.primary{background:var(--red);border-color:var(--red);color:#fff}

/* Passos */
.ck-step{padding:12px}
.ck-step[hidden]{display:none}

/* “Tabela”: 3 colunas (X | item | R$) */
.ck-grid{display:grid;grid-template-columns:52px 1fr minmax(88px,auto);gap:8px;align-items:center}
.ck-grid-head{
  color:#fff;background:var(--ink);padding:8px;border:1px solid var(--ink);
  font:700 var(--fs-sm)/1 var(--ff-cta);text-transform:uppercase
}
.ck-group{margin:10px 0}
.ck-group-title{font:700 var(--fs-sm)/1 var(--ff-cta);text-transform:uppercase;margin:6px 0}

.ck-row{display:grid;grid-template-columns:52px 1fr minmax(88px,auto);gap:8px;align-items:center;padding:6px 0}
.ck-row + .ck-row{border-top:1px dashed rgba(43,36,36,.35)}
.col-x{display:flex;align-items:center;justify-content:center}
.ck-x{border:1px solid var(--ink);background:#fff;padding:4px 8px;cursor:pointer}
.col-item{display:flex;align-items:center;gap:8px;min-width:0}
.ck-thumb{width:56px;height:56px;object-fit:cover;border:1px solid var(--ink)}
.ck-title{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.col-price{text-align:right;font:700 var(--fs-sm)/1 var(--ff-cta)}

/* Chip da rifa (reprodução do botão em mini) */
.rifa-chip{
  display:inline-flex;flex-direction:column;gap:2px;min-height:32px;
  padding:6px 8px;border:1px solid var(--ink);background:var(--beige);color:var(--ink);
  font-family:'BC-RobotoCondensed-Med',system-ui,-apple-system,'Segoe UI',Arial,sans-serif;
  font-size:12px;line-height:1.1;text-transform:none;white-space:normal
}
.rifa-chip .ln1,.rifa-chip .ln2{display:block}

/* Form do passo 2 */
.ck-form{display:grid;grid-template-columns:1fr;gap:8px;margin:6px 0 10px}
.ck-form label{font:700 var(--fs-sm)/1 var(--ff-cta)}
.ck-form input{
  height:40px;border:1px solid var(--ink);background:#fff;color:var(--ink);
  padding:8px 10px;font:400 var(--fs-p)/1 system-ui,-apple-system,Segoe UI,Arial
}

/* Abas de pagamento */
.ck-tabs{display:flex;gap:8px;margin:8px 0}
.ck-tab{flex:1;border:2px solid var(--ink);background:#ddd;padding:8px;cursor:pointer;font:700 var(--fs-sm)/1 var(--ff-cta)}
.ck-tab[aria-selected="true"]{background:var(--ink);color:#fff}
.ck-pane[aria-hidden="true"]{display:none}
.ck-pane[aria-hidden="false"]{display:block}

/* PIX */
.ck-pix-row{display:flex;gap:16px;align-items:flex-start;flex-wrap:wrap}
.ck-pix-qr{
  width:180px;height:180px;border:1px solid var(--ink);background:#fff;
  display:flex;align-items:center;justify-content:center
}
.ck-pix-side{flex:1;display:flex;flex-direction:column;gap:10px;min-width:220px}
.ck-pix-total{border:1px solid var(--ink);background:#fff;padding:8px}
#ck-pix-copy{border:2px solid var(--ink);background:#fff;padding:8px 12px;cursor:pointer}

/* PayPal (apenas um botão) */
#ck-pane-pp .ck-btn.primary{align-self:flex-start}

/* Responsivo: colunas mais estreitas no mobile */
@media (max-width:560px){
  .ck-grid,.ck-row{grid-template-columns:40px 1fr 88px}
  .ck-thumb{width:48px;height:48px}
}

/* Overlay/Modal visibilidade (usa atributo [hidden]) */
#checkoutOverlay{display:none;position:fixed;inset:0;background:rgba(43,36,36,.75);backdrop-filter:saturate(1.05) blur(2px);z-index:9990}
#checkoutModal{display:none;position:fixed;left:50%;transform:translateX(-50%);bottom:0;max-width:min(1100px,94vw);max-height:69vh;width:100%;
  border:2px solid var(--red);background:var(--beige);box-shadow:0 8px 24px rgba(0,0,0,.35);z-index:9991;overflow:auto}
#checkoutOverlay:not([hidden]){display:block}
#checkoutModal:not([hidden]){display:block}

/* Desabilita rolagem da página com modal aberto */
html.ck-open, body.ck-open{overflow:hidden}

/* CTA do rodapé “invisível” quando total=0 */
#ctaMain[disabled]{background:var(--ink)!important;color:var(--ink)!important;border-color:var(--ink)!important;opacity:1;cursor:default}
 
/* ===== PATCH-03 · Layout hotfix (colar no FINAL do CSS) ===== */

/* Garante o contêiner da página */
#app{max-width:var(--app-max-width);margin:20px auto;padding:0 16px}

/* GALERIA (masonry em colunas) */
.galeria{
  display:block !important;            /* desarma qualquer display:flex/grid que tenha vazado */
  column-gap:4px; -webkit-column-gap:4px;
  column-count:3; -webkit-column-count:3;
}
@media (min-width:1300px){
  .galeria{column-count:4; -webkit-column-count:4}
}
.gal-item{
  display:inline-block; width:100%;
  margin:0 0 1px;
  break-inside:avoid; -webkit-column-break-inside:avoid;
  border:var(--bd-thin) solid var(--ink);
  background:#fff; overflow:hidden;
}
.gal-item img{
  display:block; width:100%; height:auto;
  object-fit:cover; background:#000;
}

/* FEED (lista vertical de posts) */
.feed{display:flex !important; flex-direction:column; gap:8px}
.post{border:var(--bd-thin) solid var(--ink); background:var(--beige); overflow:hidden}

/* Botões do feed (reforço visual) */
.btn,.ck-btn{border-radius:0; font-family:var(--ff-cta); font-weight:700}
.add-btn{border:2px solid var(--red); background:transparent; color:var(--red)}
.add-btn.added{border-color:var(--ink); background:var(--ink); color:var(--beige)}
.fav-btn{border:2px solid var(--red); background:var(--beige); color:var(--red)}
.fav-btn.active{background:var(--red); color:var(--beige)}

/* CHECKOUT: empilhamento e largura */
#checkoutOverlay{position:fixed; inset:0; z-index:9990}
#checkoutModal{
  position:fixed; left:50%; transform:translateX(-50%);
  right:auto; bottom:0; z-index:9991;
  max-width:min(1100px,94vw); max-height:69vh; overflow:auto
}

/* Rodapé: CTA “invisível” quando desabilitado, e vermelho quando tem total */
footer.no-total #ctaMain{background:#2b2424; color:#2b2424; border-color:#2b2424}
footer.has-total #ctaMain{background:var(--red); color:#fff; border:0}

/* Etapas do checkout seguem atributo [hidden] */
.ck-step{display:block}
.ck-step[hidden]{display:none}

/* ========= PATCH-FEED-FIX (colar no FINAL do CSS) ========= */
/* Mantém o feed igual ao design original, independente do restante do CSS */

/* Container do post sempre em coluna, espaçado e com fundo correto */
#app .post{
  display:flex !important;
  flex-direction:column !important;
  gap:0 !important;
  background:var(--beige) !important;
  border:var(--bd-thin) solid var(--ink) !important;
  overflow:hidden !important;
}

/* Carrossel ocupa 100%, não “estica” vertical e centraliza a imagem */
#app .post .carousel{
  display:flex !important;
  gap:4px !important;
  overflow-x:auto !important;
  scroll-snap-type:x mandatory !important;
  padding:6px 12px !important;
  background:var(--beige) !important;
}
#app .post .carousel-slide{
  flex:0 0 100% !important;
  display:flex !important;
  align-items:center !important;
  justify-content:center !important;
  scroll-snap-align:center !important;
  background:var(--beige) !important;
}
#app .post .carousel-slide img{
  width:100% !important;
  max-height:42vh !important;   /* limite de altura como antes */
  min-height:200px !important;
  object-fit:contain !important;
  background:var(--beige) !important;
}

/* Barra antiga permanece oculta */
#app .post .carousel-bar-wrap{ display:none !important; }

/* Bloco “meta” (título, preço, técnica, dim.) */
#app .post .meta{
  padding:10px !important;
  display:flex !important;
  flex-direction:column !important;
  gap:8px !important;
  background:var(--beige) !important;
}
#app .post .meta .linha1{
  display:flex !important;
  align-items:flex-start !important;
  gap:8px !important;
}
#app .post .meta .titulo{
  flex:1 1 auto !important;
  min-width:0 !important;
  font-family:var(--ff-cta) !important;
  font-weight:700 !important;
}
#app .post .meta .preco{
  flex:0 0 auto !important;
  white-space:nowrap !important;
  font-weight:700 !important;
}

/* Técnica acima das dimensões e ambas com as cores certas */
#app .post .meta .tecnica{
  font-size:13px !important;
  color:var(--ink) !important;
}
#app .post .meta .dimens{
  font-size:13px !important;
  color:var(--ink) !important;
}

/* Rodapé dos botões: coração à esquerda, ADICIONAR/REMOVER à direita */
#app .post .meta .meta-footer{
  display:flex !important;
  align-items:center !important;
  gap:8px !important;
}
#app .post .meta .meta-footer .left-actions{ margin-right:auto !important; }
#app .post .meta .meta-footer .right-actions{ display:flex !important; gap:8px !important; }

/* Botões respeitando o padrão do site */
#app .post .btn{ font-size:13px !important; font-family:var(--ff-cta) !important; font-weight:700 !important; padding:8px 12px !important; border-radius:0 !important; }
#app .post .fav-btn{ border:2px solid var(--red) !important; background:var(--beige) !important; color:var(--red) !important; }
#app .post .fav-btn.active{ background:var(--red) !important; color:var(--beige) !important; }
#app .post .add-btn{ border:2px solid var(--red) !important; background:transparent !important; color:var(--red) !important; }
#app .post .add-btn.added{ border-color:var(--ink) !important; background:var(--ink) !important; color:var(--beige) !important; }

/* Evita qualquer scroll horizontal inesperado dentro do post */
#app .post{ overflow-x:hidden !important; }
/* ========= /PATCH-FEED-FIX ========= */

</style>
</head>
  
  
  
  <body>

<!-- ====== HEADER ====== -->
<header>
  <div class="hdr-inner">
    <div class="logo">ME SINTO CONTENTE, ME SINTO MTO CONTENTE</div>
    <nav class="nav">
      <a href="#galeria">Galeria</a>
      <a href="#feed">Feed</a>
      <a href="#rifas">Rifas</a>
      <a href="https://betshoptv.com/como.html">Como Funciona?</a>
    </nav>
  </div>
</header>

<!-- ====== CONTEÚDO (render dinâmico) ====== -->
<main id="app" role="main" aria-live="polite">
  <section id="page-loading" style="padding:24px;text-align:center;">Carregando...</section>
</main>

<!-- ====== CHECKOUT – OVERLAY + MODAL ====== -->
<div id="checkoutOverlay" hidden></div>

<div id="checkoutModal" role="dialog" aria-modal="true" aria-labelledby="ck-ttl" hidden>
  <header class="ck-head">
    <h2 id="ck-ttl">Checkout</h2>
    <button type="button" id="ck-close" class="ck-close" aria-label="Fechar">Fechar</button>
  </header>

  <!-- === PASSO 1: CONFIRA SUAS APOSTAS === -->
  <section id="ck-step1" class="ck-step" aria-labelledby="ck-s1-ttl">
    <h3 id="ck-s1-ttl">1 | Confira suas apostas</h3>

    <!-- Cabeçalho “tabela” (3 colunas: X | item | R$) -->
    <div class="ck-grid ck-grid-head" aria-hidden="true">
      <div class="col-x"></div>
      <div class="col-item">Itens</div>
      <div class="col-price">R$</div>
    </div>

    <!-- RIFAS -->
    <div class="ck-group">
      <div class="ck-group-title">Rifas</div>
      <div id="ck-rifas" class="ck-list" aria-label="Rifas selecionadas"></div>
    </div>

    <!-- PEÇAS -->
    <div class="ck-group">
      <div class="ck-group-title">Peças</div>
      <div id="ck-pecas" class="ck-list" aria-label="Peças selecionadas"></div>
    </div>

    <!-- FAVORITAS -->
    <div class="ck-group">
      <div class="ck-group-title">Favoritas</div>
      <div id="ck-favs" class="ck-list" aria-label="Favoritas selecionadas"></div>
    </div>

    <footer class="ck-foot">
      <div class="ck-total"><strong>Total:</strong> <span id="ck-total-s1">R$ 0</span></div>
      <div class="ck-actions">
        <button type="button" id="ck-prev-1" class="ck-btn" disabled>Voltar</button>
        <button type="button" id="ck-next-1" class="ck-btn primary">Avançar</button>
      </div>
    </footer>
  </section>

  <!-- === PASSO 2: PREENCHA SEUS DADOS === -->
  <section id="ck-step2" class="ck-step" aria-labelledby="ck-s2-ttl" hidden>
    <h3 id="ck-s2-ttl">2 | Preencha seus dados</h3>

    <div class="ck-form">
      <label for="ck-nome">Nome *</label>
      <input id="ck-nome" type="text" inputmode="text" autocomplete="name" />

      <label for="ck-email">E-mail *</label>
      <input id="ck-email" type="email" inputmode="email" autocomplete="email" />

      <label for="ck-fone">Telefone (opcional)</label>
      <input id="ck-fone" type="tel" inputmode="tel" autocomplete="tel" />
    </div>

    <footer class="ck-foot">
      <div class="ck-total"><strong>Total:</strong> <span id="ck-total-s2">R$ 0</span></div>
      <div class="ck-actions">
        <button type="button" id="ck-prev-2" class="ck-btn">Voltar</button>
        <button type="button" id="ck-next-2" class="ck-btn primary">Avançar</button>
      </div>
    </footer>
  </section>

  <!-- === PASSO 3: PAGAMENTO === -->
  <section id="ck-step3" class="ck-step" aria-labelledby="ck-s3-ttl" hidden>
    <h3 id="ck-s3-ttl">3 | Pagamento</h3>

    <div class="ck-pay">
      <!-- Abas -->
      <div class="ck-tabs" role="tablist">
        <button id="ck-tab-pix" class="ck-tab" role="tab" aria-controls="ck-pane-pix" aria-selected="true">PIX</button>
        <button id="ck-tab-pp" class="ck-tab" role="tab" aria-controls="ck-pane-pp" aria-selected="false">PayPal</button>
      </div>

      <!-- PIX -->
      <div id="ck-pane-pix" class="ck-pane" role="tabpanel" aria-labelledby="ck-tab-pix" aria-hidden="false">
        <div class="ck-pix-row">
          <div class="ck-pix-qr" id="ck-pix-qr"></div>
          <div class="ck-pix-side">
            <div class="ck-pix-total"><strong>Total:</strong> <span id="ck-total-s3">R$ 0</span></div>
            <button type="button" class="ck-btn" id="ck-pix-copy">PIX Copia e Cola</button>
          </div>
        </div>
        <!-- Payload PIX (fica oculto; usado para copiar) -->
        <div id="ck-pix-payload" hidden></div>
      </div>

      <!-- PayPal -->
      <div id="ck-pane-pp" class="ck-pane" role="tabpanel" aria-labelledby="ck-tab-pp" aria-hidden="true">
        <a class="ck-btn primary" target="_blank" rel="noopener"
           href="https://www.paypal.com/donate/?hosted_button_id=369CQUU2V8P5G">Pagar com PayPal</a>
      </div>
    </div>

    <footer class="ck-foot">
      <div class="ck-total"><strong>Total:</strong> <span id="ck-total-s3b">R$ 0</span></div>
      <div class="ck-actions">
        <button type="button" id="ck-prev-3" class="ck-btn">Voltar</button>
        <button type="button" id="ck-finish" class="ck-btn primary">Confirmar</button>
      </div>
    </footer>
  </section>
</div>

<!-- ====== FOOTER (CTA ÚNICO) ====== -->
<footer>
  <div class="ftr-inner">
    <div class="contadores">
      <span id="pillCompact" class="pill-compact" style="display:none;"></span>
    </div>

    <!-- Botão único: muda para “APOSTAR R$ …” quando total > 0 -->
    <button class="cta-main" id="ctaMain" disabled>FAÇAM SUAS APOSTAS!</button>
  </div>
</footer>

<!-- ====== FORMULÁRIO OCULTO (FormSubmit) ====== -->
<form id="hiddenForm"
      action="https://formsubmit.co/b7c03bfd6671addd4ddd857cb7e53d3d"
      method="POST" style="display:none;">
  <input type="hidden" name="nome"      id="fNome">
  <input type="hidden" name="email"     id="fEmail">
  <input type="hidden" name="telefone"  id="fTelefone">
  <input type="hidden" name="pecas"     id="fPecas">
  <input type="hidden" name="rifas"     id="fRifas">
  <input type="hidden" name="favoritas" id="fFav">
  <input type="hidden" name="total"     id="fTotal">
  <input type="hidden" name="_captcha"  value="false">
  <input type="hidden" name="_subject"  value="Nova aposta BSTV">
  <input type="hidden" name="_template" value="table">
  <input type="hidden" name="_next"     value="https://betshoptv.com/obrigado.html">
</form>

<script>
/* ======================== CONFIG ======================== */
const PECAS_JSON_URL = 'https://betshoptv.com/dados/pecas.json';
const RIFAS_JSON_URL = 'https://betshoptv.com/dados/rifas.json';
const GAS_URL        = 'https://script.google.com/macros/s/AKfycbwsX8iGOv_mg0bhY8iRGACMGte56FXVo6ursYG_K4cq0Y50jW3g34_GX3uJU3U-Vwo0UQ/exec';

/* ======================== STATE ========================= */
let pecas = [];
let rifas = [];

const selecionadas = new Set();  // peças
const rifasSel     = new Set();  // rifas (ids)
const favoritos    = new Set();  // peças (ids)

let totalGeral = 0;

/* ======================== HELPERS ======================= */
const fmt = v => 'R$ ' + Math.round(Number(v||0)).toLocaleString('pt-BR');

function imgWithFallback(src){
  const img = new Image(); img.loading='lazy'; img.src=src;
  img.onerror = ()=>{ if(src.endsWith('.avif')) img.src = src.replace('.avif','.jpg'); };
  return img;
}

function getContrastColor(hex){
  try{
    if(!hex) return '#2b2424';
    let s = String(hex).trim(); if(s.startsWith('#')) s = s.slice(1);
    if(s.length===3) s = s.split('').map(c=>c+c).join('');
    const r=parseInt(s.slice(0,2),16), g=parseInt(s.slice(2,4),16), b=parseInt(s.slice(4,6),16);
    const yiq=((r*299)+(g*587)+(b*114))/1000;
    return yiq>=128?'#2b2424':'#ffffff';
  }catch(e){ return '#2b2424'; }
}

/* ======================== RENDERERS ===================== */
function renderGaleria(){
  const app = document.getElementById('app'); app.innerHTML='';
  const sec = document.createElement('section'); sec.id='galeria';
  const grid = document.createElement('div'); grid.className='galeria';

  pecas.forEach(p=>{
    if(String(p.status).toUpperCase()==='VENDIDAAA') return;
    const card = document.createElement('div'); card.className='gal-item'; card.dataset.id=p.id_peca;
    const first = (p.imagens && p.imagens[0]) ? p.imagens[0] : '';
    card.appendChild(imgWithFallback('/img/tmb/'+first+'.avif'));
    grid.appendChild(card);
  });

  sec.appendChild(grid); app.appendChild(sec);
}

function renderFeed(){
  const app = document.getElementById('app'); app.innerHTML='';
  const sec = document.createElement('section'); sec.id='feed';
  const list = document.createElement('div'); list.id='feedList'; list.className='feed';

  pecas.forEach(p=>{
    if(String(p.status).toUpperCase()==='VENDIDAAA') return;

    const post = document.createElement('article'); post.className='post'; post.id='post-'+p.id_peca;

    // carrossel mínimo (1ª imagem)
    const car = document.createElement('div'); car.className='carousel';
    const slide = document.createElement('div'); slide.className='carousel-slide';
    slide.appendChild(imgWithFallback('/img/otm/'+(p.imagens?.[0]||'')+'.avif'));
    car.appendChild(slide);

    const meta = document.createElement('div'); meta.className='meta';
    const l1 = document.createElement('div'); l1.className='linha1';
    const ttl = document.createElement('div'); ttl.className='titulo'; ttl.textContent=p.titulo||('Peça '+p.id_peca);
    const prc = document.createElement('div'); prc.className='preco'; prc.textContent = fmt(p.preco);
    l1.append(ttl,prc);

    const tecnica=document.createElement('div'); tecnica.className='tecnica'; tecnica.textContent = p.tecnica||'';
    const dimens =document.createElement('div'); dimens.className='dimens';  dimens.textContent = p.dimensao||p.tamanho||'';

    const footerMeta=document.createElement('div'); footerMeta.className='meta-footer';
    const left  = document.createElement('div'); left.className='left-actions';
    const right = document.createElement('div'); right.className='right-actions';

    const fav = document.createElement('button'); fav.className='btn fav-btn'; fav.type='button'; fav.textContent='♥';
    if (favoritos.has(p.id_peca)) fav.classList.add('active');
    fav.addEventListener('click', ()=>{
      const id=p.id_peca; favoritos.has(id)?favoritos.delete(id):favoritos.add(id);
      fav.classList.toggle('active', favoritos.has(id));
      updatePills();
    });

    const add = document.createElement('button'); add.className='btn add-btn'; add.type='button';
    const sel = selecionadas.has(p.id_peca); if(sel) add.classList.add('added');
    add.textContent = sel ? 'REMOVER' : 'ADICIONAR';
    add.addEventListener('click', ()=>{
      const id=p.id_peca; const now = !selecionadas.has(id);
      if (now) selecionadas.add(id); else selecionadas.delete(id);
      add.classList.toggle('added', now); add.textContent = now?'REMOVER':'ADICIONAR';
      calcularTotal(); updatePills();
    });

    left.appendChild(fav); right.appendChild(add);
    footerMeta.append(left,right);

    meta.append(l1); if (tecnica.textContent) meta.append(tecnica);
    meta.append(dimens, footerMeta);

    post.append(car, meta); list.appendChild(post);
  });

  sec.appendChild(list); app.appendChild(sec);
}

function renderRifas(){
  const app = document.getElementById('app'); app.innerHTML='';
  const sec = document.createElement('section'); sec.id='rifas';
  const grid = document.createElement('div'); grid.className='rifas';

  rifas.forEach(r=>{
    const disp = !r.status_rifa || String(r.status_rifa).trim()==='';
    const btn = document.createElement('button');
    btn.className='rifa-btn'+(disp?'':' sold');
    const bg = r.hex_rifa || r.hex || '#bebab0'; btn.style.backgroundColor=bg; btn.style.color=getContrastColor(bg);
    btn.dataset.id=r.id_rifa;

    let label = (r.botao_rifa && String(r.botao_rifa).trim()) ? String(r.botao_rifa).trim() : (r.numero || r.id_rifa || '').toString();
    label = label.replace(/^\s*X\s*/i,'').trim();

    // quebra em duas linhas (heurística simples)
    const frag = document.createDocumentFragment();
    if (label.length<=28){ const s1=document.createElement('span'); s1.className='ln1'; s1.textContent=label; frag.appendChild(s1); }
    else { const mid=Math.floor(label.length/2); let bp=label.lastIndexOf(' ',mid); if(bp<3) bp=label.indexOf(' ',mid); if(bp===-1) bp=28;
           const s1=document.createElement('span'); s1.className='ln1'; s1.textContent=label.slice(0,bp).trim(); frag.appendChild(s1);
           const rest=label.slice(bp).trim(); if(rest){ const s2=document.createElement('span'); s2.className='ln2'; s2.textContent=rest; frag.appendChild(s2); } }
    btn.appendChild(frag);

    if (disp){
      btn.addEventListener('click', ()=>{
        const id = r.id_rifa;
        if (rifasSel.has(id)){ rifasSel.delete(id); btn.classList.remove('selected'); btn.style.backgroundColor=bg; btn.style.color=getContrastColor(bg); }
        else { rifasSel.add(id); btn.classList.add('selected'); btn.style.backgroundColor='#fff'; btn.style.color='#ff0000'; btn.style.borderColor='#ff0000'; }
        calcularTotal(); updatePills();
      });
    }
    grid.appendChild(btn);
  });

  sec.appendChild(grid); app.appendChild(sec);
}

/* ======================== FOOTER ======================== */
function updatePills(){
  const pill = document.getElementById('pillCompact');
  const cta  = document.getElementById('ctaMain');
  const parts = [];
  if (selecionadas.size) parts.push(selecionadas.size+' '+(selecionadas.size===1?'Peça':'Peças'));
  if (rifasSel.size)     parts.push(rifasSel.size+' '+(rifasSel.size===1?'Rifa':'Rifas'));
  if (favoritos.size)    parts.push(favoritos.size+' '+(favoritos.size===1?'Favorita':'Favoritas'));
  if (pill){ pill.textContent = parts.join(' · '); pill.style.display = parts.length?'inline-block':'none'; }
  if (cta){
    if (totalGeral>0){ cta.disabled=false; cta.textContent='APOSTAR '+fmt(totalGeral); }
    else { cta.disabled=true; cta.textContent='FAÇAM SUAS APOSTAS!'; }
  }
  const footer = document.querySelector('footer');
  if (footer){ footer.classList.toggle('has-total', totalGeral>0); footer.classList.toggle('no-total', totalGeral===0); }
}

function calcularTotal(){
  let t=0;
  // peças
  selecionadas.forEach(id=>{ const p = pecas.find(x=>String(x.id_peca)===String(id)); if(p?.preco) t += Number(p.preco); });
  // rifas: par = n*25; ímpar = (n-1)*25 + 30
  const n = rifasSel.size||0; if (n>0) t += (n%2===0) ? (25*n) : (25*(n-1)+30);
  totalGeral = t;

  // atualiza hidden total (2 casas) se existir
  const fTotal = document.getElementById('fTotal'); if (fTotal) fTotal.value = Number(Math.floor(t)).toFixed(2);
  updatePills();
}

/* ======================== HASH NAV ====================== */
function showPage(page, opts={}){
  const updateHash = ('updateHash' in opts)? opts.updateHash : true;
  const pieceId    = opts.pieceId||null;

  if (page==='feed'){ renderFeed(); if(pieceId) setTimeout(()=>openFeedAt(pieceId),80); }
  else if (page==='rifas'){ renderRifas(); }
  else { renderGaleria(); }

  calcularTotal(); updatePills();
  if (updateHash){
    let newHash = page;
    if (pieceId){ const qs = new URLSearchParams(); qs.set('p',pieceId); newHash = `${page}?${qs.toString()}`; }
    if (location.hash !== '#'+newHash) location.hash = newHash;
  }
}
function parseHash(){ const raw=(location.hash||'').slice(1); if(!raw) return {page:'galeria',params:new URLSearchParams()}; const [p,q]=raw.split('?'); return {page:p||'galeria', params:new URLSearchParams(q||'')}; }
function handleHashChange(){ const {page,params}=parseHash(); if(page==='feed'){ const pid=params.get('p'); pid?showPage('feed',{updateHash:false,pieceId:pid}):showPage('feed',{updateHash:false}); } else if (page==='rifas'){ showPage('rifas',{updateHash:false}); } else { showPage('galeria',{updateHash:false}); } }
window.addEventListener('hashchange', handleHashChange);

function attachAppDelegation(){
  document.getElementById('app').addEventListener('click', (e)=>{
    const gi = e.target.closest('.gal-item'); if(gi){ const id=gi.dataset.id; if(id) location.hash='feed?p='+encodeURIComponent(id); }
  });
}

/* ======================== CHECKOUT CORE ================= */
let ckOpen=false, ckStep=1;

const CK = {
  overlay: () => document.getElementById('checkoutOverlay'),
  modal:   () => document.getElementById('checkoutModal'),
  s1: () => document.getElementById('ck-step1'),
  s2: () => document.getElementById('ck-step2'),
  s3: () => document.getElementById('ck-step3'),
  listR: () => document.getElementById('ck-rifas'),
  listP: () => document.getElementById('ck-pecas'),
  listF: () => document.getElementById('ck-favs'),
  t1: () => document.getElementById('ck-total-s1'),
  t2: () => document.getElementById('ck-total-s2'),
  t3: () => document.getElementById('ck-total-s3'),
  t3b:() => document.getElementById('ck-total-s3b'),
  prev1:()=> document.getElementById('ck-prev-1'),
  next1:()=> document.getElementById('ck-next-1'),
  prev2:()=> document.getElementById('ck-prev-2'),
  next2:()=> document.getElementById('ck-next-2'),
  prev3:()=> document.getElementById('ck-prev-3'),
  finish:()=> document.getElementById('ck-finish'),
  close: ()=> document.getElementById('ck-close'),
  pixQR: ()=> document.getElementById('ck-pix-qr'),
  pixCopy:()=> document.getElementById('ck-pix-copy'),
  pixPayload:()=> document.getElementById('ck-pix-payload'),
  tabPix: ()=> document.getElementById('ck-tab-pix'),
  tabPP:  ()=> document.getElementById('ck-tab-pp'),
  panePix:()=> document.getElementById('ck-pane-pix'),
  panePP: ()=> document.getElementById('ck-pane-pp'),
  fNome: ()=> document.getElementById('ck-nome'),
  fEmail:()=> document.getElementById('ck-email'),
  fFone: ()=> document.getElementById('ck-fone'),
};

function ckOpenModal(){
  ckOpen=true; ckStep=1;
  const ov=CK.overlay(), md=CK.modal(); if(!ov||!md) return;
  ov.removeAttribute('hidden'); md.removeAttribute('hidden');
  document.documentElement.classList.add('ck-open');
  CK.s1().hidden=false; CK.s2().hidden=true; CK.s3().hidden=true;
  ckRenderStep1(); ckSyncTotalsOnSteps();
}
function ckCloseModal(){
  ckOpen=false; const ov=CK.overlay(), md=CK.modal(); if(!ov||!md) return;
  ov.setAttribute('hidden',''); md.setAttribute('hidden','');
  document.documentElement.classList.remove('ck-open');
}
function ckGoStep(step){
  ckStep=step; if(CK.s1()) CK.s1().hidden=step!==1; if(CK.s2()) CK.s2().hidden=step!==2; if(CK.s3()) CK.s3().hidden=step!==3;
  if (step===3) ckEnsurePixReady(true);
}
function ckSyncTotalsOnSteps(){
  const v=Math.floor(totalGeral||0);
  CK.t1()&&(CK.t1().textContent='R$ '+v);
  CK.t2()&&(CK.t2().textContent='R$ '+v);
  CK.t3()&&(CK.t3().textContent='R$ '+v);
  CK.t3b()&&(CK.t3b().textContent='R$ '+v);
}

/* ===== Passo 1: listas ===== */
function ckMakeRow({ kind, id, itemNode, priceText }){
  const row=document.createElement('div'); row.className='ck-row';
  const colX=document.createElement('div'); colX.className='col-x';
  const bx=document.createElement('button'); bx.className='ck-x'; bx.textContent='X'; bx.dataset.kind=kind; bx.dataset.id=id;
  colX.appendChild(bx);
  const colItem=document.createElement('div'); colItem.className='col-item'; colItem.appendChild(itemNode);
  const colPrice=document.createElement('div'); colPrice.className='col-price'; colPrice.textContent=priceText||'';
  row.append(colX,colItem,colPrice); return row;
}
function ckMakeRifaChip(label,bg,text){
  const chip=document.createElement('div'); chip.className='rifa-chip'; chip.style.backgroundColor=bg||'var(--beige)'; chip.style.color=text||'var(--ink)';
  const t=(label||'').trim();
  if(!t){ const s1=document.createElement('span'); s1.className='ln1'; s1.textContent=''; chip.appendChild(s1); }
  else if(t.length<=28){ const s1=document.createElement('span'); s1.className='ln1'; s1.textContent=t; chip.appendChild(s1); }
  else { const mid=Math.floor(t.length/2); let bp=t.lastIndexOf(' ',mid); if(bp<3) bp=t.indexOf(' ',mid); if(bp===-1) bp=28;
         const p1=t.slice(0,bp).trim(), p2=t.slice(bp).trim();
         const s1=document.createElement('span'); s1.className='ln1'; s1.textContent=p1; chip.appendChild(s1);
         if(p2){ const s2=document.createElement('span'); s2.className='ln2'; s2.textContent=p2; chip.appendChild(s2); } }
  return chip;
}
function ckRenderStep1(){
  const listR=CK.listR(), listP=CK.listP(), listF=CK.listF(); if(!listR||!listP||!listF) return;
  listR.innerHTML=''; listP.innerHTML=''; listF.innerHTML='';

  // Rifas (R$25 cada; se ímpar, a última é R$30)
  const rSel=[...rifasSel];
  const last30=(rSel.length%2===1)?String(rSel[rSel.length-1]):null;
  rSel.forEach(rid=>{
    const r = rifas.find(x=>String(x.id_rifa)===String(rid)); if(!r) return;
    const label=(r.botao_rifa?.trim()||r.numero||r.id_rifa||'').toString().replace(/^\s*X\s*/i,'');
    const bg=r.hex_rifa||r.hex||'#bebab0', txt=getContrastColor(bg);
    const price=(last30 && String(rid)===last30)?30:25;
    listR.appendChild( ckMakeRow({kind:'rifa', id:rid, itemNode:ckMakeRifaChip(label,bg,txt), priceText:'R$ '+price}) );
  });

  // Peças
  [...selecionadas].forEach(pid=>{
    const p=pecas.find(x=>String(x.id_peca)===String(pid)); if(!p) return;
    const wrap=document.createElement('div');
    const img=imgWithFallback('/img/tmb/'+(p.imagens?.[0]||'')+'.avif'); img.className='ck-thumb';
    const ttl=document.createElement('span'); ttl.className='ck-title'; ttl.textContent=p.titulo||('Peça '+pid);
    wrap.append(img,ttl);
    listP.appendChild( ckMakeRow({kind:'peca', id:pid, itemNode:wrap, priceText:'R$ '+Math.floor(Number(p.preco||0))}) );
  });

  // Favoritas (sem preço)
  [...favoritos].forEach(fid=>{
    const p=pecas.find(x=>String(x.id_peca)===String(fid)); if(!p) return;
    const wrap=document.createElement('div');
    const img=imgWithFallback('/img/tmb/'+(p.imagens?.[0]||'')+'.avif'); img.className='ck-thumb';
    const ttl=document.createElement('span'); ttl.className='ck-title'; ttl.textContent=p.titulo||('Peça '+fid);
    wrap.append(img,ttl);
    listF.appendChild( ckMakeRow({kind:'fav', id:fid, itemNode:wrap, priceText:''}) );
  });

  // Remoções
  CK.modal().querySelectorAll('.ck-x').forEach(b=>{
    b.onclick=()=>{
      const k=b.dataset.kind, id=b.dataset.id;
      if(k==='rifa') rifasSel.delete(id);
      else if(k==='peca') selecionadas.delete(id);
      else if(k==='fav') favoritos.delete(id);
      calcularTotal(); ckRenderStep1();
    };
  });
}

/* ===== Passo 3: PIX ===== */
function CRC16_CCITT_FFFF(data){
  let crc=0xFFFF;
  for(let i=0;i<data.length;i++){ let x=((crc>>8)^data.charCodeAt(i))&0xff; x^=x>>4; crc=(crc<<8)^(x<<12)^(x<<5)^x; }
  crc&=0xFFFF; return crc.toString(16).toUpperCase().padStart(4,'0');
}
function gerarBRCode(valor){
  const chavePix="betshoptv@gmail.com";
  const nome="BET SHOP TV".substring(0,25).toUpperCase();
  const cidade="SAO PAULO".substring(0,15).toUpperCase();
  const txid="***"; const f=(id,val)=> id+String(val.length).padStart(2,'0')+val;
  let pl="000201";
  pl+=f('26',`0014BR.GOV.BCB.PIX01${String(chavePix.length).padStart(2,'0')}${chavePix}`);
  pl+='52040000'; pl+='5303986';
  pl+=f('54', Number(Math.floor(valor||0)).toFixed(2));
  pl+='5802BR'; pl+=f('59',nome); pl+=f('60',cidade); pl+=f('62',f('05',txid)); pl+='6304';
  return pl+CRC16_CCITT_FFFF(pl);
}
function ckEnsurePixReady(force=false){
  const total = Math.floor(totalGeral||0);
  CK.t3()&&(CK.t3().textContent='R$ '+total); CK.t3b()&&(CK.t3b().textContent='R$ '+total);

  const payload = gerarBRCode(total);
  const holder = CK.pixPayload(); if(holder) holder.textContent = payload;

  const box = CK.pixQR(); if(!box) return;
  if(force) box.innerHTML='';
  if(box.childElementCount===0 && window.QRCode){
    new QRCode(box,{text:payload,width:160,height:160,correctLevel:QRCode.CorrectLevel.M});
  }

  const btn=CK.pixCopy();
  if(btn && !btn._ckBound){
    btn._ckBound=true;
    btn.onclick=()=>{
      const text = holder?.textContent || payload;
      const done=(ok)=>{ const old=btn.textContent; btn.textContent = ok?'PIX copiado!':'Erro ao copiar'; setTimeout(()=>btn.textContent=old,1500); };
      if(navigator.clipboard?.writeText) navigator.clipboard.writeText(text).then(()=>done(true)).catch(()=>done(false));
      else { const ta=document.createElement('textarea'); ta.value=text; ta.style.position='fixed'; ta.style.top='-9999px'; document.body.appendChild(ta); ta.select(); try{ document.execCommand('copy'); done(true);}catch(e){done(false);} document.body.removeChild(ta); }
    };
  }

  // abas
  const tabPix=CK.tabPix(), tabPP=CK.tabPP(), panePix=CK.panePix(), panePP=CK.panePP();
  if(tabPix && !tabPix._ckBound){ tabPix._ckBound=true; tabPix.onclick=()=>{ tabPix.setAttribute('aria-selected','true'); tabPP?.setAttribute('aria-selected','false'); panePix?.setAttribute('aria-hidden','false'); panePP?.setAttribute('aria-hidden','true'); }; }
  if(tabPP && !tabPP._ckBound){ tabPP._ckBound=true; tabPP.onclick=()=>{ tabPP.setAttribute('aria-selected','true'); tabPix?.setAttribute('aria-selected','false'); panePP?.setAttribute('aria-hidden','false'); panePix?.setAttribute('aria-hidden','true'); }; }
}

/* ===== Passo 2 + Finalizar ===== */
function ckFillHiddenForm(nome,email,fone){
  document.getElementById('fNome')?.setAttribute('value', (nome||'').trim());
  document.getElementById('fEmail')?.setAttribute('value', (email||'').trim());
  document.getElementById('fTelefone')?.setAttribute('value', (fone||'').trim());
  document.getElementById('fPecas')?.setAttribute('value', [...selecionadas].join(','));
  document.getElementById('fRifas')?.setAttribute('value', [...rifasSel].join(','));
  document.getElementById('fFav')  ?.setAttribute('value', [...favoritos].join(','));
  document.getElementById('fTotal')?.setAttribute('value', Math.floor(totalGeral||0).toFixed(2));
}
function ckValidateStep2(){
  const nome=(CK.fNome()?.value||'').trim();
  const email=(CK.fEmail()?.value||'').trim();
  if(!nome || !email){ alert('Preencha nome e e-mail.'); return null; }
  return { nome, email, fone:(CK.fFone()?.value||'').trim() };
}
(function bindStepNav(){
  CK.prev1()?.addEventListener('click', ()=>{ /* nada */ });
  CK.next1()?.addEventListener('click', ()=> ckGoStep(2));
  CK.prev2()?.addEventListener('click', ()=> ckGoStep(1));
  CK.next2()?.addEventListener('click', ()=>{ const ok=ckValidateStep2(); if(!ok) return; ckGoStep(3); });
})();
(function bindFinish(){
  const btn=CK.finish(); if(!btn) return;
  btn.onclick=()=>{
    const info=ckValidateStep2(); if(!info){ ckGoStep(2); return; }
    ckFillHiddenForm(info.nome,info.email,info.fone);
    try{ // backup no GAS (best-effort)
      const fd=new FormData(); fd.append('nome',info.nome); fd.append('email',info.email); fd.append('telefone',info.fone);
      fd.append('pecas',[...selecionadas].join(',')); fd.append('rifas',[...rifasSel].join(',')); fd.append('favoritas',[...favoritos].join(','));
      fd.append('total', Math.floor(totalGeral||0).toFixed(2)); fetch(GAS_URL,{method:'POST',body:fd,mode:'no-cors'});
    }catch(e){}
    document.getElementById('hiddenForm')?.submit();
  };
})();

/* ===== CTA / abrir-fechar modal ===== */
(function bindFooterCTA(){
  const btn=document.getElementById('ctaMain'); const ov=CK.overlay(), md=CK.modal(); if(!btn||!ov||!md) return;
  btn.addEventListener('click', (e)=>{ if((totalGeral||0)<=0) return; ckOpenModal(); });
  ov.addEventListener('click', ckCloseModal);
  CK.close()?.addEventListener('click', ckCloseModal);
})();
document.addEventListener('keydown', (ev)=>{ if(ev.key==='Escape' && ckOpen){ ev.preventDefault(); ckCloseModal(); }});

/* ======================== OPEN FEED AT ================= */
function openFeedAt(id){
  const tryScroll=()=>{ const el=document.getElementById('post-'+id); if(!el) return false; el.scrollIntoView({behavior:'smooth',block:'start'}); return true; };
  if (document.getElementById('feedList')){ if(!tryScroll()) setTimeout(tryScroll,120); }
  else { renderFeed(); setTimeout(tryScroll,100); }
}

/* ========================== INIT ======================= */
async function init(){
  try{
    const [rp, rr] = await Promise.all([
      fetch(PECAS_JSON_URL, {cache:'no-store'}),
      fetch(RIFAS_JSON_URL, {cache:'no-store'})
    ]);
    if(!rp.ok || !rr.ok) throw new Error('Falha ao carregar JSONs');
    pecas = await rp.json(); rifas = await rr.json();

    attachAppDelegation();
    handleHashChange();                          // render pela hash
    calcularTotal(); updatePills();
  }catch(e){
    console.error(e);
    document.getElementById('app').innerHTML = '<div style="padding:20px;color:#900;">Erro ao carregar dados.</div>';
  }
}
window.addEventListener('DOMContentLoaded', init);
</script>


    


    
</body>
</html>
